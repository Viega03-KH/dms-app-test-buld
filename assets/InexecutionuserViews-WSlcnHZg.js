import{k as N,Q as G,a as n,o as a,b as e,v as h,f as l,N as R,q as v,c as x,I as K,n as P,R as U,y as W,u as Z,_ as J,x as L,d as D,r as M,g as o,j as A,h as F,F as $,C as T,e as ee,B as se,P as te,l as ae,t as le,s as oe}from"./index-BtXiaCr0.js";import{C as ne}from"./check-check-Hc8CVHGj.js";import{_,S as H}from"./UInfoItem-CCF4bHcw.js";import{_ as I}from"./UFileCard-D6XxzopN.js";import{u as O}from"./taskStore-vh3Sz-Ir.js";import{u as ie,X as re,S as de}from"./useFormValidate-Db0qx1D3.js";import{C as ce}from"./cloud-upload-DPlruAy0.js";import{P as ue}from"./plus-308K3JGX.js";import{_ as me}from"./UPagination-C8bcmI1E.js";import{T as pe}from"./trash-2-BZ4WWJqv.js";import"./chevron-left-tdeXKBW1.js";import"./chevron-right-Ce4cLiOI.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=N("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=N("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),fe={class:"flex flex-row"},ge={class:"flex-1 min-w-0"},ke={class:"flex flex-row items-center justify-between pb-2"},ve={class:"text-sm font-extrabold text-black"},xe={class:"text-sm font-medium text-[#697696]"},ye={class:"flex flex-col gap-y-2"},_e={class:"flex flex-row items-center justify-between"},we={class:"flex-1 min-w-0 truncate text-sm font-bold text-black"},$e={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},je={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},Te="task card-dark border-b px-3 py-4 cursor-pointer hover:bg-[#4076FF0D]",Fe={__name:"TaskListItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(s){const t=G(),d=(c,m)=>{t.open(c,{x:m.clientX+10,y:m.clientY+10})};return(c,m)=>(a(),n("div",{onClick:m[2]||(m[2]=g=>c.$emit("select",s.task)),class:P([Te,s.active?"bg-[#4076FF0D]":""])},[e("div",fe,[e("div",ge,[e("div",ke,[e("h4",ve,h(s.task.document?.in_number),1),e("h4",xe,h(l(R)(s.task.doc_data).format("DD MMMM YYYY")),1)]),e("div",ye,[e("div",_e,[e("span",we,h(s.task.subject?.title),1),s.task.status==="in_progress"?(a(),x(l(he),{key:0,class:"w-5 h-5 text-blue-500"})):v("",!0),s.task.status==="in_confirmation"?(a(),x(l(be),{key:1,class:"w-5 h-5 text-blue-400"})):v("",!0),s.task.status==="done"?(a(),x(l(ne),{key:2,class:"w-5 h-5 text-green-500"})):v("",!0),s.task.status==="be_rejected"?(a(),x(l(K),{key:3,class:"w-5 h-5 text-red-500"})):v("",!0)]),e("span",$e,h(s.task.document?.summary),1),e("span",je," Bajarish mudati: "+h(l(R)(s.task.due_date).format("DD MMMM YYYY")),1),s.task.assignees&&s.task.assignees[0]?(a(),n("div",{key:0,onMouseenter:m[0]||(m[0]=g=>d(`Topshiriq ${s.task.assignees[0].last_name} ${s.task.assignees[0].first_name}ga yuborilmoqda`,g)),onMouseleave:m[1]||(m[1]=g=>l(t).close()),class:"inline-block card-dark border text-[14px] font-semibold text-black rounded-[10px] px-3 py-2 w-fit"},h(s.task.assignees[0].father_name?.[0])+"."+h(s.task.assignees[0].first_name?.[0])+"."+h(s.task.assignees[0].last_name),33)):v("",!0)])])])],2))}},Ce=s=>U.post("/task-responses/",s,{headers:{"Content-Type":"multipart/form-data"}}),Se=(s,t)=>U.patch(`/task-responses/${s}/`,t,{headers:{"Content-Type":"multipart/form-data"}}),Me=s=>U.delete(`/task-responses/${s}/`),qe=s=>U.delete(`/task-response-files/${s}/`),Be=W("taskResponse",{state:()=>({responses:[],loading:!1,error:null}),actions:{async addResponse(s){this.loading=!0,this.error=null;try{const t=await Ce(s);return this.responses.unshift(t.data),t.data}catch(t){throw this.error=t.response?.data||"Yuborishda xatolik yuz berdi",t}finally{this.loading=!1}},async editResponse(s,t){this.loading=!0,this.error=null;try{const d=await Se(s,t),c=this.responses.findIndex(m=>m.id===s);return c!==-1&&(this.responses[c]=d.data),d.data}catch(d){throw this.error=d.response?.data||"Tahrirlashda xatolik yuz berdi",d}finally{this.loading=!1}},async removeResponse(s){this.error=null;try{await Me(s),this.responses=this.responses.filter(t=>t.id!==s)}catch(t){throw this.error=t.response?.data||"O'chirishda xatolik",t}},async deleteFile(s){const t=Z();try{await qe(s),t.show("File oâ€˜chirildi !"),this.responses.forEach(d=>{d.files&&(d.files=d.files.filter(c=>c.id!==s))})}catch(d){throw d}},clearResponses(){this.responses=[],this.error=null}}}),De={class:"w-[100vw] md:w-[50vw] 2xl:w-[50vw] h-[70vh] flex flex-col bg-white rounded-xl shadow-lg overflow-hidden"},Ye={class:"flex justify-between items-center p-4 border-b bg-gray-50"},Re={class:"font-bold uppercase text-md text-gray-700 flex items-center gap-2"},Ie={class:"p-6 flex-1 overflow-y-auto space-y-6 bg-white custom-scrollbar"},Ue={class:"space-y-2"},Ve={class:"space-y-3"},ze={key:0,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},Pe={class:"bg-blue-50 p-4 rounded-full mb-3 group-hover:bg-blue-100 transition-colors"},Ae={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4"},He={class:"flex justify-end items-center gap-3 p-4 border-t bg-gray-50/50"},Ee={class:"px-1"},Ne={__name:"TaskResponsForm",props:{taskId:Number,existingTask:Object},setup(s){const t=s,d=L(),c=Be(),m=O(),g=D([]),b=D(t.existingTask?.files||[]),C=D(null),{form:i,errors:S,validate:p,resetForm:w}=ie({task_id:t.taskId||t.existingTask?.task,description:t.existingTask?.description||""},{task_id:{required:!0},description:{required:!0,message:"Javob izohini yozish majburiy"}}),y=k=>{const r=Array.from(k.target.files);g.value=[...g.value,...r]},u=k=>{g.value.splice(k,1)},q=async k=>{try{await c.deleteFile(k),b.value=b.value.filter(r=>r.id!==k)}catch{alert("Faylni o'chirib bo'lmadi")}},B=()=>d.close(),Y=()=>{w(),g.value=[],B()},f=async()=>{if(!p())return;const k=new FormData;k.append("task",i.task_id),k.append("description",i.description),g.value.forEach(r=>{k.append("uploaded_files",r)});try{t.existingTask?.id?await c.editResponse(t.existingTask.id,k):await c.addResponse(k),Y(),await m.fetchAll()}catch(r){console.error("Backenddan kelgan xato:",r.response?.data)}};return(k,r)=>{const V=M("UButton"),Q=M("UTextarea"),X=M("ULoadingspin");return a(),n("div",De,[e("div",Ye,[e("p",Re,[r[2]||(r[2]=e("span",{class:"w-2 h-5 bg-blue-600 rounded-full"},null,-1)),A(" "+h(s.existingTask?"Hisobotni tahrirlash":"Topshiriq bo'yicha hisobot"),1)]),o(V,{onClick:B,class:"bg-gray-200 hover:bg-gray-300 rounded-full p-1.5 transition-colors"},{default:F(()=>[o(l(re),{class:"w-4 h-4 text-gray-600","stroke-width":"3"})]),_:1})]),e("div",Ie,[e("div",Ue,[o(Q,{modelValue:l(i).description,"onUpdate:modelValue":r[0]||(r[0]=j=>l(i).description=j),label:"Bajarilgan ishlar bo'yicha izoh",placeholder:"Nimalar bajarilgani haqida batafsil yozing..",error:l(S)?.description},null,8,["modelValue","error"])]),e("div",Ve,[r[5]||(r[5]=e("label",{class:"block text-sm font-bold text-gray-700"},"Hujjatlarni biriktirish",-1)),b.value.length>0?(a(),n("div",ze,[(a(!0),n($,null,T(b.value,j=>(a(),x(I,{key:j.id,file:j,"show-delete":!0,onRemove:z=>q(j.id)},null,8,["file","onRemove"]))),128))])):v("",!0),e("div",{onClick:r[1]||(r[1]=j=>k.$refs.fileInput.click()),class:"group flex flex-col border border-[#EAECF0] shadow-sm rounded-[12px] items-center text-center justify-center p-6 cursor-pointer hover:border-blue-400 transition-all active:scale-[0.95]"},[e("input",{type:"file",ref_key:"fileInput",ref:C,multiple:"",onChange:y,class:"hidden"},null,544),e("div",Pe,[o(l(ce),{class:"w-8 h-8 text-blue-600"})]),r[3]||(r[3]=e("span",{class:"text-sm font-semibold text-gray-600"},"Yangi fayllar tanlash",-1)),r[4]||(r[4]=e("p",{class:"text-[10px] text-gray-400 mt-1 uppercase font-bold tracking-tighter"},"PDF, DOCX, JPG (Max 20MB)",-1))]),g.value.length>0?(a(),n("div",Ae,[(a(!0),n($,null,T(g.value,(j,z)=>(a(),x(I,{key:z,file:j,"show-delete":!0,onRemove:Rs=>u(z)},null,8,["file","onRemove"]))),128))])):v("",!0)])]),e("div",He,[o(V,{onClick:Y,class:"px-6 py-2.5 text-sm font-bold text-gray-500 hover:text-gray-700 transition-colors"},{default:F(()=>[...r[6]||(r[6]=[A(" Bekor qilish ",-1)])]),_:1}),o(V,{onClick:f,disabled:l(c).loading,class:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-2.5 rounded-xl font-bold text-sm shadow-lg shadow-blue-200 disabled:bg-blue-300 flex items-center gap-2 transition-all active:scale-95"},{default:F(()=>[l(c).loading?(a(),x(X,{key:0,size:"sm"})):v("",!0),e("span",Ee,h(l(c).loading?"Yuborilmoqda...":"Saqlash va yuborish"),1)]),_:1},8,["disabled"])])])}}},E=J(Ne,[["__scopeId","data-v-ef263713"]]),Je={key:0},Le={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},Oe={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-sm rounded-lg mt-4"},Qe={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},Xe={class:"font-bold text-gray-800 text-base flex items-center gap-2"},Ge={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},Ke={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},We={class:"relative shrink-0"},Ze={class:"flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 text-white font-semibold text-sm shadow-md"},es={key:0,class:"absolute -top-1 -right-1 bg-yellow-400 text-white p-0.5 rounded-full w-2 h-2 border-white shadow-sm",title:"Asosiy ijrochi"},ss={class:"flex flex-col min-w-0"},ts={class:"flex items-center gap-2"},as={class:"text-gray-900 font-semibold text-[15px] truncate group-hover:text-blue-700 transition-colors"},ls={key:0,class:"text-[10px] bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded font-bold"},os={class:"text-gray-500 text-xs truncate"},ns={key:1,class:"p-[24px]"},is={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},rs={key:0},ds={class:"grid grid-cols-2 gap-2"},cs={key:2,class:"p-[24px]"},us={class:"grid grid-cols-1 gap-4 pb-4"},ms={key:0},ps={class:"grid grid-cols-2 gap-2"},hs={key:3,class:"p-[24px] text-gray-500 text-center"},bs={class:"flex p-4 bg-[#F4F6FC] gap-3"},fs={__name:"TaskShowItem",props:{task:{type:Object,default:null}},setup(s){const t=s,d=L(),c=ee(),m=se(()=>t.task?.responses?t.task.responses.find(C=>C.user===c.user?.id):null),g=()=>{m.value?d.open(E,{taskId:t.task.id,existingTask:m.value}):console.warn("Sizda hali javob mavjud emas yoki foydalanuvchi mos kelmadi")},b=()=>{t.task?.id&&d.open(E,{taskId:t.task.id})};return(C,i)=>{const S=M("UButton");return a(),n($,null,[s.task?(a(),n("div",Je,[e("div",Le,[o(_,{label:"Bajarish muddati",value:l(R)(s.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),o(_,{label:"Topshiriq",value:s.task.subject.title},null,8,["value"]),o(_,{label:"Topshiriq mazmun",value:s.task.description,class:"col-span-2"},null,8,["value"])]),e("div",Oe,[e("div",Qe,[e("h3",Xe,[i[0]||(i[0]=e("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),i[1]||(i[1]=A(" Ijrochilar ",-1)),e("span",Ge,h(s.task.assignees?.length||0),1)])]),e("div",Ke,[(a(!0),n($,null,T(s.task.assignees,(p,w)=>(a(),n("div",{key:p.id,class:"group flex items-center gap-4 px-6 py-3 transition-all hover:bg-blue-50/50 cursor-pointer"},[e("div",We,[e("div",Ze,h(p.first_name?.[0]||"?"),1),w===0?(a(),n("div",es)):v("",!0)]),e("div",ss,[e("div",ts,[e("span",as,h(p.last_name)+" "+h(p.first_name),1),w===0?(a(),n("span",ls," Mas'ul ")):v("",!0)]),e("span",os,h(p.department_name),1)])]))),128))])]),i[2]||(i[2]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1))])):v("",!0),s.task.document?(a(),n("div",ns,[e("div",is,[o(_,{label:"Kelib tushgan raqam",value:s.task.document.in_number},null,8,["value"]),o(_,{label:"Chiqish raqami",value:s.task.document.out_number},null,8,["value"]),o(_,{label:"Hujjat nomi",value:s.task.document.title,class:"md:col-span-2"},null,8,["value"]),o(_,{label:"Hujjat nomi",value:s.task.document.summary,class:"md:col-span-2"},null,8,["value"]),o(_,{label:"Hujjatni Imzololovchi",value:s.task.document.signer},null,8,["value"]),o(_,{label:"Jurnal",value:s.task.document.journal.name},null,8,["value"])]),s.task.document.attachments?.length?(a(),n("div",rs,[i[3]||(i[3]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",ds,[(a(!0),n($,null,T(s.task.document.attachments,p=>(a(),x(I,{key:p.id,file:p},null,8,["file"]))),128))])])):v("",!0)])):v("",!0),i[7]||(i[7]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1)),s.task.responses&&s.task.responses.length?(a(),n("div",cs,[(a(!0),n($,null,T(s.task.responses,p=>(a(),n("div",{key:p.id,class:"mb-6 border-b pb-4 last:border-none"},[e("div",us,[o(_,{label:"Yuboruvchi",value:p.user_full_name},null,8,["value"]),o(_,{label:"Berilgan javob",value:p.description},null,8,["value"]),o(_,{label:"Berilgan javob sanasi",value:s.task.responses?.[0]?.created_at?l(R)(s.task.responses[0].created_at).format("DD MMMM YYYY HH:mm"):"Javob berilmagan"},null,8,["value"])]),p.files?.length?(a(),n("div",ms,[i[4]||(i[4]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",ps,[(a(!0),n($,null,T(p.files,w=>(a(),x(I,{key:w.id,file:w},null,8,["file"]))),128))])])):v("",!0)]))),128))])):(a(),n("div",hs," Hozircha javoblar mavjud emas. ")),e("div",bs,[m.value?(a(),x(S,{key:1,onClick:g,variant:"primary",class:"bg-orange-500 hover:bg-orange-600"},{default:F(()=>[o(l(de),{"stroke-width":"3",class:"text-white w-6 h-4"}),i[6]||(i[6]=e("span",{class:"px-1"},"Javobni tahrirlash",-1))]),_:1})):(a(),x(S,{key:0,onClick:b,variant:"primary"},{default:F(()=>[o(l(ue),{"stroke-width":"3",class:"text-white"}),i[5]||(i[5]=e("span",{class:"px-1"},"Javob kiritish",-1))]),_:1}))])],64)}}},gs=J(fs,[["__scopeId","data-v-1d2183a2"]]),ks={class:"mx-auto"},vs={class:"flex items-center px-2 card-dark border-b"},xs=["onClick"],ys={class:"text-gray-700 font-semibold"},_s={class:"grid grid-cols-1 lg:grid-cols-12"},ws={class:"col-span-12 md:col-span-5 2xl:col-span-3"},$s={class:"card-dark border-b-2 border-x shadow-sm"},js={class:"flex px-1 py-3 items-center border-b card-border justify-between"},Ts={class:"flex items-center"},Fs={class:"flex gap-1"},Cs={class:"h-[calc(100vh-8rem)] overflow-y-auto"},Ss={class:"col-span-12 md:col-span-7 2xl:col-span-9 space-y-2 px-3 h-[calc(100vh-4rem)] overflow-y-auto"},Ms={class:"card-dark rounded-b border-b border-x"},qs={key:0},Bs={key:1,class:"flex flex-col"},Ds={class:"grid grid-cols-3 p-6 gap-4"},Ys={class:"flex bg-[#F4F6FC] items-center gap-4 justify-end p-6"},Qs={__name:"InexecutionuserViews",setup(s){const t=O(),d=D("all"),c=D(null),m=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>t.all_tasks,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>t.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>t.in_progress,status:"in_progress"},{key:"in_confirmation",label:"Tasdiqlashda",color:"bg-gray-500",count:()=>t.in_confirmation,status:"in_confirmation"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>t.be_rejected,status:"be_rejected"}],g=async y=>{d.value=y.key,c.value=y.status||null,await t.setFilter("status",y.status)},b=te({due_date:"",assignee:"",created_at:""}),C=y=>t.setSelectedTask(y),i=y=>t.fetchAll(y),S=()=>t.setSelectedTask(null),p=async()=>{await t.setFilter("status",c.value||""),await t.setFilter("due_date",b.due_date),await t.setFilter("assignee",b.assignee),await t.setFilter("created_at",b.created_at)},w=async()=>{c.value=null,Object.keys(b).forEach(y=>b[y]=""),await p()};return ae(()=>t.fetchAll()),(y,u)=>{const q=M("UButton"),B=M("UDatePicker"),Y=oe("wave");return a(),n("div",ks,[e("div",vs,[(a(),n($,null,T(m,f=>e("div",{key:f.key,onClick:k=>g(f),class:P(["flex items-center gap-2 py-4 p-2 cursor-pointer transition hover:bg-gray-100 border-b-2",d.value===f.key?"border-b-blue-500":"border-b-transparent"])},[e("span",ys,h(f.label),1),e("span",{class:P(["text-white text-sm px-2 py-0.5 rounded-full font-semibold",f.color])},h(f.count()),3)],10,xs)),64))]),e("div",_s,[e("div",ws,[e("div",$s,[e("div",js,[e("div",Ts,[le((a(),x(q,{onClick:S,variant:"hover"},{default:F(()=>[o(l(H),{"stroke-width":"2",class:"w-6 h-6"})]),_:1})),[[Y]]),u[2]||(u[2]=e("h2",{class:"text-[14px] p-2 font-bold uppercase text-[#282F3D]"},"Topshiriqlar",-1))]),e("div",Fs,[o(me,{currentPage:l(t).pagination.currentPage,previous:l(t).pagination.previous,next:l(t).pagination.next,lastPage:Math.ceil(l(t).pagination.count/10),total:l(t).pagination.count,loading:l(t).loading,onChange:i},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),e("div",Cs,[(a(!0),n($,null,T(l(t).tasks,f=>(a(),x(Fe,{key:f.id,task:f,active:l(t).selectedTask?.id===f.id,onSelect:C},null,8,["task","active"]))),128)),u[3]||(u[3]=e("div",{class:"h-24 w-full"},null,-1))])])]),e("div",Ss,[e("div",Ms,[l(t).selectedTask?(a(),n("div",qs,[u[4]||(u[4]=e("div",{class:"flex px-1 py-2 items-center border-b card-border justify-between"},[e("h2",{class:"text-[14px] p-3 font-bold uppercase text-[#282F3D]"},"Biriktirilgan topshiriq"),e("div",{class:"flex items-center gap-2"})],-1)),o(gs,{task:l(t).selectedTask},null,8,["task"])])):(a(),n("div",Bs,[e("div",null,[u[5]||(u[5]=e("div",{class:"flex p-3 items-center card-border border-b justify-between"},[e("h2",{class:"text-[14px] py-2 font-bold uppercase text-[#282F3D]"},"Qidirish")],-1)),e("div",Ds,[o(B,{modelValue:b.due_date,"onUpdate:modelValue":u[0]||(u[0]=f=>b.due_date=f),placeholder:"Topshiriq bajarish muddati"},null,8,["modelValue"]),o(B,{modelValue:b.created_at,"onUpdate:modelValue":u[1]||(u[1]=f=>b.created_at=f),placeholder:"Topshiriq yuborilgan sana"},null,8,["modelValue"])])]),e("div",Ys,[o(q,{class:"flex items-center",onClick:w},{default:F(()=>[o(l(pe),{"stroke-width":"2.5",class:"w-5 h-5"}),u[6]||(u[6]=e("span",{class:"px-2"},"Tozalash",-1))]),_:1}),o(q,{variant:"primary",class:"flex items-center",onClick:p},{default:F(()=>[o(l(H),{"stroke-width":"2.5",class:"w-5 h-5"}),u[7]||(u[7]=e("span",{class:"px-2"},"Qidirish",-1))]),_:1})])]))]),u[8]||(u[8]=e("div",{class:"w-full h-48"},null,-1))])])])}}};export{Qs as default};
