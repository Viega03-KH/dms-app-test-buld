import{k as D,_ as X,d as S,D as N,r as T,s as J,a as m,o as p,q as C,t as z,v as d,b as a,g as o,f as l,n as V,V as Q,h as k,J as F,K as O,T as W,x as Y,l as G,A as R,w as Z,W as ee,X as se,j as B}from"./index-C_K37xRx.js";import{u as te}from"./taskStore-CeK3DC7n.js";import{u as ae}from"./usersStore-C95FDL8S.js";import{u as le}from"./subjectStore-CROQczHv.js";import{u as ie,X as oe}from"./useFormValidate-BOioRNXX.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=D("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=D("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),de={class:"flex flex-col gap-1 w-full"},ce={key:0,class:"text-md font-bold"},ue={class:"relative"},me={class:"flex items-center gap-3 text-gray-400"},pe={key:0,class:"absolute mt-2 w-full bg-white border rounded-lg shadow z-50 max-h-80 flex flex-col"},fe={class:"p-2 border-b"},_e={class:"overflow-auto"},ge=["onClick"],he={class:"w-9 h-9 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-sm"},xe={class:"flex-1"},be={class:"font-medium text-sm"},ve={class:"text-xs text-gray-500"},ye={key:0,class:"p-4 text-center text-sm text-gray-500 italic"},ke={__name:"MultiColumnUserSelect",props:{options:{type:Array,default:()=>[]},selectedIds:{type:Array,default:()=>[]},label:String,placeholder:{type:String,default:"Ijrochini tanlang"},error:String},emits:["select"],setup(_,{emit:c}){const x=_,w=c,i=S(!1),u=S(""),b=()=>{i.value=!i.value,i.value||(u.value="")},v=()=>{i.value=!1,u.value=""},t=f=>{x.selectedIds.includes(f)||(w("select",f),u.value="",i.value=!1)},g=f=>x.selectedIds.includes(f),j=N(()=>{if(!u.value)return x.options;const f=u.value.toLowerCase();return x.options.filter(h=>`${h.first_name||""} ${h.last_name||""} ${h.department?.name||""}`.toLowerCase().includes(f))});return(f,h)=>{const y=T("UInput"),$=J("click-outside");return p(),m("div",de,[_.label?(p(),m("label",ce,d(_.label),1)):C("",!0),z((p(),m("div",ue,[a("div",{onClick:b,class:V(["border rounded-xl px-4 py-3 flex justify-between items-center cursor-pointer transition",{"border-blue-500 ring-1 ring-blue-400":i.value,"border-red-400":_.error}])},[a("div",me,[o(l(re)),a("span",null,d(_.placeholder),1)]),o(l(Q),{class:V(["transition text-gray-400",{"rotate-180":i.value}])},null,8,["class"])],2),o(W,{name:"fade"},{default:k(()=>[i.value?(p(),m("div",pe,[a("div",fe,[o(y,{modelValue:u.value,"onUpdate:modelValue":h[0]||(h[0]=n=>u.value=n),type:"text",placeholder:"Qidirish..."},null,8,["modelValue"])]),a("ul",_e,[(p(!0),m(F,null,O(j.value,n=>(p(),m("li",{key:n.id,onClick:q=>t(n.id),class:V(["px-4 py-3 cursor-pointer flex items-center gap-3 transition",{"bg-gray-100 cursor-not-allowed":g(n.id),"hover:bg-gray-50":!g(n.id)}])},[a("div",he,d(n.first_name?.[0])+d(n.last_name?.[0]),1),a("div",xe,[a("p",be,d(n.first_name)+" "+d(n.last_name),1),a("p",ve,d(n.department?.name||"â€”"),1)])],10,ge))),128)),j.value.length?C("",!0):(p(),m("li",ye," Natija topilmadi "))])])):C("",!0)]),_:1})])),[[$,v]])])}}},we=X(ke,[["__scopeId","data-v-1d401828"]]),je={class:"w-[100vw] md:w-[80vw] 2xl:w-[50vw] h-[90vh] flex flex-col bg-white rounded-xl shadow-lg"},Ue={class:"flex justify-between items-center p-4 border-b"},Te={class:"font-bold uppercase text-md"},Se={class:"p-6 flex-1 h-[calc(80vh-64px)] overflow-y-scroll space-y-6"},$e={class:"grid grid-cols-2 gap-4"},Ce={class:"flex items-center pt-2 justify-start gap-2 col-span-2"},Ve={class:"relative inline-flex items-center cursor-pointer"},qe={class:"flex flex-col gap-2"},Ie={class:"flex flex-col gap-2"},Ae={class:"w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-sm"},Me={class:"flex flex-col flex-1 leading-tight"},Be={class:"text-sm font-medium text-blue-900"},De={class:"text-xs text-blue-600"},Ne={class:"flex justify-end gap-3 p-4 border-t"},Ke={__name:"TaskForm",props:{id:Number,existingTask:Object},setup(_){const c=_,x=Y(),w=te(),i=ae(),u=le(),b=S(!1),v=S(!1),{form:t,errors:g,validate:j,resetForm:f}=ie({document_id:c.id,subject_id:null,due_date:"",description:"",assignees_ids:[]},{subject_id:{required:!0,message:"Topshiriq tanlanishi majburiy"},due_date:{required:!0,message:"Sana majburiy"},description:{required:!0,message:"Mazmuni majburiy"},assignees_ids:{custom:s=>!Array.isArray(s)||!s.length?"Kamida bitta ijrochi tanlang":""}}),h=N(()=>Object.fromEntries(i.users.map(s=>[s.id,s]))),y=s=>h.value[s],$=s=>{const e=y(s);return e?`${e.first_name} ${e.last_name}`:"Unknown"},n=s=>{const e=y(s);return e?`${e.first_name?.[0]||""}${e.last_name?.[0]||""}`:"?"},q=s=>y(s)?.department?.name||"";G(async()=>{await Promise.all([i.fetchUsers(),u.fetchAll()]),c.existingTask&&(t.document_id=c.existingTask.document?.id||null,t.subject_id=c.existingTask.subject?.id||null,t.due_date=c.existingTask.due_date||"",t.description=c.existingTask.description||"",t.assignees_ids=c.existingTask.assignees?.map(s=>s.id)||[],v.value=t.assignees_ids.length===i.users.length)}),R(v,s=>{i.users.length&&(t.assignees_ids=s?i.users.map(e=>e.id):[])});const I=()=>x.close(),A=()=>{f(),I()},E=s=>{const e=t.assignees_ids.indexOf(s);e===-1?t.assignees_ids.push(s):t.assignees_ids.splice(e,1)},L=s=>{t.assignees_ids=t.assignees_ids.filter(e=>e!==s)},H=s=>{typeof s=="object"&&Object.keys(s).forEach(e=>{g[e]=Array.isArray(s[e])?s[e].join(", "):s[e]})},M=async()=>{if(j()){b.value=!0;try{const s={document_id:t.document_id,subject_id:t.subject_id,due_date:t.due_date,description:t.description,assignees_ids:t.assignees_ids},e=c.existingTask?await w.updateTask(c.existingTask.id,s):await w.createTask(s);e.success?A():H(e.error)}catch(s){console.error(s)}finally{b.value=!1}}};return(s,e)=>{const U=T("UButton"),K=T("USelect"),P=T("UTextarea");return p(),m("div",je,[a("div",Ue,[a("p",Te,d(_.existingTask?"Topshiriqni tahrirlash":"Topshiriq yaratish"),1),o(U,{class:"bg-gray-700 rounded-full p-1",onClick:I},{default:k(()=>[o(l(oe),{class:"w-3 h-3 text-white","stroke-width":"3"})]),_:1})]),a("div",Se,[a("form",{onSubmit:Z(M,["prevent"]),class:"flex flex-col gap-4"},[a("div",$e,[o(K,{modelValue:l(t).subject_id,"onUpdate:modelValue":e[0]||(e[0]=r=>l(t).subject_id=r),options:l(u).subjects,label:"Topshiriq",placeholder:"Topshiriq tanlang","option-label":"title","option-value":"id",loading:l(u).loading,error:l(g).subject_id},null,8,["modelValue","options","loading","error"]),o(ee,{modelValue:l(t).due_date,"onUpdate:modelValue":e[1]||(e[1]=r=>l(t).due_date=r),label:"Boshlanish sanasi",placeholder:"Sanani tanlang",error:l(g).due_date},null,8,["modelValue","error"]),a("div",Ce,[e[6]||(e[6]=a("span",{class:"text-md font-medium"},"Barchasini Ijrochilarni tanlash",-1)),a("label",Ve,[z(a("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":e[2]||(e[2]=r=>v.value=r)},null,512),[[se,v.value]]),e[4]||(e[4]=a("div",{class:"w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-blue-500 peer-focus:ring-2 peer-focus:ring-blue-300 transition-colors"},null,-1)),e[5]||(e[5]=a("div",{class:"absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full peer-checked:translate-x-full transition-transform shadow"},null,-1))])])]),a("div",qe,[o(we,{options:l(i).users,"selected-ids":l(t).assignees_ids,label:"Ijrochilar",error:l(g).assignees_ids,onSelect:E},null,8,["options","selected-ids","error"]),a("div",Ie,[(p(!0),m(F,null,O(l(t).assignees_ids,r=>(p(),m("div",{key:r,class:"relative flex items-center gap-3 w-full px-4 py-2 bg-blue-50 border border-blue-200 rounded-xl"},[a("div",Ae,d(n(r)),1),a("div",Me,[a("span",Be,d($(r)),1),a("span",De,d(q(r)),1)]),o(U,{type:"button",onClick:ze=>L(r)},{default:k(()=>[o(l(ne),{class:"w-5 h-5 text-gray-400"})]),_:1},8,["onClick"])]))),128))])]),o(P,{modelValue:l(t).description,"onUpdate:modelValue":e[3]||(e[3]=r=>l(t).description=r),label:"Topshiriq mazmuni",rows:"4",placeholder:"Topshiriq mazmunini kiriting...",error:l(g).description},null,8,["modelValue","error"])],32)]),a("div",Ne,[o(U,{variant:"ghost",onClick:A},{default:k(()=>[...e[7]||(e[7]=[B("Bekor qilish",-1)])]),_:1}),o(U,{variant:"primary",disabled:b.value,onClick:M},{default:k(()=>[B(d(b.value?"Yuborilmoqda...":"Saqlash va yuborish"),1)]),_:1},8,["disabled"])])])}}};export{Ke as _};
