import{k as L,R as W,a as n,o as a,b as e,v as h,f as l,O as I,q as v,c as w,I as Z,n as H,S as V,y as ee,u as se,_ as N,x as Q,d as D,r as M,g as o,j as E,h as F,F as $,C as T,e as te,B as ae,t as R,J as A,Q as le,l as oe,s as ne}from"./index-CCDjh50H.js";import{C as ie}from"./check-check-jbQk9FSH.js";import{_ as y,S as J}from"./UInfoItem-DR3coP1g.js";import{_ as U}from"./UFileCard-BpT-hOtE.js";import{u as X}from"./taskStore-6dywxdbk.js";import{u as re,X as de,S as ce}from"./useFormValidate-PzpJs8mc.js";import{C as ue}from"./cloud-upload-CPdEKmpK.js";import{P as me}from"./plus-C3tzjb3u.js";import{_ as pe}from"./UPagination-DHY0kFLz.js";import{T as he}from"./trash-2-BREhF32t.js";import"./chevron-left-BlZX--ht.js";import"./chevron-right-WHC7EkOp.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=L("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=L("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),ge={class:"flex flex-row"},ke={class:"flex-1 min-w-0"},ve={class:"flex flex-row items-center justify-between pb-2"},xe={class:"text-sm font-extrabold text-black"},ye={class:"text-sm font-medium text-[#697696]"},we={class:"flex flex-col gap-y-2"},_e={class:"flex flex-row items-center justify-between"},$e={class:"flex-1 min-w-0 truncate text-sm font-bold text-black"},je={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},Te={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},Fe="task card-dark border-b px-3 py-4 cursor-pointer hover:bg-[#4076FF0D]",Ce={__name:"TaskListItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(s){const t=W(),d=(c,u)=>{t.open(c,{x:u.clientX+10,y:u.clientY+10})};return(c,u)=>(a(),n("div",{onClick:u[2]||(u[2]=g=>c.$emit("select",s.task)),class:H([Fe,s.active?"bg-[#4076FF0D]":""])},[e("div",ge,[e("div",ke,[e("div",ve,[e("h4",xe,h(s.task.document?.in_number),1),e("h4",ye,h(l(I)(s.task.doc_data).format("DD MMMM YYYY")),1)]),e("div",we,[e("div",_e,[e("span",$e,h(s.task.subject?.title),1),s.task.status==="in_progress"?(a(),w(l(be),{key:0,class:"w-5 h-5 text-blue-500"})):v("",!0),s.task.status==="in_confirmation"?(a(),w(l(fe),{key:1,class:"w-5 h-5 text-blue-400"})):v("",!0),s.task.status==="done"?(a(),w(l(ie),{key:2,class:"w-5 h-5 text-green-500"})):v("",!0),s.task.status==="be_rejected"?(a(),w(l(Z),{key:3,class:"w-5 h-5 text-red-500"})):v("",!0)]),e("span",je,h(s.task.document?.summary),1),e("span",Te," Bajarish mudati: "+h(l(I)(s.task.due_date).format("DD MMMM YYYY")),1),s.task.assignees&&s.task.assignees[0]?(a(),n("div",{key:0,onMouseenter:u[0]||(u[0]=g=>d(`Topshiriq ${s.task.assignees[0].last_name} ${s.task.assignees[0].first_name}ga yuborilmoqda`,g)),onMouseleave:u[1]||(u[1]=g=>l(t).close()),class:"inline-block card-dark border text-[14px] font-semibold text-black rounded-[10px] px-3 py-2 w-fit"},h(s.task.assignees[0].father_name?.[0])+"."+h(s.task.assignees[0].first_name?.[0])+"."+h(s.task.assignees[0].last_name),33)):v("",!0)])])])],2))}},Se=s=>V.post("/task-responses/",s,{headers:{"Content-Type":"multipart/form-data"}}),Me=(s,t)=>V.patch(`/task-responses/${s}/`,t,{headers:{"Content-Type":"multipart/form-data"}}),qe=s=>V.delete(`/task-responses/${s}/`),Be=s=>V.delete(`/task-response-files/${s}/`),De=ee("taskResponse",{state:()=>({responses:[],loading:!1,error:null}),actions:{async addResponse(s){this.loading=!0,this.error=null;try{const t=await Se(s);return this.responses.unshift(t.data),t.data}catch(t){throw this.error=t.response?.data||"Yuborishda xatolik yuz berdi",t}finally{this.loading=!1}},async editResponse(s,t){this.loading=!0,this.error=null;try{const d=await Me(s,t),c=this.responses.findIndex(u=>u.id===s);return c!==-1&&(this.responses[c]=d.data),d.data}catch(d){throw this.error=d.response?.data||"Tahrirlashda xatolik yuz berdi",d}finally{this.loading=!1}},async removeResponse(s){this.error=null;try{await qe(s),this.responses=this.responses.filter(t=>t.id!==s)}catch(t){throw this.error=t.response?.data||"O'chirishda xatolik",t}},async deleteFile(s){const t=se();try{await Be(s),t.show("File oâ€˜chirildi !"),this.responses.forEach(d=>{d.files&&(d.files=d.files.filter(c=>c.id!==s))})}catch(d){throw d}},clearResponses(){this.responses=[],this.error=null}}}),Ye={class:"w-[100vw] md:w-[50vw] 2xl:w-[50vw] h-[70vh] flex flex-col bg-white rounded-xl shadow-lg overflow-hidden"},Re={class:"flex justify-between items-center p-4 border-b bg-gray-50"},Ie={class:"font-bold uppercase text-md text-gray-700 flex items-center gap-2"},Ue={class:"p-6 flex-1 overflow-y-auto space-y-6 bg-white custom-scrollbar"},Ve={class:"space-y-2"},ze={class:"space-y-3"},Pe={key:0,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},Ae={class:"bg-blue-50 p-4 rounded-full mb-3 group-hover:bg-blue-100 transition-colors"},He={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4"},Ee={class:"flex justify-end items-center gap-3 p-4 border-t bg-gray-50/50"},Je={class:"px-1"},Oe={__name:"TaskResponsForm",props:{taskId:Number,existingTask:Object},setup(s){const t=s,d=Q(),c=De(),u=X(),g=D([]),b=D(t.existingTask?.files||[]),C=D(null),{form:i,errors:S,validate:p,resetForm:_}=re({task_id:t.taskId||t.existingTask?.task,description:t.existingTask?.description||""},{task_id:{required:!0},description:{required:!0,message:"Javob izohini yozish majburiy"}}),x=k=>{const r=Array.from(k.target.files);g.value=[...g.value,...r]},m=k=>{g.value.splice(k,1)},q=async k=>{try{await c.deleteFile(k),b.value=b.value.filter(r=>r.id!==k)}catch{alert("Faylni o'chirib bo'lmadi")}},B=()=>d.close(),Y=()=>{_(),g.value=[],B()},f=async()=>{if(!p())return;const k=new FormData;k.append("task",i.task_id),k.append("description",i.description),g.value.forEach(r=>{k.append("uploaded_files",r)});try{t.existingTask?.id?await c.editResponse(t.existingTask.id,k):await c.addResponse(k),Y(),await u.fetchAll()}catch(r){console.error("Backenddan kelgan xato:",r.response?.data)}};return(k,r)=>{const z=M("UButton"),G=M("UTextarea"),K=M("ULoadingspin");return a(),n("div",Ye,[e("div",Re,[e("p",Ie,[r[2]||(r[2]=e("span",{class:"w-2 h-5 bg-blue-600 rounded-full"},null,-1)),E(" "+h(s.existingTask?"Hisobotni tahrirlash":"Topshiriq bo'yicha hisobot"),1)]),o(z,{onClick:B,class:"bg-gray-200 hover:bg-gray-300 rounded-full p-1.5 transition-colors"},{default:F(()=>[o(l(de),{class:"w-4 h-4 text-gray-600","stroke-width":"3"})]),_:1})]),e("div",Ue,[e("div",Ve,[o(G,{modelValue:l(i).description,"onUpdate:modelValue":r[0]||(r[0]=j=>l(i).description=j),label:"Bajarilgan ishlar bo'yicha izoh",placeholder:"Nimalar bajarilgani haqida batafsil yozing..",error:l(S)?.description},null,8,["modelValue","error"])]),e("div",ze,[r[5]||(r[5]=e("label",{class:"block text-sm font-bold text-gray-700"},"Hujjatlarni biriktirish",-1)),b.value.length>0?(a(),n("div",Pe,[(a(!0),n($,null,T(b.value,j=>(a(),w(U,{key:j.id,file:j,"show-delete":!0,onRemove:P=>q(j.id)},null,8,["file","onRemove"]))),128))])):v("",!0),e("div",{onClick:r[1]||(r[1]=j=>k.$refs.fileInput.click()),class:"group flex flex-col border border-[#EAECF0] shadow-sm rounded-[12px] items-center text-center justify-center p-6 cursor-pointer hover:border-blue-400 transition-all active:scale-[0.95]"},[e("input",{type:"file",ref_key:"fileInput",ref:C,multiple:"",onChange:x,class:"hidden"},null,544),e("div",Ae,[o(l(ue),{class:"w-8 h-8 text-blue-600"})]),r[3]||(r[3]=e("span",{class:"text-sm font-semibold text-gray-600"},"Yangi fayllar tanlash",-1)),r[4]||(r[4]=e("p",{class:"text-[10px] text-gray-400 mt-1 uppercase font-bold tracking-tighter"},"PDF, DOCX, JPG (Max 20MB)",-1))]),g.value.length>0?(a(),n("div",He,[(a(!0),n($,null,T(g.value,(j,P)=>(a(),w(U,{key:P,file:j,"show-delete":!0,onRemove:Is=>m(P)},null,8,["file","onRemove"]))),128))])):v("",!0)])]),e("div",Ee,[o(z,{onClick:Y,class:"px-6 py-2.5 text-sm font-bold text-gray-500 hover:text-gray-700 transition-colors"},{default:F(()=>[...r[6]||(r[6]=[E(" Bekor qilish ",-1)])]),_:1}),o(z,{onClick:f,disabled:l(c).loading,class:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-2.5 rounded-xl font-bold text-sm shadow-lg shadow-blue-200 disabled:bg-blue-300 flex items-center gap-2 transition-all active:scale-95"},{default:F(()=>[l(c).loading?(a(),w(K,{key:0,size:"sm"})):v("",!0),e("span",Je,h(l(c).loading?"Yuborilmoqda...":"Saqlash va yuborish"),1)]),_:1},8,["disabled"])])])}}},O=N(Oe,[["__scopeId","data-v-ef263713"]]),Le={key:0},Ne={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},Qe={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-sm rounded-lg mt-4"},Xe={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},Ge={class:"font-bold text-gray-800 text-base flex items-center gap-2"},Ke={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},We={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},Ze={class:"relative shrink-0"},es={class:"flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 text-white font-semibold text-sm shadow-md"},ss={key:0,class:"absolute -top-1 -right-1 bg-yellow-400 text-white p-0.5 rounded-full w-2 h-2 border-white shadow-sm",title:"Asosiy ijrochi"},ts={class:"flex flex-col min-w-0"},as={class:"flex items-center gap-2"},ls={class:"text-gray-900 font-semibold text-[15px] truncate group-hover:text-blue-700 transition-colors"},os={key:0,class:"text-[10px] bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded font-bold"},ns={class:"text-gray-500 text-xs truncate"},is={key:1,class:"p-[24px]"},rs={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},ds={key:0},cs={class:"grid grid-cols-2 gap-2"},us={key:2,class:"p-[24px]"},ms={class:"grid grid-cols-1 gap-4 pb-4"},ps={key:0},hs={class:"grid grid-cols-2 gap-2"},bs={key:3,class:"p-[24px] text-gray-500 text-center"},fs={class:"flex p-4 bg-[#F4F6FC] gap-3"},gs={__name:"TaskShowItem",props:{task:{type:Object,default:null}},setup(s){const t=s,d=Q(),c=te(),u=ae(()=>t.task?.responses?t.task.responses.find(C=>C.user===c.user?.id):null),g=()=>{u.value?d.open(O,{taskId:t.task.id,existingTask:u.value}):console.warn("Sizda hali javob mavjud emas yoki foydalanuvchi mos kelmadi")},b=()=>{t.task?.id&&d.open(O,{taskId:t.task.id})};return(C,i)=>{const S=M("UButton");return a(),n($,null,[s.task?(a(),n("div",Le,[e("div",Ne,[o(y,{label:"Bajarish muddati",value:l(I)(s.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),o(y,{label:"Topshiriq",value:s.task.subject.title},null,8,["value"]),o(y,{label:"Topshiriq mazmun",value:s.task.description,class:"col-span-2"},null,8,["value"])]),e("div",Qe,[e("div",Xe,[e("h3",Ge,[i[0]||(i[0]=e("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),i[1]||(i[1]=E(" Ijrochilar ",-1)),e("span",Ke,h(s.task.assignees?.length||0),1)])]),e("div",We,[(a(!0),n($,null,T(s.task.assignees,(p,_)=>(a(),n("div",{key:p.id,class:"group flex items-center gap-4 px-6 py-3 transition-all hover:bg-blue-50/50 cursor-pointer"},[e("div",Ze,[e("div",es,h(p.first_name?.[0]||"?"),1),_===0?(a(),n("div",ss)):v("",!0)]),e("div",ts,[e("div",as,[e("span",ls,h(p.last_name)+" "+h(p.first_name),1),_===0?(a(),n("span",os," Mas'ul ")):v("",!0)]),e("span",ns,h(p.department_name),1)])]))),128))])]),i[2]||(i[2]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1))])):v("",!0),s.task.document?(a(),n("div",is,[e("div",rs,[o(y,{label:"Kelib tushgan raqam",value:s.task.document.in_number},null,8,["value"]),o(y,{label:"Chiqish raqami",value:s.task.document.out_number},null,8,["value"]),o(y,{label:"Hujjat nomi",value:s.task.document.title,class:"md:col-span-2"},null,8,["value"]),o(y,{label:"Hujjat nomi",value:s.task.document.summary,class:"md:col-span-2"},null,8,["value"]),o(y,{label:"Hujjatni Imzololovchi",value:s.task.document.signer},null,8,["value"]),o(y,{label:"Jurnal",value:s.task.document.journal.name},null,8,["value"])]),s.task.document.attachments?.length?(a(),n("div",ds,[i[3]||(i[3]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",cs,[(a(!0),n($,null,T(s.task.document.attachments,p=>(a(),w(U,{key:p.id,file:p},null,8,["file"]))),128))])])):v("",!0)])):v("",!0),i[7]||(i[7]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1)),s.task.responses&&s.task.responses.length?(a(),n("div",us,[(a(!0),n($,null,T(s.task.responses,p=>(a(),n("div",{key:p.id,class:"mb-6 border-b pb-4 last:border-none"},[e("div",ms,[o(y,{label:"Yuboruvchi",value:p.user_full_name},null,8,["value"]),o(y,{label:"Berilgan javob",value:p.description},null,8,["value"]),o(y,{label:"Berilgan javob sanasi",value:s.task.responses?.[0]?.created_at?l(I)(s.task.responses[0].created_at).format("DD MMMM YYYY HH:mm"):"Javob berilmagan"},null,8,["value"])]),p.files?.length?(a(),n("div",ps,[i[4]||(i[4]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",hs,[(a(!0),n($,null,T(p.files,_=>(a(),w(U,{key:_.id,file:_},null,8,["file"]))),128))])])):v("",!0)]))),128))])):(a(),n("div",bs," Hozircha javoblar mavjud emas. ")),R(e("div",fs,[R(o(S,{onClick:b,variant:"primary"},{default:F(()=>[o(l(me),{"stroke-width":"3",class:"text-white"}),i[5]||(i[5]=e("span",{class:"px-1"},"Javob kiritish",-1))]),_:1},512),[[A,!u.value]]),R(o(S,{onClick:g,variant:"primary",class:"bg-orange-500 hover:bg-orange-600"},{default:F(()=>[o(l(ce),{"stroke-width":"3",class:"text-white w-6 h-4"}),i[6]||(i[6]=e("span",{class:"px-1"},"Javobni tahrirlash",-1))]),_:1},512),[[A,u.value]])],512),[[A,s.task.status!=="done"]])],64)}}},ks=N(gs,[["__scopeId","data-v-69661a3d"]]),vs={class:"mx-auto"},xs={class:"flex items-center px-2 card-dark border-b"},ys=["onClick"],ws={class:"text-gray-700 font-semibold"},_s={class:"grid grid-cols-1 lg:grid-cols-12"},$s={class:"col-span-12 md:col-span-5 2xl:col-span-3"},js={class:"card-dark border-b-2 border-x shadow-sm"},Ts={class:"flex px-1 py-3 items-center border-b card-border justify-between"},Fs={class:"flex items-center"},Cs={class:"flex gap-1"},Ss={class:"h-[calc(100vh-8rem)] overflow-y-auto"},Ms={class:"col-span-12 md:col-span-7 2xl:col-span-9 space-y-2 px-3 h-[calc(100vh-4rem)] overflow-y-auto"},qs={class:"card-dark rounded-b border-b border-x"},Bs={key:0},Ds={key:1,class:"flex flex-col"},Ys={class:"grid grid-cols-3 p-6 gap-4"},Rs={class:"flex bg-[#F4F6FC] items-center gap-4 justify-end p-6"},Xs={__name:"InexecutionuserViews",setup(s){const t=X(),d=D("all"),c=D(null),u=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>t.all_tasks,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>t.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>t.in_progress,status:"in_progress"},{key:"in_confirmation",label:"Tasdiqlashda",color:"bg-gray-500",count:()=>t.in_confirmation,status:"in_confirmation"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>t.be_rejected,status:"be_rejected"}],g=async x=>{d.value=x.key,c.value=x.status||null,await t.setFilter("status",x.status)},b=le({due_date:"",assignee:"",created_at:""}),C=x=>t.setSelectedTask(x),i=x=>t.fetchAll(x),S=()=>t.setSelectedTask(null),p=async()=>{await t.setFilter("status",c.value||""),await t.setFilter("due_date",b.due_date),await t.setFilter("assignee",b.assignee),await t.setFilter("created_at",b.created_at)},_=async()=>{c.value=null,Object.keys(b).forEach(x=>b[x]=""),await p()};return oe(()=>t.fetchAll()),(x,m)=>{const q=M("UButton"),B=M("UDatePicker"),Y=ne("wave");return a(),n("div",vs,[e("div",xs,[(a(),n($,null,T(u,f=>e("div",{key:f.key,onClick:k=>g(f),class:H(["flex items-center gap-2 py-4 p-2 cursor-pointer transition hover:bg-gray-100 border-b-2",d.value===f.key?"border-b-blue-500":"border-b-transparent"])},[e("span",ws,h(f.label),1),e("span",{class:H(["text-white text-sm px-2 py-0.5 rounded-full font-semibold",f.color])},h(f.count()),3)],10,ys)),64))]),e("div",_s,[e("div",$s,[e("div",js,[e("div",Ts,[e("div",Fs,[R((a(),w(q,{onClick:S,variant:"hover"},{default:F(()=>[o(l(J),{"stroke-width":"2",class:"w-6 h-6"})]),_:1})),[[Y]]),m[2]||(m[2]=e("h2",{class:"text-[14px] p-2 font-bold uppercase text-[#282F3D]"},"Topshiriqlar",-1))]),e("div",Cs,[o(pe,{currentPage:l(t).pagination.currentPage,previous:l(t).pagination.previous,next:l(t).pagination.next,lastPage:Math.ceil(l(t).pagination.count/10),total:l(t).pagination.count,loading:l(t).loading,onChange:i},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),e("div",Ss,[(a(!0),n($,null,T(l(t).tasks,f=>(a(),w(Ce,{key:f.id,task:f,active:l(t).selectedTask?.id===f.id,onSelect:C},null,8,["task","active"]))),128)),m[3]||(m[3]=e("div",{class:"h-24 w-full"},null,-1))])])]),e("div",Ms,[e("div",qs,[l(t).selectedTask?(a(),n("div",Bs,[m[4]||(m[4]=e("div",{class:"flex px-1 py-2 items-center border-b card-border justify-between"},[e("h2",{class:"text-[14px] p-3 font-bold uppercase text-[#282F3D]"},"Biriktirilgan topshiriq"),e("div",{class:"flex items-center gap-2"})],-1)),o(ks,{task:l(t).selectedTask},null,8,["task"])])):(a(),n("div",Ds,[e("div",null,[m[5]||(m[5]=e("div",{class:"flex p-3 items-center card-border border-b justify-between"},[e("h2",{class:"text-[14px] py-2 font-bold uppercase text-[#282F3D]"},"Qidirish")],-1)),e("div",Ys,[o(B,{modelValue:b.due_date,"onUpdate:modelValue":m[0]||(m[0]=f=>b.due_date=f),placeholder:"Topshiriq bajarish muddati"},null,8,["modelValue"]),o(B,{modelValue:b.created_at,"onUpdate:modelValue":m[1]||(m[1]=f=>b.created_at=f),placeholder:"Topshiriq yuborilgan sana"},null,8,["modelValue"])])]),e("div",Rs,[o(q,{class:"flex items-center",onClick:_},{default:F(()=>[o(l(he),{"stroke-width":"2.5",class:"w-5 h-5"}),m[6]||(m[6]=e("span",{class:"px-2"},"Tozalash",-1))]),_:1}),o(q,{variant:"primary",class:"flex items-center",onClick:p},{default:F(()=>[o(l(J),{"stroke-width":"2.5",class:"w-5 h-5"}),m[7]||(m[7]=e("span",{class:"px-2"},"Qidirish",-1))]),_:1})])]))]),m[8]||(m[8]=e("div",{class:"w-full h-48"},null,-1))])])])}}};export{Xs as default};
