import{M as L}from"./MultiColumnUserSelect-BHy0ulAh.js";import{B as Q}from"./BaseCrudTable-BSc-cSqg.js";import{k as V,B,a as o,o as l,b as t,v as c,q as v,F as w,C as S,f as d,O as M,n as j,x as I,d as C,c as $,Z as O,j as k,g as n,h as p,D,_ as J,e as R,r as q,M as E,Q as K,l as z}from"./index-DirDpiKz.js";import{_ as Z}from"./UPagination-DJxMvXfm.js";import{u as H}from"./taskStore-j1hbrova.js";import{u as G}from"./usersStore-V3-vT8sK.js";import{_ as x,S as W}from"./UInfoItem-CrU6A23y.js";import{_ as U}from"./UFileCard-CifhKv0q.js";import{T as X}from"./trash-2-Dshkx7mY.js";/* empty css                                                                      */import"./chevron-left-E387xrtc.js";import"./chevron-right-Dqrbvz1g.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=V("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=V("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),st={class:"px-3 py-4"},at={class:"flex flex-col"},lt={class:"text-sm font-extrabold"},ot={class:"text-xs text-[#697696]"},nt={class:"px-3 py-4 max-w-xs"},it=["title"],rt={class:"px-3 py-4"},dt={key:0,class:"flex flex-col gap-1"},ct={key:0,class:"text-xs text-blue-500 font-bold pl-2"},ut={class:"px-3 py-4 text-sm text-[#697696]"},mt={class:"flex flex-col"},gt={class:"px-3 py-4 text-sm text-[#697696]"},bt={class:"flex flex-col"},ht={class:"px-3 py-4"},ft={__name:"MonitoringItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(e){const s=e,_=B(()=>({in_progress:"bg-blue-100 text-blue-700",in_confirmation:"bg-amber-100 text-amber-700",done:"bg-emerald-100 text-emerald-700",be_rejected:"bg-rose-100 text-rose-700"})[s.task.status]||"bg-gray-100 text-gray-700"),y=B(()=>({in_progress:"Jarayonda",in_confirmation:"Tasdiqlashda",done:"Bajarildi",be_rejected:"Bajarilmagan"})[s.task.status]||s.task.status);return(g,h)=>(l(),o("tr",{class:j(["divide-x",[e.active?"bg-[#4076FF0D]":"","hover:bg-[#4076FF05] cursor-pointer transition-colors"]]),onClick:h[0]||(h[0]=a=>g.$emit("select",e.task))},[t("td",st,[t("div",at,[t("span",lt,c(e.task.document.in_number),1),t("span",ot,c(e.task.document.out_number),1)])]),t("td",nt,[t("span",{class:"text-sm font-medium text-black line-clamp-2",title:e.task.document.summary},c(e.task.document.summary),9,it)]),t("td",rt,[e.task.assignees&&e.task.assignees.length>0?(l(),o("div",dt,[(l(!0),o(w,null,S(e.task.assignees.slice(0,1),a=>(l(),o("div",{key:a.id,class:"text-[13px] font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded-md w-fit"},c(a.last_name)+" "+c(a.first_name[0])+"."+c(a.father_name?a.father_name[0]+".":""),1))),128)),e.task.assignees.length>2?(l(),o("span",ct,c(e.task.assignees.length-2)+" ijrochi ",1)):v("",!0)])):v("",!0)]),t("td",ut,[t("div",mt,[t("span",null,c(d(M)(e.task.document.created_at).format("DD MMMM YYYY")),1)])]),t("td",gt,[t("div",bt,[t("span",{class:j(e.task.is_overdue?"text-red-500 font-bold":"font-medium")},c(d(M)(e.task.due_date).format("DD MMMM YYYY")),3)])]),t("td",ht,[t("span",{class:j(["px-3 py-1 rounded-full text-[12px] tracking-wider",_.value])},c(y.value),3)])],2))}},xt={class:"w-[90vw] md:w-[400px] flex flex-col bg-white rounded-2xl shadow-2xl overflow-hidden"},vt={class:"text-lg font-black text-gray-800 uppercase tracking-tight"},yt={class:"text-sm text-gray-500 mt-1 px-4 leading-relaxed"},pt={class:"font-bold underline"},kt={class:"p-4 bg-white flex flex-col gap-2"},_t={__name:"TaskResponsStatusForm",props:{taskId:{type:Number,required:!0},targetStatus:{type:String,required:!0}},setup(e){const s=e,_=I(),y=H(),g=C(!1),h=async()=>{g.value=!0;try{(await y.updateTaskStatus(s.taskId,s.targetStatus)).success&&(_.close(),await y.fetchAll())}catch(a){console.error(a)}finally{g.value=!1}};return(a,m)=>(l(),o("div",xt,[t("div",{class:j(["p-6 text-center border-b",e.targetStatus==="done"?"bg-emerald-50":"bg-amber-50"])},[t("div",{class:j(["inline-flex p-3 rounded-full mb-3",e.targetStatus==="done"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"])},[e.targetStatus==="done"?(l(),$(d(O),{key:0,class:"w-8 h-8"})):(l(),$(d(et),{key:1,class:"w-8 h-8"}))],2),t("h3",vt,c(e.targetStatus==="done"?"Tasdiqlaysizmi?":"Qayta ishlashga qaytarasizmi?"),1),t("p",yt,[m[1]||(m[1]=k(" Ushbu topshiriq holatini ",-1)),t("span",pt,c(e.targetStatus==="done"?"Bajarildi":"Qayta ishlash"),1),m[2]||(m[2]=k(" ga o'zgartirmoqchisiz. ",-1))])],2),t("div",kt,[n(D,{onClick:h,disabled:g.value,class:j([e.targetStatus==="done"?"bg-emerald-600 hover:bg-emerald-700":"bg-amber-600 hover:bg-amber-700","w-full text-white py-3.5 rounded-xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95 disabled:opacity-50"])},{default:p(()=>[g.value?(l(),$(d(tt),{key:0,class:"w-4 h-4 animate-spin"})):v("",!0),m[3]||(m[3]=k(" Ha, tasdiqlayman ",-1))]),_:1},8,["disabled","class"]),n(D,{onClick:m[0]||(m[0]=r=>d(_).close()),class:"w-full py-3 text-sm font-bold text-gray-400 hover:text-gray-600 transition-colors"},{default:p(()=>[...m[4]||(m[4]=[k(" Bekor qilish ",-1)])]),_:1})])]))}},wt={key:0},$t={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},jt={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-lg rounded-lg mt-4"},St={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},Mt={class:"font-bold text-gray-800 text-base flex items-center gap-2"},Bt={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},Ct={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},qt={class:"max-h-[280px] overflow-y-auto custom-scrollbar divide-y divide-gray-50"},Ft={class:"relative shrink-0"},Tt={class:"flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 text-white font-semibold text-sm shadow-md"},Yt={key:0,class:"absolute -top-1 -right-1 bg-yellow-400 text-white p-0.5 rounded-full w-2 h-2 border-white shadow-sm",title:"Asosiy ijrochi"},Dt={class:"flex flex-col min-w-0"},zt={class:"flex items-center gap-2"},Ut={class:"text-gray-900 font-semibold text-[15px] truncate group-hover:text-blue-700 transition-colors"},Vt={key:0,class:"text-[10px] bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded font-bold"},It={class:"text-gray-500 text-xs truncate"},Ht={key:1,class:"p-[24px] border-gray-100 bg-white shadow-sm rounded-lg"},At={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},Pt={key:0},Nt={class:"grid grid-cols-1 gap-2"},Lt={key:2,class:"p-[24px] border-gray-100 bg-white rounded-lg"},Qt={class:"grid grid-cols-1 gap-4 pb-4"},Ot={key:0},Jt={class:"grid grid-cols-1 gap-2"},Rt={key:3,class:"p-[24px] text-gray-500 text-center"},Et={key:4,class:"grid grid-cols-1 gap-4 px-4"},Kt={__name:"MonitoringShow",props:{task:{type:Object,default:null}},setup(e){const s=e,_=I(),y=R();B(()=>s.task?.responses?s.task.responses.find(h=>h.user===y.user?.id):null);const g=h=>{_.open(_t,{taskId:s.task.id,targetStatus:h,taskTitle:s.task.subject?.title})};return(h,a)=>{const m=q("UButton");return l(),o(w,null,[e.task?(l(),o("div",wt,[t("div",$t,[n(x,{label:"Bajarish muddati",value:d(M)(e.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),n(x,{label:"Topshiriq",value:e.task.subject.title},null,8,["value"]),n(x,{label:"Topshiriq mazmun",value:e.task.description,class:"col-span-2"},null,8,["value"])]),t("div",jt,[t("div",St,[t("h3",Mt,[a[2]||(a[2]=t("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),a[3]||(a[3]=k(" Ijrochilar ",-1)),t("span",Bt,c(e.task.assignees?.length||0),1)])]),t("div",Ct,[t("div",qt,[(l(!0),o(w,null,S(e.task.assignees,(r,i)=>(l(),o("div",{key:r.id,class:"group flex items-center gap-4 px-6 py-3 transition-all hover:bg-blue-50/50 cursor-pointer"},[t("div",Ft,[t("div",Tt,c(r.first_name?.[0]||"?"),1),i===0?(l(),o("div",Yt)):v("",!0)]),t("div",Dt,[t("div",zt,[t("span",Ut,c(r.last_name)+" "+c(r.first_name),1),i===0?(l(),o("span",Vt," Mas'ul ")):v("",!0)]),t("span",It,c(r.department_name),1)])]))),128))])])]),a[4]||(a[4]=t("div",{class:"w-full h-14"},null,-1))])):v("",!0),e.task.document?(l(),o("div",Ht,[t("div",At,[n(x,{label:"Kelib tushgan raqam",value:e.task.document.in_number},null,8,["value"]),n(x,{label:"Chiqish raqami",value:e.task.document.out_number},null,8,["value"]),n(x,{label:"Hujjat nomi",value:e.task.document.title,class:"md:col-span-2"},null,8,["value"]),n(x,{label:"Hujjat nomi",value:e.task.document.summary,class:"md:col-span-2"},null,8,["value"]),n(x,{label:"Hujjatni Imzololovchi",value:e.task.document.signer},null,8,["value"]),n(x,{label:"Jurnal",value:e.task.document.journal.name},null,8,["value"])]),e.task.document.attachments?.length?(l(),o("div",Pt,[a[5]||(a[5]=t("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),t("div",Nt,[(l(!0),o(w,null,S(e.task.document.attachments,r=>(l(),$(U,{key:r.id,file:r},null,8,["file"]))),128))])])):v("",!0)])):v("",!0),a[9]||(a[9]=t("div",{class:"w-full h-14"},null,-1)),e.task.responses&&e.task.responses.length?(l(),o("div",Lt,[(l(!0),o(w,null,S(e.task.responses,r=>(l(),o("div",{key:r.id,class:"mb-6 pb-4 last:border-none"},[t("div",Qt,[n(x,{label:"Yuboruvchi",value:r.user_full_name},null,8,["value"]),n(x,{label:"Berilgan javob",value:r.description},null,8,["value"]),n(x,{label:"Berilgan javob sanasi",value:e.task.responses?.[0]?.created_at?d(M)(e.task.responses[0].created_at).format("DD MMMM YYYY HH:mm"):"Javob berilmagan"},null,8,["value"])]),r.files?.length?(l(),o("div",Ot,[a[6]||(a[6]=t("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),t("div",Jt,[(l(!0),o(w,null,S(r.files,i=>(l(),$(U,{key:i.id,file:i},null,8,["file"]))),128))])])):v("",!0)]))),128))])):(l(),o("div",Rt," Hozircha javoblar mavjud emas. ")),e.task.responses?.length?(l(),o("div",Et,[e.task.status==="in_confirmation"?(l(),$(m,{key:0,onClick:a[0]||(a[0]=r=>g("done")),variant:"primary"},{default:p(()=>[...a[7]||(a[7]=[k(" Nazoratdan yechish ",-1)])]),_:1})):v("",!0),e.task.status==="in_confirmation"?(l(),$(m,{key:1,onClick:a[1]||(a[1]=r=>g("in_progress")),variant:"secondary"},{default:p(()=>[...a[8]||(a[8]=[k(" Qata ishlashga yuborish ",-1)])]),_:1})):v("",!0)])):v("",!0)],64)}}},Zt=J(Kt,[["__scopeId","data-v-e344d7ff"]]),Gt={class:"mx-auto bg-[#F8FAFC] h-screen overflow-y-auto"},Wt={class:"flex items-center gap-1 px-4 bg-white border-b shadow-sm sticky top-0 z-20"},Xt=["onClick"],te={class:"font-bold text-[13px] uppercase tracking-wide"},ee={class:"grid grid-cols-12 gap-0 p-6"},se={class:"transition-all col-span-12 ease-in-out will-change-transform duration-300"},ae={class:"space-y-4 py-4"},le={class:"flex flex-row justify-between gap-4"},oe={class:"flex flex-row w-9/12 items-center gap-4"},ne={class:"flex items-center gap-4"},ie={class:"relative"},re={class:"p-4 sticky bottom-0"},_e={__name:"MonitoringViews",setup(e){const s=H(),_=E(),y=G(),g=C("all"),h=C(null),a=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>s.all_tasks,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>s.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>s.in_progress,status:"in_progress"},{key:"in_confirmation",label:"Tasdiqlashda",color:"bg-gray-500",count:()=>s.in_confirmation,status:"in_confirmation"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>s.be_rejected,status:"be_rejected"}],m=u=>{s.setSelectedTask(u),_.openDrawer(Zt,{task:u},{title:"Topshiriq tafsilotlari",side:"right"})},r=async u=>{g.value=u.key,h.value=u.status||null,await s.setFilter("status",u.status)},i=K({due_date:"",assignee:[],created_at:""}),A=u=>s.fetchAll(u),P=u=>{i.assignee.includes(u)?i.assignee=[]:i.assignee=[u]},F=async()=>{const u=i.assignee.length>0?i.assignee[0]:null;await s.setFilter("status",h.value||""),await s.setFilter("due_date",i.due_date),await s.setFilter("assignee",u),await s.setFilter("created_at",i.created_at),await s.fetchAll(1)},N=async()=>{h.value=null,Object.keys(i).forEach(u=>i[u]=""),await F()};return z(()=>s.fetchAll()),z(()=>y.fetchUsers()),(u,f)=>{const T=q("UDatePicker"),Y=q("UButton");return l(),o("div",Gt,[t("div",Wt,[(l(),o(w,null,S(a,b=>t("div",{key:b.key,onClick:de=>r(b),class:j(["flex items-center gap-3 py-5 px-4 cursor-pointer transition-all duration-200 border-b-2",g.value===b.key?"border-blue-600 bg-blue-50/50":"border-transparent hover:bg-gray-50 text-gray-500"])},[t("span",te,c(b.label),1),t("span",{class:j(["text-white text-xs px-2.5 py-1 rounded-lg font-bold shadow-sm",b.color])},c(b.count()),3)],10,Xt)),64))]),t("div",ee,[t("div",se,[t("div",ae,[f[3]||(f[3]=t("div",{class:"flex items-center justify-between"},[t("h2",{class:"text-sm font-black uppercase text-slate-700 flex items-center gap-2"},[t("div",{class:"w-1 h-5 bg-blue-600 rounded-full"}),k(" Topshiriqlar Nazorati ")])],-1)),t("div",le,[t("div",oe,[n(L,{options:d(y).users,"selected-ids":i.assignee,onSelect:P},null,8,["options","selected-ids"]),n(T,{modelValue:i.due_date,"onUpdate:modelValue":f[0]||(f[0]=b=>i.due_date=b),placeholder:"Bajarish muddati"},null,8,["modelValue"]),n(T,{modelValue:i.created_at,"onUpdate:modelValue":f[1]||(f[1]=b=>i.created_at=b),placeholder:"Ro'yxatga olingan sana"},null,8,["modelValue"])]),t("div",ne,[n(Y,{variant:"hover",onClick:N,class:"!p-2"},{default:p(()=>[n(d(X),{class:"w-5 h-5 text-gray-400"})]),_:1}),n(Y,{variant:"primary",class:"justify-center",onClick:F},{default:p(()=>[n(d(W),{class:"w-4 h-4 mr-2"}),f[2]||(f[2]=k(" Qidirish ",-1))]),_:1})])])]),t("div",ie,[n(Q,null,{thead:p(()=>[...f[4]||(f[4]=[t("th",{class:"sticky top-0 bg-white table-header"},"Hujjat",-1),t("th",{class:"sticky top-0 bg-white table-header"},"Mazmuni",-1),t("th",{class:"sticky top-0 bg-white table-header"},"Ijrochi",-1),t("th",{class:"sticky top-0 bg-white table-header"},"Yuborilgan",-1),t("th",{class:"sticky top-0 bg-white table-header"},"Muddat",-1),t("th",{class:"sticky top-0 bg-white table-header"},"Holati",-1)])]),tbody:p(()=>[(l(!0),o(w,null,S(d(s).tasks,b=>(l(),$(ft,{key:b.id,task:b,active:d(s).selectedTask?.id===b.id,onSelect:m},null,8,["task","active"]))),128))]),pagination:p(()=>[t("div",re,[n(Z,{currentPage:d(s).pagination.currentPage,previous:d(s).pagination.previous,next:d(s).pagination.next,lastPage:Math.ceil(d(s).pagination.count/10),total:d(s).pagination.count,loading:d(s).loading,onChange:A},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),_:1})]),f[5]||(f[5]=t("div",{class:"w-full h-44"},null,-1))])])])}}};export{_e as default};
