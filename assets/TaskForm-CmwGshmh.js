import{k as V,x as O,d as v,A as S,C as L,l as P,r as y,a as g,o as h,b as i,g as n,v as m,h as x,f as a,X as Y,w as K,Y as X,t as Z,Z as G,F as J,B as Q,j as q}from"./index-5YwSdCnv.js";import{u as R}from"./taskStore-CA_W_gp0.js";import{u as W}from"./usersStore-Da2g4WZ0.js";import{u as ee}from"./subjectStore-BhXUWEqg.js";import{u as se}from"./useFormValidate-CYKOA1hY.js";import{M as te}from"./MultiColumnUserSelect-DKD9eij1.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=V("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=V("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),oe={class:"w-[100vw] md:w-[80vw] 2xl:w-[50vw] h-[90vh] flex flex-col bg-white rounded-xl shadow-lg"},le={class:"flex justify-between items-center p-4 border-b"},ne={class:"font-bold uppercase text-md"},re={class:"p-6 flex-1 h-[calc(80vh-64px)] overflow-y-scroll space-y-6"},de={class:"grid grid-cols-2 gap-4"},ue={class:"flex items-center pt-2 justify-start gap-2 col-span-2"},ce={class:"relative inline-flex items-center cursor-pointer"},pe={class:"flex flex-col gap-2"},me={class:"flex flex-col gap-2"},fe={key:0,class:"flex items-center gap-3 w-full px-4 py-3 bg-blue-50 border border-blue-200 rounded-xl shadow-sm animate-pulse"},ge={class:"w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center"},he={class:"w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-sm"},xe={class:"flex flex-col flex-1 leading-tight"},be={class:"text-sm font-medium text-blue-900"},_e={class:"text-xs text-blue-600"},ve={class:"flex justify-end gap-3 p-4 border-t"},qe={__name:"TaskForm",props:{id:Number,existingTask:Object},setup(k){const l=k,M=O(),w=R(),u=W(),b=ee(),c=v(!1),d=v(!1),f=v({}),{form:t,errors:p,validate:C,resetForm:B}=se({document_id:l.id,subject_id:null,due_date:"",description:"",assignees_ids:[]},{subject_id:{required:!0,message:"Topshiriq tanlanishi majburiy"},due_date:{required:!0,custom:s=>{if(!s)return"Sana majburiy";const e=new Date(s).setHours(0,0,0,0),r=new Date().setHours(0,0,0,0);return e<r?"Sana bugundan oldingi boâ€˜lishi mumkin emas":""}},description:{required:!0,message:"Mazmuni majburiy"},assignees_ids:{custom:s=>d.value?"":!Array.isArray(s)||!s.length?"Kamida bitta ijrochi tanlang":""}});S(()=>[u.users,u.searchUsers],([s,e])=>{[...s,...e].forEach(r=>{r?.id&&(f.value[r.id]=r)})},{immediate:!0,deep:!0});const A=L(()=>{const s={...f.value};return l.existingTask?.assignees&&l.existingTask.assignees.forEach(e=>{e?.id&&(s[e.id]=e,f.value[e.id]||(f.value[e.id]=e))}),s}),_=s=>A.value[s],F=s=>{const e=_(s);return e?`${e.first_name} ${e.last_name}`:"Unknown"},D=s=>{const e=_(s);return e?`${e.first_name?.[0]||""}${e.last_name?.[0]||""}`:"?"},E=s=>_(s)?.department?.name||"";P(async()=>{await Promise.all([u.fetchUsersForSelect(),b.fetchAll()]),l.existingTask&&(t.document_id=l.existingTask.document?.id||null,t.subject_id=l.existingTask.subject?.id||null,t.due_date=l.existingTask.due_date||"",t.description=l.existingTask.description||"",t.assignees_ids=l.existingTask.assignees?.map(s=>s.id)||[],d.value=t.assignees_ids.length===u.searchUsers.length)}),S(d,s=>{});const j=()=>M.close(),T=()=>{B(),j(),d.value=!1},I=s=>{const e=t.assignees_ids.indexOf(s);e===-1?t.assignees_ids.push(s):t.assignees_ids.splice(e,1)},N=s=>{t.assignees_ids=t.assignees_ids.filter(e=>e!==s)},$=s=>{typeof s=="object"&&Object.keys(s).forEach(e=>{p[e]=Array.isArray(s[e])?s[e].join(", "):s[e]})},U=async()=>{if(C()){c.value=!0;try{const s={document_id:t.document_id,subject_id:t.subject_id,due_date:t.due_date,description:t.description,assignees_ids:d.value?["all-users"]:t.assignees_ids};console.log(s);const e=l.existingTask?await w.updateTask(l.existingTask.id,s):await w.createTask(s);e.success?T():$(e.error)}catch(s){console.error(s)}finally{c.value=!1}}};return(s,e)=>{const r=y("UButton"),z=y("USelect"),H=y("UTextarea");return h(),g("div",oe,[i("div",le,[i("p",ne,m(k.existingTask?"Topshiriqni tahrirlash":"Topshiriq yaratish"),1),n(r,{class:"bg-gray-700 rounded-full p-1",onClick:j},{default:x(()=>[n(a(Y),{class:"w-3 h-3 text-white","stroke-width":"3"})]),_:1})]),i("div",re,[i("form",{onSubmit:K(U,["prevent"]),class:"flex flex-col gap-4"},[i("div",de,[n(z,{modelValue:a(t).subject_id,"onUpdate:modelValue":e[0]||(e[0]=o=>a(t).subject_id=o),options:a(b).subjects,label:"Topshiriq",placeholder:"Topshiriq tanlang","option-label":"title","option-value":"id",loading:a(b).loading,error:a(p).subject_id},null,8,["modelValue","options","loading","error"]),n(X,{modelValue:a(t).due_date,"onUpdate:modelValue":e[1]||(e[1]=o=>a(t).due_date=o),label:"Boshlanish sanasi",placeholder:"Sanani tanlang",error:a(p).due_date},null,8,["modelValue","error"]),i("div",ue,[e[7]||(e[7]=i("span",{class:"text-md font-medium"},"Barchasini Ijrochilarni tanlash",-1)),i("label",ce,[Z(i("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":e[2]||(e[2]=o=>d.value=o)},null,512),[[G,d.value]]),e[5]||(e[5]=i("div",{class:"w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-blue-500 peer-focus:ring-2 peer-focus:ring-blue-300 transition-colors"},null,-1)),e[6]||(e[6]=i("div",{class:"absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full peer-checked:translate-x-full transition-transform shadow"},null,-1))])])]),i("div",pe,[n(te,{options:a(u).searchUsers,"selected-ids":a(t).assignees_ids,label:"Ijrochilar",error:a(p).assignees_ids,onSelect:I,onSearch:e[3]||(e[3]=o=>a(u).fetchUsersForSelect(o))},null,8,["options","selected-ids","error"]),i("div",me,[d.value?(h(),g("div",fe,[i("div",ge,[n(a(ae),{class:"w-6 h-6"})]),e[8]||(e[8]=i("div",{class:"flex flex-col flex-1"},[i("span",{class:"text-sm font-bold text-blue-900"},"Barcha xodimlar tanlandi"),i("span",{class:"text-xs text-blue-700"},"Topshiriq tizimdagi barcha faol ijrochilarga yuboriladi")],-1))])):(h(!0),g(J,{key:1},Q(a(t).assignees_ids,o=>(h(),g("div",{key:o,class:"relative flex items-center gap-3 w-full px-4 py-2 bg-blue-50 border border-blue-200 rounded-xl"},[i("div",he,m(D(o)),1),i("div",xe,[i("span",be,m(F(o)),1),i("span",_e,m(E(o)),1)]),n(r,{type:"button",onClick:ye=>N(o)},{default:x(()=>[n(a(ie),{class:"w-5 h-5 text-gray-400"})]),_:1},8,["onClick"])]))),128))])]),n(H,{modelValue:a(t).description,"onUpdate:modelValue":e[4]||(e[4]=o=>a(t).description=o),label:"Topshiriq mazmuni",rows:"4",placeholder:"Topshiriq mazmunini kiriting...",error:a(p).description},null,8,["modelValue","error"])],32)]),i("div",ve,[n(r,{variant:"ghost",onClick:T},{default:x(()=>[...e[9]||(e[9]=[q("Bekor qilish",-1)])]),_:1}),n(r,{variant:"primary",loading:c.value,disabled:c.value,onClick:U},{default:x(()=>[q(m(c.value?"Yuborilmoqda...":"Saqlash va yuborish"),1)]),_:1},8,["loading","disabled"])])])}}};export{qe as _};
