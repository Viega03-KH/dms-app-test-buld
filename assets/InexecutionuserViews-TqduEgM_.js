import{k as K,a as l,o as a,b as e,v as d,f as o,L as P,g as i,n as Y,O as R,y as Q,_ as J,x as U,d as M,j as V,t as E,q as $,P as G,J as _,K as j,w as W,e as Z,D as ee,c as C,h as B,r as z,N as te,l as se,s as ae}from"./index-CLFv_Ssa.js";import{H as oe}from"./history-D26UGNIP.js";import{_ as k,a as H,S as N}from"./UFileCard-CaxevS1P.js";import{u as L}from"./taskStore-C9f57ogL.js";import{u as le,X as O}from"./useFormValidate-Dl-5tU3h.js";import{T as X}from"./trash-2-Djc1Xy6H.js";import{C as ie}from"./cloud-upload-CE6v4ZCw.js";import{P as ne}from"./plus-C8rSrBAw.js";import{S as re}from"./square-pen-DqC3IW3m.js";import{_ as de}from"./UPagination-CmtPXPhn.js";import"./chevron-left-mvTBqVOE.js";import"./chevron-right-BJZ3BHcr.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=K("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),ue={class:"flex flex-row"},pe={class:"flex-1 min-w-0"},be={class:"flex flex-row items-center justify-between pb-2"},me={class:"text-sm font-extrabold text-black"},he={class:"text-sm font-medium text-[#697696]"},fe={class:"flex flex-col gap-y-2"},ge={class:"flex flex-row items-center justify-between"},xe={class:"flex-1 min-w-0 truncate text-sm font-bold text-black"},ve={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},ke={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},ye={class:"inline-block card-dark border text-[14px] font-semibold text-black rounded-[10px] px-3 py-2 w-fit"},_e="task card-dark border-b px-3 py-4 cursor-pointer hover:bg-[#4076FF0D]",we={__name:"TaskListItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(s){return(t,p)=>(a(),l("div",{onClick:p[0]||(p[0]=b=>t.$emit("select",s.task)),class:Y([_e,s.active?"bg-[#4076FF0D]":""])},[e("div",ue,[e("div",pe,[e("div",be,[e("h4",me,d(s.task.document.in_number),1),e("h4",he,d(o(P)(s.task.doc_data).format("DD MMMM YYYY")),1)]),e("div",fe,[e("div",ge,[e("span",xe,d(s.task.subject.title),1),i(o(oe),{class:"w-5 h-5 text-blue-500"})]),e("span",ve,d(s.task.document.summary),1),e("span",ke," Bajarish mudati: "+d(o(P)(s.task.due_date).format("DD MMMM YYYY")),1),e("div",ye,d(s.task.assignees[0].father_name[0])+"."+d(s.task.assignees[0].first_name[0])+"."+d(s.task.assignees[0].last_name),1)])])])],2))}},$e=s=>R.post("/task-responses/",s,{headers:{"Content-Type":"multipart/form-data"}}),je=(s,t)=>R.patch(`/task-responses/${s}/`,t,{headers:{"Content-Type":"multipart/form-data"}}),Fe=s=>R.delete(`/task-responses/${s}/`),Te=s=>R.delete(`/task-response-files/${s}/`),Ce=Q("taskResponse",{state:()=>({responses:[],loading:!1,error:null}),actions:{async addResponse(s){this.loading=!0,this.error=null;try{const t=await $e(s);return this.responses.unshift(t.data),t.data}catch(t){throw this.error=t.response?.data||"Yuborishda xatolik yuz berdi",t}finally{this.loading=!1}},async editResponse(s,t){this.loading=!0,this.error=null;try{const p=await je(s,t),b=this.responses.findIndex(y=>y.id===s);return b!==-1&&(this.responses[b]=p.data),p.data}catch(p){throw this.error=p.response?.data||"Tahrirlashda xatolik yuz berdi",p}finally{this.loading=!1}},async removeResponse(s){this.error=null;try{await Fe(s),this.responses=this.responses.filter(t=>t.id!==s)}catch(t){throw this.error=t.response?.data||"O'chirishda xatolik",t}},async deleteFile(s){try{await Te(s),this.responses.forEach(t=>{t.files&&(t.files=t.files.filter(p=>p.id!==s))})}catch(t){throw t}},clearResponses(){this.responses=[],this.error=null}}}),Se={class:"w-[100vw] md:w-[60vw] 2xl:w-[60vw] h-[90vh] flex flex-col bg-white rounded-xl shadow-lg overflow-hidden"},De={class:"flex justify-between items-center p-4 border-b bg-gray-50"},Me={class:"font-bold uppercase text-md text-gray-700 flex items-center gap-2"},Be={class:"p-6 flex-1 overflow-y-auto space-y-6 bg-white custom-scrollbar"},qe={class:"space-y-2"},Ye={key:0,class:"text-red-500 text-xs mt-1 font-medium"},Re={class:"space-y-3"},Ie={key:0,class:"space-y-2 mb-4"},Pe={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Ve={class:"flex items-center gap-3 overflow-hidden"},ze={class:"bg-blue-600 px-2 py-1 rounded text-[10px] font-bold text-white uppercase italic"},Ue={class:"text-xs text-gray-700 font-medium truncate"},He={class:"flex items-center gap-1"},Ne=["href","download"],Oe=["onClick"],Ae={class:"bg-blue-50 p-4 rounded-full mb-3 group-hover:bg-blue-100 transition-colors"},Je={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4"},Ee={class:"flex items-center gap-3 overflow-hidden"},Le={class:"bg-red-500 p-2 rounded text-[10px] font-bold text-white uppercase"},Xe={class:"text-xs text-gray-700 font-medium truncate"},Ke=["onClick"],Qe={class:"flex justify-end items-center gap-3 p-4 border-t bg-gray-50/50"},Ge=["disabled"],We={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},Ze={__name:"TaskResponsForm",props:{taskId:Number,existingTask:Object},setup(s){const t=s,p=U(),b=Ce(),y=L(),v=M([]),m=M(t.existingTask?.files||[]),F=M(null),{form:n,errors:w,validate:c,resetForm:T}=le({task_id:t.taskId||t.existingTask?.task,description:t.existingTask?.description||""},{task_id:{required:!0},description:{required:!0,message:"Javob izohini yozish majburiy"}}),g=f=>{const r=Array.from(f.target.files);v.value=[...v.value,...r]},u=f=>{v.value.splice(f,1)},S=async f=>{try{await b.deleteFile(f),m.value=m.value.filter(r=>r.id!==f)}catch{alert("Faylni o'chirib bo'lmadi")}},D=()=>p.close(),q=()=>{T(),v.value=[],D()},h=async()=>{if(!c())return;const f=new FormData;f.append("task_id",n.task_id),f.append("description",n.description),v.value.forEach(r=>{f.append("uploaded_files",r)});try{t.existingTask?.id?await b.editResponse(t.existingTask.id,f):await b.addResponse(f),q(),await y.fetchAll()}catch(r){console.error("Xatolik:",r)}};return(f,r)=>(a(),l("div",Se,[e("div",De,[e("p",Me,[r[2]||(r[2]=e("span",{class:"w-2 h-5 bg-blue-600 rounded-full"},null,-1)),V(" "+d(s.existingTask?"Hisobotni tahrirlash":"Topshiriq bo'yicha hisobot"),1)]),e("button",{onClick:D,class:"bg-gray-200 hover:bg-gray-300 rounded-full p-1.5 transition-colors"},[i(o(O),{class:"w-4 h-4 text-gray-600","stroke-width":"3"})])]),e("div",Be,[e("div",qe,[r[3]||(r[3]=e("label",{class:"block text-sm font-bold text-gray-700"},"Bajarilgan ishlar bo'yicha izoh",-1)),E(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=x=>o(n).description=x),rows:"6",class:Y(["w-full p-4 border rounded-xl focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all resize-none text-sm bg-gray-50/50",o(w).description?"border-red-500":"border-gray-200"]),placeholder:"Nimalar bajarilgani haqida batafsil yozing..."},null,2),[[G,o(n).description]]),o(w).description?(a(),l("p",Ye,d(o(w).description),1)):$("",!0)]),e("div",Re,[r[6]||(r[6]=e("label",{class:"block text-sm font-bold text-gray-700"},"Hujjatlarni biriktirish",-1)),m.value.length>0?(a(),l("div",Ie,[e("div",Pe,[(a(!0),l(_,null,j(m.value,x=>(a(),l("div",{key:x.id,class:"flex items-center justify-between p-3 bg-blue-50/30 rounded-xl border border-blue-100 group"},[e("div",Ve,[e("div",ze,d(x.extension),1),e("span",Ue,d(x.file.split("/").pop()),1)]),e("div",He,[e("a",{href:x.file,download:x.file.split("/").pop(),class:"p-1.5 text-blue-500 hover:bg-blue-100 rounded-lg transition-colors",title:"Yuklab olish"},[i(o(ce),{class:"w-4 h-4"})],8,Ne),e("button",{onClick:I=>S(x.id),type:"button",class:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",title:"Serverdan o'chirish"},[i(o(X),{class:"w-4 h-4"})],8,Oe)])]))),128))])])):$("",!0),e("div",{onClick:r[1]||(r[1]=x=>f.$refs.fileInput.click()),class:"group border border-dashed border-gray-200 rounded-2xl py-6 flex flex-col items-center justify-center cursor-pointer hover:border-blue-400 hover:bg-blue-50/50 transition-all active:scale-[0.98]"},[e("input",{type:"file",ref_key:"fileInput",ref:F,multiple:"",onChange:g,class:"hidden"},null,544),e("div",Ae,[i(o(ie),{class:"w-8 h-8 text-blue-600"})]),r[4]||(r[4]=e("span",{class:"text-sm font-semibold text-gray-600"},"Yangi fayllar tanlash",-1)),r[5]||(r[5]=e("p",{class:"text-[10px] text-gray-400 mt-1 uppercase font-bold tracking-tighter"},"PDF, DOCX, JPG (Max 20MB)",-1))]),v.value.length>0?(a(),l("div",Je,[(a(!0),l(_,null,j(v.value,(x,I)=>(a(),l("div",{key:I,class:"flex items-center justify-between p-3 bg-green-50 rounded-xl border border-green-100 shadow-sm"},[e("div",Ee,[e("div",Le,d(x.name.split(".").pop()),1),e("span",Xe,d(x.name),1)]),e("button",{onClick:W(Nt=>u(I),["stop"]),class:"text-gray-400 hover:text-red-500 p-1"},[i(o(O),{class:"w-4 h-4"})],8,Ke)]))),128))])):$("",!0)])]),e("div",Qe,[e("button",{onClick:q,class:"px-6 py-2.5 text-sm font-bold text-gray-500 hover:text-gray-700 transition-colors"}," Bekor qilish "),e("button",{onClick:h,disabled:o(b).loading,class:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-2.5 rounded-xl font-bold text-sm shadow-lg shadow-blue-200 disabled:bg-blue-300 flex items-center gap-2 transition-all active:scale-95"},[o(b).loading?(a(),l("div",We)):$("",!0),V(" "+d(o(b).loading?"Yuborilmoqda...":"Saqlash va yuborish"),1)],8,Ge)])]))}},A=J(Ze,[["__scopeId","data-v-baac035d"]]),et={key:0},tt={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},st={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-sm rounded-lg mt-4"},at={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},ot={class:"font-bold text-gray-800 text-base flex items-center gap-2"},lt={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},it={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},nt={class:"relative shrink-0"},rt={class:"flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 text-white font-semibold text-sm shadow-md transition-transform"},dt={class:"flex flex-col min-w-0"},ct={class:"text-gray-900 font-semibold text-[15px] leading-snug truncate group-hover:text-blue-700 transition-colors"},ut={class:"flex items-center gap-1.5 mt-0.5"},pt={class:"text-gray-500 text-xs truncate"},bt={key:1,class:"p-[24px]"},mt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},ht={key:0},ft={class:"grid grid-cols-2 gap-2"},gt={key:2,class:"p-[24px]"},xt={class:"grid grid-cols-1 gap-4 pb-4"},vt={key:0},kt={class:"grid grid-cols-2 gap-2"},yt={key:3,class:"p-[24px] text-gray-500 text-center"},_t={class:"flex p-4 bg-[#F4F6FC] gap-3"},wt={__name:"TaskShowItem",props:{task:{type:Object,default:null}},setup(s){const t=s,p=U(),b=Z(),y=ee(()=>t.task?.responses?t.task.responses.find(F=>F.user===b.user?.id):null),v=()=>{y.value?p.open(A,{taskId:t.task.id,existingTask:y.value}):console.warn("Sizda hali javob mavjud emas yoki foydalanuvchi mos kelmadi")},m=()=>{t.task?.id&&p.open(A,{taskId:t.task.id})};return(F,n)=>{const w=z("UButton");return a(),l(_,null,[s.task?(a(),l("div",et,[e("div",tt,[i(k,{label:"Bajarish muddati",value:o(P)(s.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),i(k,{label:"Topshiriq",value:s.task.subject.title},null,8,["value"]),i(k,{label:"Topshiriq mazmun",value:s.task.description,class:"col-span-2"},null,8,["value"])]),e("div",st,[e("div",at,[e("h3",ot,[n[0]||(n[0]=e("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),n[1]||(n[1]=V(" Ijrochilar ",-1)),e("span",lt,d(s.task.assignees?.length||0),1)])]),e("div",it,[(a(!0),l(_,null,j(s.task.assignees,c=>(a(),l("div",{key:c.id,class:"group flex items-center gap-4 px-6 py-3 transition-all duration-200 hover:bg-blue-50/50 border-b border-gray-50 last:border-none cursor-pointer"},[e("div",nt,[e("div",rt,d(c.first_name?c.first_name[0]:"?"),1)]),e("div",dt,[e("span",ct,d(c.last_name)+" "+d(c.first_name),1),e("div",ut,[e("span",pt,d(c.department_name),1)])])]))),128))])]),n[2]||(n[2]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1))])):$("",!0),s.task.document?(a(),l("div",bt,[e("div",mt,[i(k,{label:"Kelib tushgan raqam",value:s.task.document.in_number},null,8,["value"]),i(k,{label:"Chiqish raqami",value:s.task.document.out_number},null,8,["value"]),i(k,{label:"Hujjat nomi",value:s.task.document.title,class:"md:col-span-2"},null,8,["value"]),i(k,{label:"Hujjat nomi",value:s.task.document.summary,class:"md:col-span-2"},null,8,["value"]),i(k,{label:"Hujjatni Imzololovchi",value:s.task.document.signer},null,8,["value"]),i(k,{label:"Jurnal",value:s.task.document.journal.name},null,8,["value"])]),s.task.document.attachments?.length?(a(),l("div",ht,[n[3]||(n[3]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",ft,[(a(!0),l(_,null,j(s.task.document.attachments,c=>(a(),C(H,{key:c.id,file:c},null,8,["file"]))),128))])])):$("",!0)])):$("",!0),n[7]||(n[7]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1)),s.task.responses&&s.task.responses.length?(a(),l("div",gt,[(a(!0),l(_,null,j(s.task.responses,c=>(a(),l("div",{key:c.id,class:"mb-6 border-b pb-4 last:border-none"},[e("div",xt,[i(k,{label:"Yuboruvchi",value:c.user_full_name},null,8,["value"]),i(k,{label:"Berilgan javob",value:c.description},null,8,["value"])]),c.files?.length?(a(),l("div",vt,[n[4]||(n[4]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",kt,[(a(!0),l(_,null,j(c.files,T=>(a(),C(H,{key:T.id,file:T},null,8,["file"]))),128))])])):$("",!0)]))),128))])):(a(),l("div",yt," Hozircha javoblar mavjud emas. ")),e("div",_t,[y.value?(a(),C(w,{key:1,onClick:v,variant:"primary",class:"bg-orange-500 hover:bg-orange-600"},{default:B(()=>[i(o(re),{"stroke-width":"3",class:"text-white w-6 h-4"}),n[6]||(n[6]=e("span",{class:"px-1"},"Javobni tahrirlash",-1))]),_:1})):(a(),C(w,{key:0,onClick:m,variant:"primary"},{default:B(()=>[i(o(ne),{"stroke-width":"3",class:"text-white"}),n[5]||(n[5]=e("span",{class:"px-1"},"Javob kiritish",-1))]),_:1}))])],64)}}},$t=J(wt,[["__scopeId","data-v-d12a65f3"]]),jt={class:"mx-auto"},Ft={class:"flex items-center px-2 card-dark border-b"},Tt=["onClick"],Ct={class:"text-gray-700 font-semibold"},St={class:"grid grid-cols-1 lg:grid-cols-12"},Dt={class:"col-span-12 md:col-span-5 2xl:col-span-3"},Mt={class:"card-dark border-b-2 border-x shadow-sm"},Bt={class:"flex px-1 py-3 items-center border-b card-border justify-between"},qt={class:"flex items-center"},Yt={class:"flex gap-1"},Rt={class:"h-[calc(100vh-8rem)] overflow-y-auto"},It={class:"col-span-12 md:col-span-7 2xl:col-span-9 space-y-2 px-3 h-[calc(100vh-4rem)] overflow-y-auto"},Pt={class:"card-dark rounded-b border-b border-x"},Vt={key:0},zt={key:1,class:"flex flex-col"},Ut={class:"grid grid-cols-3 p-6 gap-4"},Ht={class:"flex bg-[#F4F6FC] items-center gap-4 justify-end p-6"},ts={__name:"InexecutionuserViews",setup(s){const t=L();U();const p=M("all"),b=M(null),y=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>t.pagination.count,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>t.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>t.in_progress,status:"in_progress"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>t.be_rejected,status:"be_rejected"}],v=async g=>{p.value=g.key,b.value=g.status||null,await t.setFilter("status",g.status)},m=te({due_date:"",assignee:"",created_at:""}),F=g=>t.setSelectedTask(g),n=g=>t.fetchAll(g),w=()=>t.setSelectedTask(null),c=async()=>{await t.setFilter("status",b.value||""),await t.setFilter("due_date",m.due_date),await t.setFilter("assignee",m.assignee),await t.setFilter("created_at",m.created_at)},T=async()=>{b.value=null,Object.keys(m).forEach(g=>m[g]=""),await c()};return se(()=>t.fetchAll()),(g,u)=>{const S=z("UButton"),D=z("UDatePicker"),q=ae("wave");return a(),l("div",jt,[e("div",Ft,[(a(),l(_,null,j(y,h=>e("div",{key:h.key,onClick:f=>v(h),class:Y(["flex items-center gap-2 py-4 p-2 cursor-pointer transition hover:bg-gray-100 border-b-2",p.value===h.key?"border-b-blue-500":"border-b-transparent"])},[e("span",Ct,d(h.label),1),e("span",{class:Y(["text-white text-sm px-2 py-0.5 rounded-full font-semibold",h.color])},d(h.count()),3)],10,Tt)),64))]),e("div",St,[e("div",Dt,[e("div",Mt,[e("div",Bt,[e("div",qt,[E((a(),C(S,{onClick:w,variant:"hover"},{default:B(()=>[i(o(N),{"stroke-width":"2",class:"w-6 h-6"})]),_:1})),[[q]]),u[2]||(u[2]=e("h2",{class:"text-[14px] p-2 font-bold uppercase text-[#282F3D]"},"Topshiriqlar",-1))]),e("div",Yt,[i(de,{currentPage:o(t).pagination.currentPage,previous:o(t).pagination.previous,next:o(t).pagination.next,lastPage:Math.ceil(o(t).pagination.count/10),total:o(t).pagination.count,loading:o(t).loading,onChange:n},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),e("div",Rt,[(a(!0),l(_,null,j(o(t).tasks,h=>(a(),C(we,{key:h.id,task:h,active:o(t).selectedTask?.id===h.id,onSelect:F},null,8,["task","active"]))),128)),u[3]||(u[3]=e("div",{class:"h-24 w-full"},null,-1))])])]),e("div",It,[e("div",Pt,[o(t).selectedTask?(a(),l("div",Vt,[u[4]||(u[4]=e("div",{class:"flex px-1 py-2 items-center border-b card-border justify-between"},[e("h2",{class:"text-[14px] p-3 font-bold uppercase text-[#282F3D]"},"Biriktirilgan topshiriq"),e("div",{class:"flex items-center gap-2"})],-1)),i($t,{task:o(t).selectedTask},null,8,["task"])])):(a(),l("div",zt,[e("div",null,[u[5]||(u[5]=e("div",{class:"flex p-3 items-center card-border border-b justify-between"},[e("h2",{class:"text-[14px] py-2 font-bold uppercase text-[#282F3D]"},"Qidirish")],-1)),e("div",Ut,[i(D,{modelValue:m.due_date,"onUpdate:modelValue":u[0]||(u[0]=h=>m.due_date=h),label:"",placeholder:"Hujjat bajarish muddati"},null,8,["modelValue"]),i(D,{modelValue:m.created_at,"onUpdate:modelValue":u[1]||(u[1]=h=>m.created_at=h),label:"",placeholder:"Ro`yxatga olingan sana"},null,8,["modelValue"])])]),e("div",Ht,[i(S,{class:"flex items-center",onClick:T},{default:B(()=>[i(o(X),{"stroke-width":"2.5",class:"w-5 h-5"}),u[6]||(u[6]=e("span",{class:"px-2"},"Tozalash",-1))]),_:1}),i(S,{variant:"primary",class:"flex items-center",onClick:c},{default:B(()=>[i(o(N),{"stroke-width":"2.5",class:"w-5 h-5"}),u[7]||(u[7]=e("span",{class:"px-2"},"Qidirish",-1))]),_:1})])]))]),u[8]||(u[8]=e("div",{class:"w-full h-48"},null,-1))])])])}}};export{ts as default};
