import{g as e,f as a,h as s,u as t,_ as l,b as i,a as r}from"./index-Dz9Hx4OQ.js";import{A as o,D as n,e as d,I as c,X as u,E as p,n as m,y as b,S as g,z as v}from"./ui-vendor-CHl9FvfL.js";import{c as h,o as f,e as k,t as x,u as y,a as w,f as _,p as j,d as F,j as T,B as C,b as q,N as M,w as D,F as Y,r as B,k as I,O as z,X as P,Z as R,z as U,A as V,P as S}from"./vue-vendor-VaL6RChx.js";import{_ as A,a as O}from"./UserListItem-CafjY3mg.js";import{_ as X}from"./UFileCard-nyRpVuHR.js";import{u as H}from"./taskStore-khsZIx4H.js";import{u as J}from"./useFormValidate-Wk5HUh9e.js";import{_ as $}from"./UPagination-U2sF8ofx.js";import"./utils-DZp7J2GC.js";const E={class:"flex flex-row"},L={class:"flex-1 min-w-0"},N={class:"flex flex-row items-center justify-between pb-2"},G={class:"text-sm font-extrabold text-black"},Q={class:"text-sm font-medium text-[#697696]"},K={class:"flex flex-col gap-y-2"},Z={class:"flex flex-row items-center justify-between"},W={class:"flex-1 min-w-0 truncate text-sm font-bold text-black"},ee={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},ae={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},se={__name:"TaskListItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(s){const t=e();return(e,l)=>(f(),h("div",{onClick:l[2]||(l[2]=a=>e.$emit("select",s.task)),class:j(["task card-dark border-b px-3 py-4 cursor-pointer hover:bg-[#4076FF0D]",s.active?"bg-[#4076FF0D]":""])},[k("div",E,[k("div",L,[k("div",N,[k("h4",G,x(s.task.document?.in_number),1),k("h4",Q,x(y(a)(s.task.doc_data).format("DD MMMM YYYY")),1)]),k("div",K,[k("div",Z,[k("span",W,x(s.task.subject?.title),1),"in_progress"===s.task.status?(f(),_(y(o),{key:0,class:"w-5 h-5 text-blue-400"})):w("",!0),"in_confirmation"===s.task.status?(f(),_(y(n),{key:1,class:"w-5 h-5 text-indigo-400"})):w("",!0),"done"===s.task.status?(f(),_(y(d),{key:2,class:"w-5 h-5 text-green-400"})):w("",!0),"be_rejected"===s.task.status?(f(),_(y(c),{key:3,class:"w-5 h-5 text-red-400"})):w("",!0)]),k("span",ee,x(s.task.document?.summary),1),k("span",ae,"Bajarish mudati: "+x(y(a)(s.task.due_date).format("DD MMMM YYYY")),1),s.task.assignees&&s.task.assignees[0]?(f(),h("div",{key:0,onMouseenter:l[0]||(l[0]=e=>{return a=`Topshiriq ${s.task.assignees[0].last_name} ${s.task.assignees[0].first_name}ga yuborilmoqda`,l=e,void t.open(a,{x:l.clientX+10,y:l.clientY+10});var a,l}),onMouseleave:l[1]||(l[1]=e=>y(t).close()),class:"inline-block card-dark border text-[14px] font-semibold text-black rounded-[10px] px-3 py-2 w-fit"},x(s.task.assignees[0].father_name?.[0])+"."+x(s.task.assignees[0].first_name?.[0])+"."+x(s.task.assignees[0].last_name),33)):w("",!0)])])])],2))}},te=F("taskResponse",{state:()=>({responses:[],loading:!1,error:null}),actions:{async addResponse(e){this.loading=!0,this.error=null;try{const t=await(a=e,s.post("/task-responses/",a,{headers:{"Content-Type":"multipart/form-data"}}));return this.responses.unshift(t.data),t.data}catch(t){throw this.error=t.response?.data||"Yuborishda xatolik yuz berdi",t}finally{this.loading=!1}var a},async editResponse(e,a){this.loading=!0,this.error=null;try{const t=await((e,a)=>s.patch(`/task-responses/${e}/`,a,{headers:{"Content-Type":"multipart/form-data"}}))(e,a),l=this.responses.findIndex(a=>a.id===e);return-1!==l&&(this.responses[l]=t.data),t.data}catch(t){throw this.error=t.response?.data||"Tahrirlashda xatolik yuz berdi",t}finally{this.loading=!1}},async removeResponse(e){this.error=null;try{await(e=>s.delete(`/task-responses/${e}/`))(e),this.responses=this.responses.filter(a=>a.id!==e)}catch(a){throw this.error=a.response?.data||"O'chirishda xatolik",a}},async deleteFile(e){const a=t();try{await(e=>s.delete(`/task-response-files/${e}/`))(e),a.show("File oâ€˜chirildi !"),this.responses.forEach(a=>{a.files&&(a.files=a.files.filter(a=>a.id!==e))})}catch(l){throw l}},clearResponses(){this.responses=[],this.error=null}}}),le={class:"w-[100vw] md:w-[50vw] 2xl:w-[50vw] h-[70vh] flex flex-col bg-white rounded-xl shadow-lg overflow-hidden"},ie={class:"flex justify-between items-center p-4 border-b bg-gray-50"},re={class:"font-bold uppercase text-md text-gray-700 flex items-center gap-2"},oe={class:"p-6 flex-1 overflow-y-auto space-y-6 bg-white custom-scrollbar"},ne={class:"space-y-2"},de={class:"space-y-3"},ce={key:0,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},ue={class:"bg-blue-50 p-4 rounded-full mb-3 group-hover:bg-blue-100 transition-colors"},pe={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4"},me={class:"flex justify-end items-center gap-3 p-4 border-t bg-gray-50/50"},be=l({__name:"TaskResponsForm",props:{taskId:Number,existingTask:Object},setup(e){const a=e,s=i(),l=te(),r=H(),o=t(),n=T([]),d=T(a.existingTask?.files||[]),c=T(null),m=[".pdf",".docx",".doc",".jpg",".jpeg",".png",".xls",".xlsx"],{form:b,errors:g,validate:v,resetForm:j}=J({task_id:a.taskId||a.existingTask?.task,description:a.existingTask?.description||""},{task_id:{required:!0},description:{required:!0,message:"Javob izohini yozish majburiy"}}),F=e=>{const a=Array.from(e.target.files);for(const s of a){if(s.size>20971520)return(s.size/1048576).toFixed(2),o.show("Fayli juda katta, maksimal hajm: 20MB","warning"),void(e.target.value="");const a="."+s.name.split(".").pop().toLowerCase();if(!m.includes(a))return o.show("Fayl turi qo'llab-quvvatlanmaydi. Faqat PDF, DOCX, JPG, PNG, XLSX","warning"),void(e.target.value="")}n.value=[...n.value,...a],e.target.value=""},I=()=>s.close(),z=()=>{j(),n.value=[],I()},P=async()=>{if(!v())return;const e=new FormData;e.append("task",b.task_id),e.append("description",b.description),n.value.forEach(a=>{e.append("uploaded_files",a)});try{a.existingTask?.id?await l.editResponse(a.existingTask.id,e):await l.addResponse(e),z(),await r.fetchAll()}catch(s){}};return(a,s)=>{const t=C("UButton"),i=C("UTextarea");return f(),h("div",le,[k("div",ie,[k("p",re,[s[2]||(s[2]=k("span",{class:"w-2 h-5 bg-blue-500 rounded-full"},null,-1)),M(" "+x(e.existingTask?"Hisobotni tahrirlash":"Topshiriq bo'yicha hisobot"),1)]),q(t,{onClick:I,class:"bg-gray-200 hover:bg-gray-300 rounded-full p-1.5 transition-colors"},{default:D(()=>[q(y(u),{class:"w-4 h-4 text-gray-600","stroke-width":"3"})]),_:1})]),k("div",oe,[k("div",ne,[q(i,{modelValue:y(b).description,"onUpdate:modelValue":s[0]||(s[0]=e=>y(b).description=e),label:"Bajarilgan ishlar bo'yicha izoh",placeholder:"Nimalar bajarilgani haqida batafsil yozing..",error:y(g)?.description},null,8,["modelValue","error"])]),k("div",de,[d.value.length>0?(f(),h("div",ce,[(f(!0),h(Y,null,B(d.value,e=>(f(),_(X,{key:e.id,file:e,"show-delete":!0,onRemove:a=>(async e=>{try{await l.deleteFile(e),d.value=d.value.filter(a=>a.id!==e)}catch(a){alert("Faylni o'chirib bo'lmadi")}})(e.id)},null,8,["file","onRemove"]))),128))])):w("",!0),k("div",{onClick:s[1]||(s[1]=e=>a.$refs.fileInput.click()),class:"group flex flex-col border border-[#EAECF0] shadow-sm rounded-[12px] items-center text-center justify-center p-6 cursor-pointer hover:border-blue-400 transition-all active:scale-[0.95]"},[k("input",{accept:".pdf,.docx,.doc,.jpg,.jpeg,.png,.xls,.xlsx",type:"file",ref_key:"fileInput",ref:c,multiple:"",onChange:F,class:"hidden"},null,544),k("div",ue,[q(y(p),{class:"w-8 h-8 text-blue-500"})]),s[3]||(s[3]=k("p",{class:"text-[12px] text-gray-400 mt-1 uppercase font-bold tracking-tighter"},"PDF, DOCX, JPG, XLSX (Max 20MB)",-1))]),n.value.length>0?(f(),h("div",pe,[(f(!0),h(Y,null,B(n.value,(e,a)=>(f(),_(X,{key:a,file:e,"show-delete":!0,onRemove:e=>(e=>{n.value.splice(e,1)})(a)},null,8,["file","onRemove"]))),128))])):w("",!0)])]),k("div",me,[q(t,{variant:"ghost",onClick:z},{default:D(()=>[...s[4]||(s[4]=[M("Bekor qilish",-1)])]),_:1}),q(t,{variant:"primary",onClick:P,disabled:y(l).loading,loading:y(l).loading},{default:D(()=>[M(x(y(l).loading?"Yuborilmoqda...":"Saqlash va yuborish"),1)]),_:1},8,["disabled","loading"])])])}}},[["__scopeId","data-v-7332330b"]]),ge={key:0},ve={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},he={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-sm rounded-lg mt-4"},fe={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},ke={class:"font-bold text-gray-800 text-base flex items-center gap-2"},xe={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},ye={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},we={class:"divide-y divide-gray-100"},_e={key:1,class:"p-[24px]"},je={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},Fe={key:0},Te={class:"grid grid-cols-2 gap-2"},Ce={key:2,class:"p-[24px]"},qe={class:"grid grid-cols-1 gap-4 pb-4"},Me={key:0},De={class:"grid grid-cols-2 gap-2"},Ye={key:3,class:"p-[24px] text-gray-500 text-center"},Be={class:"flex p-4 bg-[#F4F6FC] gap-3"},Ie=l({__name:"TaskShowItem",props:{task:{type:Object,default:null}},setup(e){const s=e,t=i(),l=r(),o=I(()=>s.task?.responses?s.task.responses.find(e=>e.user===l.user?.id):null),n=()=>{o.value&&t.open(be,{taskId:s.task.id,existingTask:o.value})},d=()=>{s.task?.id&&t.open(be,{taskId:s.task.id})};return(s,t)=>{const l=C("UButton");return f(),h(Y,null,[e.task?(f(),h("div",ge,[k("div",ve,[q(A,{label:"Bajarish muddati",value:y(a)(e.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),q(A,{label:"Topshiriq",value:e.task.subject.title},null,8,["value"]),q(A,{label:"Topshiriq mazmun",value:e.task.description,class:"col-span-2"},null,8,["value"])]),k("div",he,[k("div",fe,[k("h3",ke,[t[0]||(t[0]=k("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),t[1]||(t[1]=M(" Ijrochilar ",-1)),k("span",xe,x(e.task.assignees?.length||0),1)])]),k("div",ye,[k("div",we,[(f(!0),h(Y,null,B(e.task.assignees,(e,a)=>(f(),_(O,{key:e.id,user:e,"is-responsible":0===a},null,8,["user","is-responsible"]))),128))])])]),t[2]||(t[2]=k("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1))])):w("",!0),e.task.document?(f(),h("div",_e,[k("div",je,[q(A,{label:"Kiruvchi raqam",value:e.task.document.in_number},null,8,["value"]),q(A,{label:"Chiqish raqam",value:e.task.document.out_number},null,8,["value"]),q(A,{label:"Hujjat nomi",value:e.task.document.title,class:"md:col-span-2"},null,8,["value"]),q(A,{label:"Hujjat nomi",value:e.task.document.summary,class:"md:col-span-2"},null,8,["value"]),q(A,{label:"Hujjatni Imzololovchi",value:e.task.document.signer},null,8,["value"]),q(A,{label:"Jurnal",value:e.task.document.journal.name},null,8,["value"])]),e.task.document.attachments?.length?(f(),h("div",Fe,[t[3]||(t[3]=k("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),k("div",Te,[(f(!0),h(Y,null,B(e.task.document.attachments,e=>(f(),_(X,{key:e.id,file:e},null,8,["file"]))),128))])])):w("",!0)])):w("",!0),t[7]||(t[7]=k("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1)),e.task.responses&&e.task.responses.length?(f(),h("div",Ce,[(f(!0),h(Y,null,B(e.task.responses,s=>(f(),h("div",{key:s.id,class:"mb-6 border-b pb-4 last:border-none"},[k("div",qe,[q(A,{label:"Yuboruvchi",value:s.user_full_name},null,8,["value"]),q(A,{label:"Berilgan javob",value:s.description},null,8,["value"]),q(A,{label:"Berilgan javob sanasi",value:e.task.responses?.[0]?.created_at?y(a)(e.task.responses[0].created_at).format("DD MMMM YYYY HH:mm"):"Javob berilmagan"},null,8,["value"])]),s.files?.length?(f(),h("div",Me,[t[4]||(t[4]=k("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),k("div",De,[(f(!0),h(Y,null,B(s.files,e=>(f(),_(X,{key:e.id,file:e},null,8,["file"]))),128))])])):w("",!0)]))),128))])):(f(),h("div",Ye,"Hozircha javoblar mavjud emas.")),z(k("div",Be,[z(q(l,{onClick:d,variant:"primary"},{default:D(()=>[q(y(m),{"stroke-width":"3",class:"text-white"}),t[5]||(t[5]=k("span",{class:"px-1"},"Javob kiritish",-1))]),_:1},512),[[P,!o.value]]),z(q(l,{onClick:n,variant:"primary",class:"bg-orange-500 hover:bg-orange-600"},{default:D(()=>[q(y(b),{"stroke-width":"3",class:"text-white w-6 h-4"}),t[6]||(t[6]=k("span",{class:"px-1"},"Javobni tahrirlash",-1))]),_:1},512),[[P,o.value]])],512),[[P,"done"!==e.task.status&&"done_overdue"!==e.task.status]])],64)}}},[["__scopeId","data-v-70c90527"]]),ze={class:"mx-auto"},Pe={class:"flex items-center px-2 card-dark border-b"},Re=["onClick"],Ue={class:"text-gray-700 font-semibold"},Ve={class:"grid grid-cols-1 lg:grid-cols-12"},Se={class:"col-span-12 md:col-span-5 2xl:col-span-3"},Ae={class:"card-dark border-b-2 border-x shadow-sm"},Oe={class:"flex px-1 py-3 items-center border-b card-border justify-between"},Xe={class:"flex items-center"},He={class:"flex gap-1"},Je={class:"h-[calc(100vh-8rem)] overflow-y-auto"},$e={class:"col-span-12 md:col-span-7 2xl:col-span-9 space-y-2 px-3 h-[calc(100vh-4rem)] overflow-y-auto"},Ee={class:"card-dark rounded-b border-b border-x"},Le={key:0},Ne={key:1,class:"flex flex-col"},Ge={class:"grid grid-cols-3 p-6 gap-4"},Qe={class:"flex bg-[#F4F6FC] items-center gap-4 justify-end p-6"},Ke={__name:"InexecutionuserViews",setup(e){const a=H(),s=T("all"),t=T(null),l=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>a.all_tasks,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>a.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>a.in_progress,status:"in_progress"},{key:"in_confirmation",label:"Tasdiqlashda",color:"bg-indigo-500",count:()=>a.in_confirmation,status:"in_confirmation"},{key:"done_overdue",label:"Muddatidan kech bajarilgan",color:"bg-gray-500",count:()=>a.done_overdue,status:"done_overdue"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>a.be_rejected,status:"be_rejected"}],i=R({due_date:"",assignee:"",created_at:""}),r=e=>a.setSelectedTask(e),o=e=>a.fetchAll(e),n=()=>a.setSelectedTask(null),d=async()=>{await a.setFilter("status",t.value||""),await a.setFilter("due_date",i.due_date),await a.setFilter("assignee",i.assignee),await a.setFilter("created_at",i.created_at)},c=async()=>{t.value=null,Object.keys(i).forEach(e=>i[e]=""),await d()};return U(()=>a.fetchAll()),V(()=>{a.filters={status:"",due_date:"",assignee:null,created_at:"",search:""},a.currentPage=1}),(e,u)=>{const p=C("UButton"),m=C("UDatePicker"),b=S("wave");return f(),h("div",ze,[k("div",Pe,[(f(),h(Y,null,B(l,e=>k("div",{key:e.key,onClick:l=>(async e=>{s.value=e.key,t.value=e.status||null,await a.setFilter("status",e.status)})(e),class:j(["flex items-center gap-2 py-4 p-2 cursor-pointer transition hover:bg-gray-100 border-b-2",s.value===e.key?"border-b-blue-500":"border-b-transparent"])},[k("span",Ue,x(e.label),1),k("span",{class:j(["text-white text-sm px-2 py-0.5 rounded-full font-semibold",e.color])},x(e.count()),3)],10,Re)),64))]),k("div",Ve,[k("div",Se,[k("div",Ae,[k("div",Oe,[k("div",Xe,[z((f(),_(p,{onClick:n,variant:"hover"},{default:D(()=>[q(y(g),{"stroke-width":"2",class:"w-6 h-6"})]),_:1})),[[b]]),u[2]||(u[2]=k("h2",{class:"text-[14px] p-2 font-bold uppercase text-[#282F3D]"},"Topshiriqlar",-1))]),k("div",He,[q($,{currentPage:y(a).pagination.currentPage,previous:y(a).pagination.previous,next:y(a).pagination.next,lastPage:Math.ceil(y(a).pagination.count/10),total:y(a).pagination.count,loading:y(a).loading,onChange:o},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),k("div",Je,[(f(!0),h(Y,null,B(y(a).tasks,e=>(f(),_(se,{key:e.id,task:e,active:y(a).selectedTask?.id===e.id,onSelect:r},null,8,["task","active"]))),128)),u[3]||(u[3]=k("div",{class:"h-24 w-full"},null,-1))])])]),k("div",$e,[k("div",Ee,[y(a).selectedTask?(f(),h("div",Le,[u[4]||(u[4]=k("div",{class:"flex px-1 py-2 items-center border-b card-border justify-between"},[k("h2",{class:"text-[14px] p-3 font-bold uppercase text-[#282F3D]"},"Biriktirilgan topshiriq"),k("div",{class:"flex items-center gap-2"})],-1)),q(Ie,{task:y(a).selectedTask},null,8,["task"])])):(f(),h("div",Ne,[k("div",null,[u[5]||(u[5]=k("div",{class:"flex p-3 items-center card-border border-b justify-between"},[k("h2",{class:"text-[14px] py-2 font-bold uppercase text-[#282F3D]"},"Qidirish")],-1)),k("div",Ge,[q(m,{modelValue:i.due_date,"onUpdate:modelValue":u[0]||(u[0]=e=>i.due_date=e),placeholder:"Topshiriq bajarish muddati"},null,8,["modelValue"]),q(m,{modelValue:i.created_at,"onUpdate:modelValue":u[1]||(u[1]=e=>i.created_at=e),placeholder:"Topshiriq yuborilgan sana"},null,8,["modelValue"])])]),k("div",Qe,[q(p,{class:"flex items-center",onClick:c},{default:D(()=>[q(y(v),{"stroke-width":"2.5",class:"w-5 h-5"}),u[6]||(u[6]=k("span",{class:"px-2"},"Tozalash",-1))]),_:1}),q(p,{variant:"primary",class:"flex items-center",onClick:d},{default:D(()=>[q(y(g),{"stroke-width":"2.5",class:"w-5 h-5"}),u[7]||(u[7]=k("span",{class:"px-2"},"Qidirish",-1))]),_:1})])]))]),u[8]||(u[8]=k("div",{class:"w-full h-48"},null,-1))])])])}}};export{Ke as default};
