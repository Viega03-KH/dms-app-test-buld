import{M as e}from"./MultiColumnUserSelect-B-6VHIjP.js";import{B as a}from"./BaseCrudTable-Bo112uMz.js";import{f as s,b as t,d as l,_ as r,a as i,e as n}from"./index-Prv8vSnk.js";import{k as o,c as d,o as c,e as u,t as g,a as p,F as b,r as m,u as x,p as h,j as y,f as v,N as f,b as k,w,B as _,Z as j,z as M,A as S}from"./vue-vendor-VaL6RChx.js";import{_ as q}from"./UPagination-U2sF8ofx.js";import{u as B}from"./taskStore-DyyExy6t.js";import{u as F}from"./usersStore-CcEgF9uW.js";import{_ as C,a as z}from"./UserListItem-CafjY3mg.js";import{_ as T}from"./UFileCard-DKnB8bzM.js";import{a as Y,R as U,V as D,z as H,S as I}from"./ui-vendor-CHl9FvfL.js";/* empty css                                                                      */import"./utils-DZp7J2GC.js";const P={class:"px-3 py-4 w-[180px]"},V={class:"h-10 flex flex-col justify-center"},A={class:"text-sm font-extrabold truncate w-40 leading-5 block"},N={class:"text-xs text-[#697696] truncate w-36 leading-4 block"},Q={class:"px-3 py-4 max-w-xs"},R={class:"h-10 flex items-center"},J={class:"text-sm font-medium text-black line-clamp-2 leading-5"},O={class:"px-3 py-4 w-[160px]"},K={class:"h-10 flex flex-col justify-center gap-1"},L={key:0,class:"text-[13px] font-semibold text-gray-700 bg-gray-100 px-2 py-0.5 rounded-md w-fit h-[24px] flex items-center"},Z={class:"h-10 flex items-center"},$={class:"text-sm text-[#697696] leading-5"},E={class:"px-3 py-4 w-[180px]"},G={class:"h-10 flex items-center"},W={__name:"MonitoringItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(e){const a=e,t=o(()=>({in_progress:"bg-blue-100 text-blue-700",in_confirmation:"bg-amber-100 text-amber-700",done:"bg-emerald-100 text-emerald-700",done_overdue:"bg-gray-300 text-gray-700",be_rejected:"bg-rose-100 text-rose-700"}[a.task.status]||"bg-gray-100 text-gray-700")),l=o(()=>({in_progress:"Jarayonda",in_confirmation:"Tasdiqlashda",done:"Bajarildi",done_overdue:"Muddatidan kech",be_rejected:"Bajarilmagan"}[a.task.status]||a.task.status));return(a,r)=>(c(),d("tr",{class:h(["h-[80px] divide-x border-b box-border transition-colors cursor-pointer",[e.active?"bg-[#4076FF0D]":"hover:bg-[#4076FF05]"]]),onClick:r[0]||(r[0]=s=>a.$emit("select",e.task))},[u("td",P,[u("div",V,[u("span",A,g(e.task.document.in_number),1),u("span",N,g(e.task.document.out_number),1)])]),u("td",Q,[u("div",R,[u("span",J,g(e.task.document.summary),1)])]),u("td",O,[u("div",K,[e.task.assignees?.length>0?(c(),d("div",L,g(e.task.assignees[0].last_name)+" "+g(e.task.assignees[0].first_name[0])+". ",1)):p("",!0)])]),(c(!0),d(b,null,m([e.task.document.created_at,e.task.due_date],e=>(c(),d("td",{key:e,class:"px-3 py-4 w-[140px]"},[u("div",Z,[u("span",$,g(x(s)(e).format("DD MMMM YYYY")),1)])]))),128)),u("td",E,[u("div",G,[u("span",{class:h(["px-3 py-1 rounded-full text-[12px] h-7 flex items-center tracking-wider w-32",t.value])},g(l.value),3)])])],2))}},X={class:"w-[90vw] md:w-[400px] flex flex-col bg-white rounded-2xl shadow-2xl overflow-hidden"},ee={class:"text-lg font-black text-gray-800 uppercase tracking-tight"},ae={class:"text-sm text-gray-500 mt-1 px-4 leading-relaxed"},se={class:"font-bold underline"},te={class:"p-4 bg-white flex flex-col gap-2"},le={__name:"TaskResponsStatusForm",props:{taskId:{type:Number,required:!0},targetStatus:{type:String,required:!0}},setup(e){const a=e,s=t(),r=B(),i=y(!1),n=async()=>{i.value=!0;try{(await r.updateTaskStatus(a.taskId,a.targetStatus)).success&&(s.close(),await r.fetchAll())}catch(e){}finally{i.value=!1}};return(a,t)=>(c(),d("div",X,[u("div",{class:h(["p-6 text-center border-b","done"===e.targetStatus?"bg-emerald-50":"bg-amber-50"])},[u("div",{class:h(["inline-flex p-3 rounded-full mb-3","done"===e.targetStatus?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"])},["done"===e.targetStatus?(c(),v(x(Y),{key:0,class:"w-8 h-8"})):(c(),v(x(U),{key:1,class:"w-8 h-8"}))],2),u("h3",ee,g("done"===e.targetStatus?"Tasdiqlaysizmi?":"Qayta ishlashga qaytarasizmi?"),1),u("p",ae,[t[1]||(t[1]=f(" Ushbu topshiriq holatini ",-1)),u("span",se,g("done"===e.targetStatus?"Bajarildi":"Qayta ishlash"),1),t[2]||(t[2]=f(" ga o'zgartirmoqchisiz. ",-1))])],2),u("div",te,[k(l,{onClick:n,disabled:i.value,class:h(["done"===e.targetStatus?"bg-emerald-600 hover:bg-emerald-700":"bg-amber-600 hover:bg-amber-700","w-full text-white py-3.5 rounded-xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95 disabled:opacity-50"])},{default:w(()=>[i.value?(c(),v(x(D),{key:0,class:"w-4 h-4 animate-spin"})):p("",!0),t[3]||(t[3]=f(" Ha, tasdiqlayman ",-1))]),_:1},8,["disabled","class"]),k(l,{onClick:t[0]||(t[0]=e=>x(s).close()),class:"w-full py-3 text-sm font-bold text-gray-400 hover:text-gray-600 transition-colors"},{default:w(()=>[...t[4]||(t[4]=[f("Bekor qilish",-1)])]),_:1})])]))}},re={key:0},ie={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},ne={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-lg rounded-lg mt-4"},oe={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},de={class:"font-bold text-gray-800 text-base flex items-center gap-2"},ce={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},ue={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},ge={class:"max-h-[280px] overflow-y-auto custom-scrollbar divide-y divide-gray-50"},pe={class:"divide-y divide-gray-100"},be={key:1,class:"p-[24px] border-gray-100 bg-white shadow-sm rounded-lg"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},xe={key:0},he={class:"grid grid-cols-1 gap-2"},ye={key:2,class:"p-[24px] border-gray-100 bg-white rounded-lg"},ve={class:"grid grid-cols-1 gap-4 pb-4"},fe={key:0},ke={class:"grid grid-cols-1 gap-2"},we={key:3,class:"p-[24px] text-gray-500 text-center"},_e={key:4,class:"grid grid-cols-1 gap-4 px-4"},je=r({__name:"MonitoringShow",props:{task:{type:Object,default:null}},setup(e){const a=e,l=t(),r=i();o(()=>a.task?.responses?a.task.responses.find(e=>e.user===r.user?.id):null);const n=e=>{l.open(le,{taskId:a.task.id,targetStatus:e,taskTitle:a.task.subject?.title})};return(a,t)=>{const l=_("UButton");return c(),d(b,null,[e.task?(c(),d("div",re,[u("div",ie,[k(C,{label:"Bajarish muddati",value:x(s)(e.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),k(C,{label:"Topshiriq",value:e.task.subject.title},null,8,["value"]),k(C,{label:"Topshiriq mazmun",value:e.task.description,class:"col-span-2"},null,8,["value"])]),u("div",ne,[u("div",oe,[u("h3",de,[t[2]||(t[2]=u("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),t[3]||(t[3]=f(" Ijrochilar ",-1)),u("span",ce,g(e.task.assignees?.length||0),1)])]),u("div",ue,[u("div",ge,[u("div",pe,[(c(!0),d(b,null,m(e.task.assignees,(e,a)=>(c(),v(z,{key:e.id,user:e,"is-responsible":0===a},null,8,["user","is-responsible"]))),128))])])])]),t[4]||(t[4]=u("div",{class:"w-full h-14"},null,-1))])):p("",!0),e.task.document?(c(),d("div",be,[u("div",me,[k(C,{label:"Kiruvchi raqam",value:e.task.document.in_number},null,8,["value"]),k(C,{label:"Chiqish raqam",value:e.task.document.out_number},null,8,["value"]),k(C,{label:"Hujjat nomi",value:e.task.document.title,class:"md:col-span-2"},null,8,["value"]),k(C,{label:"Hujjat mazmuni",value:e.task.document.summary,class:"md:col-span-2"},null,8,["value"]),k(C,{label:"Hujjatni Imzololovchi",value:e.task.document.signer,class:"md:col-span-2"},null,8,["value"])]),e.task.document.attachments?.length?(c(),d("div",xe,[t[5]||(t[5]=u("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),u("div",he,[(c(!0),d(b,null,m(e.task.document.attachments,e=>(c(),v(T,{key:e.id,file:e},null,8,["file"]))),128))])])):p("",!0)])):p("",!0),t[9]||(t[9]=u("div",{class:"w-full h-14"},null,-1)),e.task.responses&&e.task.responses.length?(c(),d("div",ye,[(c(!0),d(b,null,m(e.task.responses,a=>(c(),d("div",{key:a.id,class:"mb-6 pb-4 last:border-none"},[u("div",ve,[k(C,{label:"Yuboruvchi",value:a.user_full_name},null,8,["value"]),k(C,{label:"Berilgan javob",value:a.description},null,8,["value"]),k(C,{label:"Berilgan javob sanasi",value:e.task.responses?.[0]?.created_at?x(s)(e.task.responses[0].created_at).format("DD MMMM YYYY HH:mm"):"Javob berilmagan"},null,8,["value"])]),a.files?.length?(c(),d("div",fe,[t[6]||(t[6]=u("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),u("div",ke,[(c(!0),d(b,null,m(a.files,e=>(c(),v(T,{key:e.id,file:e},null,8,["file"]))),128))])])):p("",!0)]))),128))])):(c(),d("div",we,"Hozircha javoblar mavjud emas.")),e.task.responses?.length?(c(),d("div",_e,["in_confirmation"===e.task.status?(c(),v(l,{key:0,onClick:t[0]||(t[0]=e=>n("done")),variant:"primary"},{default:w(()=>[...t[7]||(t[7]=[f("Nazoratdan yechish",-1)])]),_:1})):p("",!0),"in_confirmation"===e.task.status?(c(),v(l,{key:1,onClick:t[1]||(t[1]=e=>n("in_progress")),variant:"secondary"},{default:w(()=>[...t[8]||(t[8]=[f("Qata ishlashga yuborish",-1)])]),_:1})):p("",!0)])):p("",!0)],64)}}},[["__scopeId","data-v-0653a046"]]),Me={class:"h-[80px] divide-x border-b animate-pulse box-border"};const Se=r({},[["render",function(e,a){return c(),d("tr",Me,[a[1]||(a[1]=u("td",{class:"px-3 py-4 w-[180px]"},[u("div",{class:"h-10 flex flex-col justify-center gap-2"},[u("div",{class:"h-4 bg-gray-200 rounded w-32"}),u("div",{class:"h-3 bg-gray-100 rounded w-24"})])],-1)),a[2]||(a[2]=u("td",{class:"px-3 py-4 max-w-xs"},[u("div",{class:"h-10 flex flex-col justify-center gap-2"},[u("div",{class:"h-3 bg-gray-200 rounded w-full"}),u("div",{class:"h-3 bg-gray-200 rounded w-4/5"})])],-1)),a[3]||(a[3]=u("td",{class:"px-3 py-4 w-[160px]"},[u("div",{class:"h-10 flex flex-col justify-center gap-2"},[u("div",{class:"h-6 bg-gray-200 rounded-md w-28"}),u("div",{class:"h-3 bg-gray-50 rounded w-16"})])],-1)),(c(),d(b,null,m(2,e=>u("td",{key:e,class:"px-3 py-4 w-[140px]"},[...a[0]||(a[0]=[u("div",{class:"h-10 flex items-center"},[u("div",{class:"h-4 bg-gray-100 rounded w-24"})],-1)])])),64)),a[4]||(a[4]=u("td",{class:"px-3 py-4 w-[180px]"},[u("div",{class:"h-10 flex items-center"},[u("div",{class:"h-7 bg-gray-200 rounded-full w-32"})])],-1))])}]]),qe={class:"mx-auto bg-[#F8FAFC] h-screen overflow-y-auto"},Be={class:"flex items-center gap-1 px-4 bg-white border-b shadow-sm sticky top-0 z-20"},Fe=["onClick"],Ce={class:"font-bold text-[13px] uppercase"},ze={class:"grid grid-cols-12 gap-0 p-6"},Te={class:"transition-all col-span-12 ease-in-out will-change-transform duration-300"},Ye={class:"space-y-4 py-4"},Ue={class:"flex flex-row justify-between gap-4"},De={class:"flex flex-row w-9/12 items-center gap-4"},He={class:"flex items-center gap-4"},Ie={class:"relative"},Pe={key:0},Ve={class:"p-4 sticky bottom-0"},Ae={__name:"MonitoringViews",setup(s){const t=B(),l=n(),r=F(),i=y("all"),o=y(null),C=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>t.all_tasks,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>t.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>t.in_progress,status:"in_progress"},{key:"in_confirmation",label:"Tasdiqlashda",color:"bg-indigo-500",count:()=>t.in_confirmation,status:"in_confirmation"},{key:"done_overdue",label:"Muddatidan kech bajarilgan",color:"bg-gray-500",count:()=>t.done_overdue,status:"done_overdue"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>t.be_rejected,status:"be_rejected"}],z=e=>{t.setSelectedTask(e),l.openDrawer(je,{task:e},{title:"Topshiriq tafsilotlari",side:"right"})},T=j({due_date:"",assignee:[],created_at:""}),Y=e=>t.fetchAll(e),U=e=>{T.assignee.includes(e)?T.assignee=[]:T.assignee=[e]},D=async()=>{const e=T.assignee.length>0?T.assignee[0]:null;await t.setFilter("status",o.value||""),await t.setFilter("due_date",T.due_date),await t.setFilter("assignee",e),await t.setFilter("created_at",T.created_at),await t.fetchAll(1)},P=async()=>{o.value=null,T.due_date="",T.created_at="",T.assignee=[],await D()};return M(async()=>{await Promise.all([t.fetchAll(),r.fetchUsersForSelect()])}),S(()=>{t.filters={status:"",due_date:"",assignee:[],created_at:"",search:""},t.currentPage=1}),(s,l)=>{const n=_("UDatePicker"),y=_("UButton");return c(),d("div",qe,[u("div",Be,[(c(),d(b,null,m(C,e=>u("div",{key:e.key,onClick:a=>(async e=>{i.value=e.key,o.value=e.status||null,await t.setFilter("status",e.status)})(e),class:h(["flex items-center gap-3 py-5 px-4 cursor-pointer transition-all duration-200 border-b-2",i.value===e.key?"border-blue-600 bg-blue-50/50":"border-transparent hover:bg-gray-50 text-gray-500"])},[u("span",Ce,g(e.label),1),u("span",{class:h(["text-white text-xs px-2.5 py-1 rounded-xl font-bold shadow-sm",e.color])},g(e.count()),3)],10,Fe)),64))]),u("div",ze,[u("div",Te,[u("div",Ye,[l[4]||(l[4]=u("div",{class:"flex items-center justify-between"},[u("h2",{class:"text-sm font-black uppercase text-slate-700 flex items-center gap-2"},[u("div",{class:"w-1 h-5 bg-blue-600 rounded-full"}),f(" Topshiriqlar Nazorati ")])],-1)),u("div",Ue,[u("div",De,[k(e,{options:x(r).searchUsers,"selected-ids":T.assignee,onSelect:U,onSearch:l[0]||(l[0]=e=>x(r).fetchUsersForSelect(e))},null,8,["options","selected-ids"]),k(n,{modelValue:T.due_date,"onUpdate:modelValue":l[1]||(l[1]=e=>T.due_date=e),placeholder:"Bajarish muddati"},null,8,["modelValue"]),k(n,{modelValue:T.created_at,"onUpdate:modelValue":l[2]||(l[2]=e=>T.created_at=e),placeholder:"Ro'yxatga olingan sana"},null,8,["modelValue"])]),u("div",He,[k(y,{variant:"hover",onClick:P,class:"!p-2"},{default:w(()=>[k(x(H),{class:"w-5 h-5 text-gray-400"})]),_:1}),k(y,{variant:"primary",class:"justify-center",onClick:D},{default:w(()=>[k(x(I),{class:"w-4 h-4 mr-2"}),l[3]||(l[3]=f(" Qidirish ",-1))]),_:1})])])]),u("div",Ie,[k(a,null,{thead:w(()=>[...l[5]||(l[5]=[u("th",{class:"sticky top-0 bg-white table-header"},"Hujjat",-1),u("th",{class:"sticky top-0 bg-white table-header"},"Mazmuni",-1),u("th",{class:"sticky top-0 bg-white table-header"},"Ijrochi",-1),u("th",{class:"sticky top-0 bg-white table-header"},"Yuborilgan",-1),u("th",{class:"sticky top-0 bg-white table-header"},"Muddat",-1),u("th",{class:"sticky top-0 bg-white table-header"},"Holati",-1)])]),tbody:w(()=>[x(t).loading?(c(),d(b,{key:0},[x(t).loading?(c(!0),d(b,{key:0},m(x(t).tasks.length>0?x(t).tasks.length:10,e=>(c(),v(Se,{key:"skeleton-"+e}))),128)):p("",!0)],64)):(c(),d(b,{key:1},[(c(!0),d(b,null,m(x(t).tasks,e=>(c(),v(W,{key:e.id,task:e,active:x(t).selectedTask?.id===e.id,onSelect:z},null,8,["task","active"]))),128)),0===x(t).tasks.length?(c(),d("tr",Pe,[...l[6]||(l[6]=[u("td",{colspan:"6",class:"py-10 text-center text-gray-400"},"Ma'lumotlar topilmadi",-1)])])):p("",!0)],64))]),pagination:w(()=>[u("div",Ve,[k(q,{currentPage:x(t).pagination.currentPage,previous:x(t).pagination.previous,next:x(t).pagination.next,lastPage:Math.ceil(x(t).pagination.count/10),total:x(t).pagination.count,loading:x(t).loading,onChange:Y},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),_:1})]),l[7]||(l[7]=u("div",{class:"w-full h-44"},null,-1))])])])}}};export{Ae as default};
