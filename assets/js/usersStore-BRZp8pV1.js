import{d as s}from"./vue-vendor-VaL6RChx.js";import{h as a,u as t}from"./index-Dz9Hx4OQ.js";const r=(s=1,t="")=>{const r=Number(s)||1;return a.get(`/users?page=${r}&search=${t}`)},e=s=>{if(!s)return null;const a=new URL(s);return parseInt(a.searchParams.get("page"))||1},i=s("users",{state:()=>({users:[],searchQuery:"",searchUsers:[],pagination:{previous:1,next:1,count:0,currentPage:1},selectedUser:null,loading:!1,error:null}),actions:{_handleError(s,a){const r=t(),e=s.response?.data?.message||a||"Xatolik yuz berdi";throw this.error=e,r.show(`${e}`,"error"),s},async fetchUsersNotPage(){this.loading=!0,this.error=null;try{const s=await a.get("/all");this.users=s.data.data}catch(s){this._handleError(s,"Foydalanuvchilarni olishda xato")}finally{this.loading=!1}},async fetchUsersForSelect(s=""){try{const a=await r(1,s);this.searchUsers=a.data.results}catch(a){}},async fetchUsers(s=1){this.loading=!0,this.error=null;try{this.pagination.currentPage=s;const a=await r(s,this.searchQuery);this.users=a.data.results,this.pagination.previous=e(a.data.previous),this.pagination.next=e(a.data.next),this.pagination.count=a.data.count}catch(a){this._handleError(a,"Ro'yxatni yuklashda xato")}finally{this.loading=!1}},setSearchQuery(s){this.searchQuery=s,this.fetchUsers(1)},async fetchUser(s){this.loading=!0;try{const t=await(s=>a.get(`/users/${s}/`))(s);return this.selectedUser=t.data,t.data}catch(t){this._handleError(t,"Ma'lumotlarni yuklashda xato")}finally{this.loading=!1}},async addUser(s){this.loading=!0;const r=t();try{const t=await(s=>a.post("/users/",s))(s);return await this.fetchUsers(),r.show("Muvaffaqiyatli qo'shildi!","success"),{success:!0,data:t.data}}catch(e){return this.error=e.message,r.show("Qo'shib bo'lmadi","error"),{success:!1,error:msg}}finally{this.loading=!1}},async editUser(s,r){this.loading=!0,this.error=null;const e=t();try{const t=await((s,t)=>a.put(`/users/${s}/`,t))(s,r);return await this.fetchUsers(),e.show("Muvaffaqiyatli yangilandi!","success"),{success:!0,data:t.data}}catch(i){const s=i.response?.data?.message||"Yangilashda xato";return this.error=s,e.show(s,"error"),{success:!1,error:s}}finally{this.loading=!1}},async removeUser(s){this.loading=!0;const r=t();try{await(s=>a.delete(`/users/${s}/`))(s),await this.fetchUsers(),r.show("Muvaffaqiyatli o'chirildi!","success")}catch(e){this._handleError(e,"O'chirishda xatolik")}finally{this.loading=!1}}}});export{i as u};
