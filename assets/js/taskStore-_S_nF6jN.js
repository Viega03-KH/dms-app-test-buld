import{d as s}from"./vue-vendor-D8IdSx1h.js";import{h as t}from"./index-CJLFOwbl.js";const a=(s,a)=>t.patch(`/tasks/${s}/`,a),e=s("task",{state:()=>({tasks:[],selectedTask:null,loading:!1,error:null,lastMessage:null,pagination:{previous:null,next:null,count:0,currentPage:1},filters:{status:"",due_date:"",assignee:"",created_at:""},all_tasks:0,in_progress:0,in_confirmation:0,be_rejected:0,done_overdue:0,done:0}),actions:{async createTask(s){this.loading=!0,this.error=null;try{const a=await(s=>t.post("/tasks/",s))(s);return 201===a?.status?(this.tasks.push(a.data),{success:!0,data:a.data}):{success:!1,error:"Task yaratishda xatolik"}}catch(a){return{success:!1,error:a.response?.data||a.message}}finally{this.loading=!1}},async updateTask(s,t){this.loading=!0,this.error=null;try{const e=await a(s,t);if(200===e?.status){const t=this.tasks.findIndex(t=>t.id===s);return-1!==t&&(this.tasks[t]=e.data),this.selectedTask?.id===s&&(this.selectedTask=e.data),{success:!0,data:e.data}}return{success:!1,error:"Task yangilashda xatolik"}}catch(e){return{success:!1,error:e.response?.data||e.message}}finally{this.loading=!1}},async updateTaskStatus(s,t){try{const e=await a(s,{status:t});if(200===e?.status){const a=this.tasks.findIndex(t=>t.id===s);return-1!==a&&(this.tasks[a].status=t),{success:!0}}}catch(e){return{success:!1,error:e.message}}},async fetchAll(s=1){this.loading=!0,this.error=null;try{const a={page:s,...this.filters},e=await(({page:s=1,status:a,due_date:e,assignee:i,created_at:n}={})=>{const r=new URLSearchParams;return r.set("page",s),a&&r.set("status",a),e&&r.set("due_date",e),i&&r.set("assignee",i),n&&r.set("created_at",n),t.get("/tasks/",{params:r})})(a),i=10,n=Math.ceil((e.data.count??0)/i);if(this.tasks=[...e.data.results],this.pagination.currentPage=s,this.pagination.previous=s>1?s-1:null,this.pagination.next=s<n?s+1:null,this.pagination.count=e.data.count??0,this.all_tasks=e.data.all_tasks??0,this.in_progress=e.data.in_progress??0,this.in_confirmation=e.data.in_confirmation??0,this.be_rejected=e.data.be_rejected??0,this.done_overdue=e.data.done_overdue??0,this.done=e.data.done??0,this.selectedTask){const s=this.tasks.find(s=>s.id===this.selectedTask.id);this.selectedTask=s||null}return this.tasks}catch(a){this.error=a?.response?.data?.message||a.message||"Server xatosi"}finally{this.loading=!1}},async setFilter(s,t){this.filters[s]=t,await this.fetchAll(1)},async fetchTaskById(s){try{const a=await(s=>t.get(`/task_view/${s}`))(s);if(a?.data){const t=this.tasks.findIndex(t=>t.id===s);return-1!==t&&(this.tasks[t]={...a.data}),this.selectedTask?.id===s&&(this.selectedTask={...a.data}),a.data}}catch(a){}},setSelectedTask(s){this.selectedTask=s}}});export{e as u};
