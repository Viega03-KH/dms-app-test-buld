import{O as h,y as F,x as H,u as A,l as T,r as b,a as N,o as B,b as c,g as s,v as x,h as j,f as t,w as I,j as S}from"./index-C_K37xRx.js";import{u as P,X as M}from"./useFormValidate-BOioRNXX.js";import{u as O,_ as J}from"./OrganizationForm-RgmxKNoU.js";import{u as Y}from"./doctypeStore-BhZjXW8z.js";import{u as $}from"./deliveryStore-BdLeCr95.js";import{u as K}from"./jurnalStore-8QOd6Zno.js";import{P as E}from"./plus-D3rnAYTi.js";const Q=({page:r=1,status:e=null,in_number:i=null,out_number:u=null}={})=>{const d={page:r};return e&&(d.status=e),i&&(d.in_number=i),u&&(d.out_number=u),h.get("/incomingdocuments/",{params:d})},X=r=>h.post("/incomingdocuments/",r),G=(r,e)=>h.put(`/incomingdocuments/${r}/`,e),L=r=>h.get(`/incoming_document_show/${r}`),R=F("dock",{state:()=>({docks:[],pagination:{previous:null,next:null,count:0,currentPage:1},selectedDock:null,loading:!1,error:null,status:"",in_number:"",out_number:""}),actions:{async fetchAll(r=1){this.loading=!0,this.error=null;try{const e=await Q({page:r,status:this.status,in_number:this.in_number,out_number:this.out_number});this.docks=e.data.results,this.pagination.count=e.data.count;const u=Math.ceil(e.data.count/10);this.pagination.currentPage=r,this.pagination.previous=r>1?r-1:null,this.pagination.next=r<u?r+1:null}catch(e){this.error=e.message}finally{this.loading=!1}},async createDock(r){this.loading=!0,this.error=null;try{const e=await X(r);e.status===200||e.status===201?await this.fetchAll():this.error=e.data.message}catch(e){this.error=e?.message,console.error(e)}finally{this.loading=!1}},async updateDock(r,e){this.loading=!0,this.error=null;try{const i=await G(r,e);i.status===200||i.status===201?await this.fetchAll():this.error=i.data.message}catch(i){this.error=i?.message,console.error(i)}finally{this.loading=!1}},async fetchDock(r){this.loading=!0;try{const e=await L(r);return this.selectedDock=e.data,e.data}catch(e){this.error=e.message}finally{this.loading=!1}}}}),W=(r,e)=>h.post(`file-upload?task_id=${e}`,r,{headers:{"Content-Type":"multipart/form-data"}}),Z=F("fileupload",{state:()=>({files:[],response:[],error:null}),actions:{setFiles(r){this.files=r},async upload(r){if(this.files.length){this.response=[],this.error=null;try{const e=new FormData;this.files.forEach(u=>{e.append("files[]",u)});const i=await W(e,r);return this.response=i.data||[],console.log(i.data),this.response}catch(e){throw this.error=e.response?.data||e.message||e,console.log(e.response?.data),this.error}}},clear(){this.files=[],this.response=[],this.error=null}}}),ee={class:"w-[100vw] md:w-[90vw] 2xl:w-[70vw] h-[95vh] flex flex-col"},te={class:"flex justify-between modal-border items-center p-[14px] border-b"},re={class:"text-black text-md font-bold uppercase"},oe={class:"p-6 w-full h-full overflow-y-scroll space-y-6"},le={class:"flex flex-row items-end justify-between gap-4"},ae={class:"grid grid-cols-1 md:grid-cols-3 gap-[32px] flex-1 py-8"},ie={class:"flex flex-col items-end justify-between gap-4"},se={class:"flex justify-end gap-3 p-4 border-t modal-border"},ge={__name:"CreateDockForm",props:{selectedFile:{type:Object,default:null}},setup(r){const e=R(),i=Z(),u=H(),d=A(),v=O(),g=Y(),k=$(),w=K(),n=r,{form:o,errors:m,validate:D,resetForm:z}=P({in_number:"",out_number:"",delivery_type_id:"",document_type_id:"",signer:"",journal_id:"",summary:"",title:"",sender_id:""},{in_number:{required:!0,message:"Kiruvchi raqam majburiy"},out_number:{required:!0,message:"Chiquvchi raqam majburiy"},delivery_type_id:{required:!0,message:"Yetkazish usulini tanlang"},document_type_id:{required:!0,message:"Hujjat turini tanlang"},signer:{required:!0,message:"Imzolovchi majburiy"},journal_id:{required:!0,message:"Jurnal majburiy"},summary:{required:!0,message:"Qisqacha mazmun majburiy"},title:{required:!0,message:"Hujjat nomi majburiy"},sender_id:{required:!0,message:"Ijrochi/Tashkilot majburiy"}});T(async()=>{try{await Promise.all([w.fetchAll(),v.fetchAll(),g.fetchAll(),k.fetchAll()]),n.selectedFile&&Object.assign(o,{in_number:n.selectedFile.in_number,out_number:n.selectedFile.out_number,delivery_type_id:n.selectedFile.delivery_type?.id||"",document_type_id:n.selectedFile.document_type?.id||"",signer:n.selectedFile.signer,journal_id:n.selectedFile.journal?.id||"",summary:n.selectedFile.summary,title:n.selectedFile.title,sender_id:n.selectedFile.sender?.id||""})}catch(p){console.error(p),d.show("Ma'lumotlarni yuklashda xatolik yuz berdi","error")}});const q=async()=>{if(!D())return;const p={in_number:o.in_number||null,out_number:o.out_number||null,signer:o.signer||null,title:o.title,summary:o.summary||null,delivery_type:Number(o.delivery_type_id),document_type:Number(o.document_type_id),journal:Number(o.journal_id),sender:Number(o.sender_id)};try{e.loading=!0,n.selectedFile?.id?(await e.updateDock(n.selectedFile.id,p),d.show("Hujjat muvaffaqiyatli yangilandi","success")):(await e.createDock(p),d.show("Hujjat muvaffaqiyatli saqlandi","success")),V()}catch(l){console.error(l),d.show("Hujjat saqlashda xatolik yuz berdi","error")}finally{e.loading=!1}},V=()=>{z(),i.clear(),u.close()},U=()=>{u.open(J)};return(p,l)=>{const y=b("UButton"),_=b("USelect"),f=b("UInput"),C=b("UTextarea");return B(),N("div",ee,[c("div",te,[c("p",re,x(n.selectedFile?"Hujjatni tahrirlash":"Hujjat yaratish"),1),s(y,{customClass:"bg-[#475467] rounded-full p-1",onClick:V},{default:j(()=>[s(t(M),{"stroke-width":"3",class:"w-3 h-3 text-white"})]),_:1})]),c("div",oe,[c("form",{onSubmit:I(q,["prevent"]),class:"flex flex-col"},[c("div",le,[s(_,{modelValue:t(o).sender_id,"onUpdate:modelValue":l[0]||(l[0]=a=>t(o).sender_id=a),options:t(v).organizations,label:"Tashkilot",placeholder:"Tashkilotni tanlang","option-label":"name","option-value":"id",loading:t(v).loading,error:t(m)?.sender_id},null,8,["modelValue","options","loading","error"]),s(y,{onClick:U,variant:"primary",customClass:"w-1/4 py-4"},{default:j(()=>[s(t(E),{"stroke-width":"3"}),l[9]||(l[9]=c("span",{class:"px-2"},"Tashkilot qo'shish",-1))]),_:1})]),c("div",ae,[s(_,{modelValue:t(o).document_type_id,"onUpdate:modelValue":l[1]||(l[1]=a=>t(o).document_type_id=a),options:t(g).doctypes,label:"Hujjat turi",placeholder:"Hujjat turini tanlang","option-label":"name","option-value":"id",loading:t(g).loading,error:t(m)?.document_type_id},null,8,["modelValue","options","loading","error"]),s(_,{modelValue:t(o).journal_id,"onUpdate:modelValue":l[2]||(l[2]=a=>t(o).journal_id=a),options:t(w).jurnals,label:"Jurnal",placeholder:"Jurnal nomini kiriting","option-label":"name","option-value":"id",loading:t(w).loading,error:t(m)?.journal_id},null,8,["modelValue","options","loading","error"]),s(_,{modelValue:t(o).delivery_type_id,"onUpdate:modelValue":l[3]||(l[3]=a=>t(o).delivery_type_id=a),options:t(k).list,label:"Yetkazish usuli",placeholder:"Yetkazish usulini tanlang","option-label":"name","option-value":"id",loading:t(k).loading,error:t(m)?.delivery_type_id},null,8,["modelValue","options","loading","error"]),s(f,{modelValue:t(o).in_number,"onUpdate:modelValue":l[4]||(l[4]=a=>t(o).in_number=a),label:"Kiruvchi raqam",placeholder:"Kiruvchi raqamni kiriting",error:t(m)?.in_number},null,8,["modelValue","error"]),s(f,{modelValue:t(o).out_number,"onUpdate:modelValue":l[5]||(l[5]=a=>t(o).out_number=a),label:"Chiquvchi raqam",placeholder:"Chiquvchi raqamni kiriting",error:t(m)?.out_number},null,8,["modelValue","error"]),s(f,{modelValue:t(o).signer,"onUpdate:modelValue":l[6]||(l[6]=a=>t(o).signer=a),label:"Imzolovchi",placeholder:"Imzolovchini kiriting",error:t(m)?.signer},null,8,["modelValue","error"])]),c("div",ie,[s(f,{modelValue:t(o).title,"onUpdate:modelValue":l[7]||(l[7]=a=>t(o).title=a),label:"Hujjat nomi",placeholder:"Hujjat nomi kiriting",error:t(m)?.title},null,8,["modelValue","error"]),s(C,{modelValue:t(o).summary,"onUpdate:modelValue":l[8]||(l[8]=a=>t(o).summary=a),label:"Qisqacha mazmun",placeholder:"Hujjatning qisqacha mazmunini kiriting",error:t(m)?.summary},null,8,["modelValue","error"])])],32)]),c("div",se,[s(y,{variant:"ghost",onClick:V},{default:j(()=>[...l[10]||(l[10]=[S("Bekor qilish",-1)])]),_:1}),s(y,{variant:"primary",onClick:q,loading:t(e).loading},{default:j(()=>[S(x(t(g).loading?"Yuborilmoqda...":"Saqlash va yuborish"),1)]),_:1},8,["loading"])])])}}};export{ge as _,R as u};
