import{a as l,o as a,b as e,v as d,f as o,L as P,g as i,n as Y,O as R,y as K,_ as J,x as U,d as B,j as z,t as E,q as $,P as Q,J as _,K as j,w as G,e as W,D as Z,c as C,h as q,r as V,N as ee,l as te,s as se}from"./index-NpEBLJbS.js";import{H as ae}from"./history-BAWKp9l6.js";import{_ as k,a as H,S as N}from"./UFileCard-BCLyN-Mq.js";import{u as L}from"./taskStore-Cyz-P3fR.js";import{u as oe,X as O}from"./useFormValidate-DJC7jpxC.js";import{D as le}from"./download-BLxQHGON.js";import{T as X}from"./trash-2-WhNS214r.js";import{C as ie}from"./cloud-upload-D27boa5c.js";import{P as ne}from"./plus-Fv9FE-lP.js";import{S as re}from"./square-pen-B9o_X7_l.js";import{_ as de}from"./UPagination-BF3pV6WL.js";import"./chevron-left-RJlNLR7z.js";import"./chevron-right-6akXjBU1.js";const ce={class:"flex flex-row"},ue={class:"flex-1 min-w-0"},pe={class:"flex flex-row items-center justify-between pb-2"},be={class:"text-sm font-extrabold text-black"},me={class:"text-sm font-medium text-[#697696]"},he={class:"flex flex-col gap-y-2"},fe={class:"flex flex-row items-center justify-between"},ge={class:"flex-1 min-w-0 truncate text-sm font-bold text-black"},xe={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},ve={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},ke={class:"inline-block card-dark border text-[14px] font-semibold text-black rounded-[10px] px-3 py-2 w-fit"},ye="task card-dark border-b px-3 py-4 cursor-pointer hover:bg-[#4076FF0D]",_e={__name:"TaskListItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(s){return(t,p)=>(a(),l("div",{onClick:p[0]||(p[0]=b=>t.$emit("select",s.task)),class:Y([ye,s.active?"bg-[#4076FF0D]":""])},[e("div",ce,[e("div",ue,[e("div",pe,[e("h4",be,d(s.task.document.in_number),1),e("h4",me,d(o(P)(s.task.doc_data).format("DD MMMM YYYY")),1)]),e("div",he,[e("div",fe,[e("span",ge,d(s.task.subject.title),1),i(o(ae),{class:"w-5 h-5 text-blue-500"})]),e("span",xe,d(s.task.document.summary),1),e("span",ve," Bajarish mudati: "+d(o(P)(s.task.due_date).format("DD MMMM YYYY")),1),e("div",ke,d(s.task.assignees[0].father_name[0])+"."+d(s.task.assignees[0].first_name[0])+"."+d(s.task.assignees[0].last_name),1)])])])],2))}},we=s=>R.post("/task-responses/",s,{headers:{"Content-Type":"multipart/form-data"}}),$e=(s,t)=>R.patch(`/task-responses/${s}/`,t,{headers:{"Content-Type":"multipart/form-data"}}),je=s=>R.delete(`/task-responses/${s}/`),Fe=s=>R.delete(`/task-response-files/${s}/`),Te=K("taskResponse",{state:()=>({responses:[],loading:!1,error:null}),actions:{async addResponse(s){this.loading=!0,this.error=null;try{const t=await we(s);return this.responses.unshift(t.data),t.data}catch(t){throw this.error=t.response?.data||"Yuborishda xatolik yuz berdi",t}finally{this.loading=!1}},async editResponse(s,t){this.loading=!0,this.error=null;try{const p=await $e(s,t),b=this.responses.findIndex(y=>y.id===s);return b!==-1&&(this.responses[b]=p.data),p.data}catch(p){throw this.error=p.response?.data||"Tahrirlashda xatolik yuz berdi",p}finally{this.loading=!1}},async removeResponse(s){this.error=null;try{await je(s),this.responses=this.responses.filter(t=>t.id!==s)}catch(t){throw this.error=t.response?.data||"O'chirishda xatolik",t}},async deleteFile(s){try{await Fe(s),this.responses.forEach(t=>{t.files&&(t.files=t.files.filter(p=>p.id!==s))})}catch(t){throw t}},clearResponses(){this.responses=[],this.error=null}}}),Ce={class:"w-[100vw] md:w-[60vw] 2xl:w-[60vw] h-[90vh] flex flex-col bg-white rounded-xl shadow-lg overflow-hidden"},Se={class:"flex justify-between items-center p-4 border-b bg-gray-50"},De={class:"font-bold uppercase text-md text-gray-700 flex items-center gap-2"},Be={class:"p-6 flex-1 overflow-y-auto space-y-6 bg-white custom-scrollbar"},qe={class:"space-y-2"},Me={key:0,class:"text-red-500 text-xs mt-1 font-medium"},Ye={class:"space-y-3"},Re={key:0,class:"space-y-2 mb-4"},Ie={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Pe={class:"flex items-center gap-3 overflow-hidden"},ze={class:"bg-blue-600 px-2 py-1 rounded text-[10px] font-bold text-white uppercase italic"},Ve={class:"text-xs text-gray-700 font-medium truncate"},Ue={class:"flex items-center gap-1"},He=["href","download"],Ne=["onClick"],Oe={class:"bg-blue-50 p-4 rounded-full mb-3 group-hover:bg-blue-100 transition-colors"},Ae={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4"},Je={class:"flex items-center gap-3 overflow-hidden"},Ee={class:"bg-red-500 p-2 rounded text-[10px] font-bold text-white uppercase"},Le={class:"text-xs text-gray-700 font-medium truncate"},Xe=["onClick"],Ke={class:"flex justify-end items-center gap-3 p-4 border-t bg-gray-50/50"},Qe=["disabled"],Ge={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},We={__name:"TaskResponsForm",props:{taskId:Number,existingTask:Object},setup(s){const t=s,p=U(),b=Te(),y=L(),v=B([]),m=B(t.existingTask?.files||[]),F=B(null),{form:n,errors:w,validate:c,resetForm:T}=oe({task_id:t.taskId||t.existingTask?.task,description:t.existingTask?.description||""},{task_id:{required:!0},description:{required:!0,message:"Javob izohini yozish majburiy"}}),g=f=>{const r=Array.from(f.target.files);v.value=[...v.value,...r]},u=f=>{v.value.splice(f,1)},S=async f=>{try{await b.deleteFile(f),m.value=m.value.filter(r=>r.id!==f)}catch{alert("Faylni o'chirib bo'lmadi")}},D=()=>p.close(),M=()=>{T(),v.value=[],D()},h=async()=>{if(!c())return;const f=new FormData;f.append("task_id",n.task_id),f.append("description",n.description),v.value.forEach(r=>{f.append("uploaded_files",r)});try{t.existingTask?.id?await b.editResponse(t.existingTask.id,f):await b.addResponse(f),M(),await y.fetchAll()}catch(r){console.error("Xatolik:",r)}};return(f,r)=>(a(),l("div",Ce,[e("div",Se,[e("p",De,[r[2]||(r[2]=e("span",{class:"w-2 h-5 bg-blue-600 rounded-full"},null,-1)),z(" "+d(s.existingTask?"Hisobotni tahrirlash":"Topshiriq bo'yicha hisobot"),1)]),e("button",{onClick:D,class:"bg-gray-200 hover:bg-gray-300 rounded-full p-1.5 transition-colors"},[i(o(O),{class:"w-4 h-4 text-gray-600","stroke-width":"3"})])]),e("div",Be,[e("div",qe,[r[3]||(r[3]=e("label",{class:"block text-sm font-bold text-gray-700"},"Bajarilgan ishlar bo'yicha izoh",-1)),E(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=x=>o(n).description=x),rows:"6",class:Y(["w-full p-4 border rounded-xl focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all resize-none text-sm bg-gray-50/50",o(w).description?"border-red-500":"border-gray-200"]),placeholder:"Nimalar bajarilgani haqida batafsil yozing..."},null,2),[[Q,o(n).description]]),o(w).description?(a(),l("p",Me,d(o(w).description),1)):$("",!0)]),e("div",Ye,[r[6]||(r[6]=e("label",{class:"block text-sm font-bold text-gray-700"},"Hujjatlarni biriktirish",-1)),m.value.length>0?(a(),l("div",Re,[e("div",Ie,[(a(!0),l(_,null,j(m.value,x=>(a(),l("div",{key:x.id,class:"flex items-center justify-between p-3 bg-blue-50/30 rounded-xl border border-blue-100 group"},[e("div",Pe,[e("div",ze,d(x.extension),1),e("span",Ve,d(x.file.split("/").pop()),1)]),e("div",Ue,[e("a",{href:x.file,download:x.file.split("/").pop(),class:"p-1.5 text-blue-500 hover:bg-blue-100 rounded-lg transition-colors",title:"Yuklab olish"},[i(o(le),{class:"w-4 h-4"})],8,He),e("button",{onClick:I=>S(x.id),type:"button",class:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all",title:"Serverdan o'chirish"},[i(o(X),{class:"w-4 h-4"})],8,Ne)])]))),128))])])):$("",!0),e("div",{onClick:r[1]||(r[1]=x=>f.$refs.fileInput.click()),class:"group border border-dashed border-gray-200 rounded-2xl py-6 flex flex-col items-center justify-center cursor-pointer hover:border-blue-400 hover:bg-blue-50/50 transition-all active:scale-[0.98]"},[e("input",{type:"file",ref_key:"fileInput",ref:F,multiple:"",onChange:g,class:"hidden"},null,544),e("div",Oe,[i(o(ie),{class:"w-8 h-8 text-blue-600"})]),r[4]||(r[4]=e("span",{class:"text-sm font-semibold text-gray-600"},"Yangi fayllar tanlash",-1)),r[5]||(r[5]=e("p",{class:"text-[10px] text-gray-400 mt-1 uppercase font-bold tracking-tighter"},"PDF, DOCX, JPG (Max 20MB)",-1))]),v.value.length>0?(a(),l("div",Ae,[(a(!0),l(_,null,j(v.value,(x,I)=>(a(),l("div",{key:I,class:"flex items-center justify-between p-3 bg-green-50 rounded-xl border border-green-100 shadow-sm"},[e("div",Je,[e("div",Ee,d(x.name.split(".").pop()),1),e("span",Le,d(x.name),1)]),e("button",{onClick:G(Ht=>u(I),["stop"]),class:"text-gray-400 hover:text-red-500 p-1"},[i(o(O),{class:"w-4 h-4"})],8,Xe)]))),128))])):$("",!0)])]),e("div",Ke,[e("button",{onClick:M,class:"px-6 py-2.5 text-sm font-bold text-gray-500 hover:text-gray-700 transition-colors"}," Bekor qilish "),e("button",{onClick:h,disabled:o(b).loading,class:"bg-blue-600 hover:bg-blue-700 text-white px-8 py-2.5 rounded-xl font-bold text-sm shadow-lg shadow-blue-200 disabled:bg-blue-300 flex items-center gap-2 transition-all active:scale-95"},[o(b).loading?(a(),l("div",Ge)):$("",!0),z(" "+d(o(b).loading?"Yuborilmoqda...":"Saqlash va yuborish"),1)],8,Qe)])]))}},A=J(We,[["__scopeId","data-v-baac035d"]]),Ze={key:0},et={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},tt={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-sm rounded-lg mt-4"},st={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},at={class:"font-bold text-gray-800 text-base flex items-center gap-2"},ot={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},lt={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},it={class:"relative shrink-0"},nt={class:"flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 text-white font-semibold text-sm shadow-md transition-transform"},rt={class:"flex flex-col min-w-0"},dt={class:"text-gray-900 font-semibold text-[15px] leading-snug truncate group-hover:text-blue-700 transition-colors"},ct={class:"flex items-center gap-1.5 mt-0.5"},ut={class:"text-gray-500 text-xs truncate"},pt={key:1,class:"p-[24px]"},bt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},mt={key:0},ht={class:"grid grid-cols-2 gap-2"},ft={key:2,class:"p-[24px]"},gt={class:"grid grid-cols-1 gap-4 pb-4"},xt={key:0},vt={class:"grid grid-cols-2 gap-2"},kt={key:3,class:"p-[24px] text-gray-500 text-center"},yt={class:"flex p-4 bg-[#F4F6FC] gap-3"},_t={__name:"TaskShowItem",props:{task:{type:Object,default:null}},setup(s){const t=s,p=U(),b=W(),y=Z(()=>t.task?.responses?t.task.responses.find(F=>F.user===b.user?.id):null),v=()=>{y.value?p.open(A,{taskId:t.task.id,existingTask:y.value}):console.warn("Sizda hali javob mavjud emas yoki foydalanuvchi mos kelmadi")},m=()=>{t.task?.id&&p.open(A,{taskId:t.task.id})};return(F,n)=>{const w=V("UButton");return a(),l(_,null,[s.task?(a(),l("div",Ze,[e("div",et,[i(k,{label:"Bajarish muddati",value:o(P)(s.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),i(k,{label:"Topshiriq",value:s.task.subject.title},null,8,["value"]),i(k,{label:"Topshiriq mazmun",value:s.task.description,class:"col-span-2"},null,8,["value"])]),e("div",tt,[e("div",st,[e("h3",at,[n[0]||(n[0]=e("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),n[1]||(n[1]=z(" Ijrochilar ",-1)),e("span",ot,d(s.task.assignees?.length||0),1)])]),e("div",lt,[(a(!0),l(_,null,j(s.task.assignees,c=>(a(),l("div",{key:c.id,class:"group flex items-center gap-4 px-6 py-3 transition-all duration-200 hover:bg-blue-50/50 border-b border-gray-50 last:border-none cursor-pointer"},[e("div",it,[e("div",nt,d(c.first_name?c.first_name[0]:"?"),1)]),e("div",rt,[e("span",dt,d(c.last_name)+" "+d(c.first_name),1),e("div",ct,[e("span",ut,d(c.department_name),1)])])]))),128))])]),n[2]||(n[2]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1))])):$("",!0),s.task.document?(a(),l("div",pt,[e("div",bt,[i(k,{label:"Kelib tushgan raqam",value:s.task.document.in_number},null,8,["value"]),i(k,{label:"Chiqish raqami",value:s.task.document.out_number},null,8,["value"]),i(k,{label:"Hujjat nomi",value:s.task.document.title,class:"md:col-span-2"},null,8,["value"]),i(k,{label:"Hujjat nomi",value:s.task.document.summary,class:"md:col-span-2"},null,8,["value"]),i(k,{label:"Hujjatni Imzololovchi",value:s.task.document.signer},null,8,["value"]),i(k,{label:"Jurnal",value:s.task.document.journal.name},null,8,["value"])]),s.task.document.attachments?.length?(a(),l("div",mt,[n[3]||(n[3]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",ht,[(a(!0),l(_,null,j(s.task.document.attachments,c=>(a(),C(H,{key:c.id,file:c},null,8,["file"]))),128))])])):$("",!0)])):$("",!0),n[7]||(n[7]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1)),s.task.responses&&s.task.responses.length?(a(),l("div",ft,[(a(!0),l(_,null,j(s.task.responses,c=>(a(),l("div",{key:c.id,class:"mb-6 border-b pb-4 last:border-none"},[e("div",gt,[i(k,{label:"Yuboruvchi",value:c.user_full_name},null,8,["value"]),i(k,{label:"Berilgan javob",value:c.description},null,8,["value"])]),c.files?.length?(a(),l("div",xt,[n[4]||(n[4]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",vt,[(a(!0),l(_,null,j(c.files,T=>(a(),C(H,{key:T.id,file:T},null,8,["file"]))),128))])])):$("",!0)]))),128))])):(a(),l("div",kt," Hozircha javoblar mavjud emas. ")),e("div",yt,[y.value?(a(),C(w,{key:1,onClick:v,variant:"primary",class:"bg-orange-500 hover:bg-orange-600"},{default:q(()=>[i(o(re),{"stroke-width":"3",class:"text-white w-6 h-4"}),n[6]||(n[6]=e("span",{class:"px-1"},"Javobni tahrirlash",-1))]),_:1})):(a(),C(w,{key:0,onClick:m,variant:"primary"},{default:q(()=>[i(o(ne),{"stroke-width":"3",class:"text-white"}),n[5]||(n[5]=e("span",{class:"px-1"},"Javob kiritish",-1))]),_:1}))])],64)}}},wt=J(_t,[["__scopeId","data-v-d12a65f3"]]),$t={class:"mx-auto"},jt={class:"flex items-center px-2 card-dark border-b"},Ft=["onClick"],Tt={class:"text-gray-700 font-semibold"},Ct={class:"grid grid-cols-1 lg:grid-cols-12"},St={class:"col-span-12 md:col-span-5 2xl:col-span-3"},Dt={class:"card-dark border-b-2 border-x shadow-sm"},Bt={class:"flex px-1 py-3 items-center border-b card-border justify-between"},qt={class:"flex items-center"},Mt={class:"flex gap-1"},Yt={class:"h-[calc(100vh-8rem)] overflow-y-auto"},Rt={class:"col-span-12 md:col-span-7 2xl:col-span-9 space-y-2 px-3 h-[calc(100vh-4rem)] overflow-y-auto"},It={class:"card-dark rounded-b border-b border-x"},Pt={key:0},zt={key:1,class:"flex flex-col"},Vt={class:"grid grid-cols-3 p-6 gap-4"},Ut={class:"flex bg-[#F4F6FC] items-center gap-4 justify-end p-6"},ts={__name:"InexecutionuserViews",setup(s){const t=L();U();const p=B("all"),b=B(null),y=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>t.pagination.count,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>t.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>t.in_progress,status:"in_progress"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>t.be_rejected,status:"be_rejected"}],v=async g=>{p.value=g.key,b.value=g.status||null,await t.setFilter("status",g.status)},m=ee({due_date:"",assignee:"",created_at:""}),F=g=>t.setSelectedTask(g),n=g=>t.fetchAll(g),w=()=>t.setSelectedTask(null),c=async()=>{await t.setFilter("status",b.value||""),await t.setFilter("due_date",m.due_date),await t.setFilter("assignee",m.assignee),await t.setFilter("created_at",m.created_at)},T=async()=>{b.value=null,Object.keys(m).forEach(g=>m[g]=""),await c()};return te(()=>t.fetchAll()),(g,u)=>{const S=V("UButton"),D=V("UDatePicker"),M=se("wave");return a(),l("div",$t,[e("div",jt,[(a(),l(_,null,j(y,h=>e("div",{key:h.key,onClick:f=>v(h),class:Y(["flex items-center gap-2 py-4 p-2 cursor-pointer transition hover:bg-gray-100 border-b-2",p.value===h.key?"border-b-blue-500":"border-b-transparent"])},[e("span",Tt,d(h.label),1),e("span",{class:Y(["text-white text-sm px-2 py-0.5 rounded-full font-semibold",h.color])},d(h.count()),3)],10,Ft)),64))]),e("div",Ct,[e("div",St,[e("div",Dt,[e("div",Bt,[e("div",qt,[E((a(),C(S,{onClick:w,variant:"hover"},{default:q(()=>[i(o(N),{"stroke-width":"2",class:"w-6 h-6"})]),_:1})),[[M]]),u[2]||(u[2]=e("h2",{class:"text-[14px] p-2 font-bold uppercase text-[#282F3D]"},"Topshiriqlar",-1))]),e("div",Mt,[i(de,{currentPage:o(t).pagination.currentPage,previous:o(t).pagination.previous,next:o(t).pagination.next,lastPage:Math.ceil(o(t).pagination.count/10),total:o(t).pagination.count,loading:o(t).loading,onChange:n},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),e("div",Yt,[(a(!0),l(_,null,j(o(t).tasks,h=>(a(),C(_e,{key:h.id,task:h,active:o(t).selectedTask?.id===h.id,onSelect:F},null,8,["task","active"]))),128)),u[3]||(u[3]=e("div",{class:"h-24 w-full"},null,-1))])])]),e("div",Rt,[e("div",It,[o(t).selectedTask?(a(),l("div",Pt,[u[4]||(u[4]=e("div",{class:"flex px-1 py-2 items-center border-b card-border justify-between"},[e("h2",{class:"text-[14px] p-3 font-bold uppercase text-[#282F3D]"},"Biriktirilgan topshiriq"),e("div",{class:"flex items-center gap-2"})],-1)),i(wt,{task:o(t).selectedTask},null,8,["task"])])):(a(),l("div",zt,[e("div",null,[u[5]||(u[5]=e("div",{class:"flex p-3 items-center card-border border-b justify-between"},[e("h2",{class:"text-[14px] py-2 font-bold uppercase text-[#282F3D]"},"Qidirish")],-1)),e("div",Vt,[i(D,{modelValue:m.due_date,"onUpdate:modelValue":u[0]||(u[0]=h=>m.due_date=h),label:"",placeholder:"Hujjat bajarish muddati"},null,8,["modelValue"]),i(D,{modelValue:m.created_at,"onUpdate:modelValue":u[1]||(u[1]=h=>m.created_at=h),label:"",placeholder:"Ro`yxatga olingan sana"},null,8,["modelValue"])])]),e("div",Ut,[i(S,{class:"flex items-center",onClick:T},{default:q(()=>[i(o(X),{"stroke-width":"2.5",class:"w-5 h-5"}),u[6]||(u[6]=e("span",{class:"px-2"},"Tozalash",-1))]),_:1}),i(S,{variant:"primary",class:"flex items-center",onClick:c},{default:q(()=>[i(o(N),{"stroke-width":"2.5",class:"w-5 h-5"}),u[7]||(u[7]=e("span",{class:"px-2"},"Qidirish",-1))]),_:1})])]))]),u[8]||(u[8]=e("div",{class:"w-full h-48"},null,-1))])])])}}};export{ts as default};
