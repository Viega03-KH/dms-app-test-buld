import{k as N,S as K,a as i,o as a,b as e,v,f as l,O as U,q as y,c as w,I as W,n as E,U as P,y as Z,u as ee,_ as L,x as Q,d as B,r as D,g as o,j as R,h as F,X as se,F as _,B as T,e as te,C as ae,t as I,J as A,Q as le,l as oe,R as ie,s as ne}from"./index-CgBs40KH.js";import{C as re}from"./check-check-BsWuoucV.js";import{_ as x,a as de}from"./UserListItem-bcGt9ZR-.js";import{_ as V}from"./UFileCard-C1O1avfq.js";import{u as X}from"./taskStore-DHNthdj3.js";import{u as ce,S as ue}from"./useFormValidate-rQ8rGJw0.js";import{C as me}from"./cloud-upload-D4ncI-9O.js";import{P as pe}from"./plus-CPvJ2MNj.js";import{_ as he,S as J}from"./UPagination-C3UC2o3o.js";import{T as be}from"./trash-2-C0SWzlnu.js";import"./chevron-left-CR1-zdx3.js";import"./chevron-right-CUX_y98Q.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=N("clipboard-clock",[["path",{d:"M16 14v2.2l1.6 1",key:"fo4ql5"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v.832",key:"1ujtp2"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h2",key:"qvpao1"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}],["rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",key:"ublpy"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=N("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),ve={class:"flex flex-row"},ge={class:"flex-1 min-w-0"},xe={class:"flex flex-row items-center justify-between pb-2"},ye={class:"text-sm font-extrabold text-black"},we={class:"text-sm font-medium text-[#697696]"},_e={class:"flex flex-col gap-y-2"},$e={class:"flex flex-row items-center justify-between"},je={class:"flex-1 min-w-0 truncate text-sm font-bold text-black"},Te={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},Fe={class:"flex-1 min-w-0 text-sm font-medium text-[#697696] line-clamp-2"},Ce="task card-dark border-b px-3 py-4 cursor-pointer hover:bg-[#4076FF0D]",Se={__name:"TaskListItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(s){const t=K(),d=(c,u)=>{t.open(c,{x:u.clientX+10,y:u.clientY+10})};return(c,u)=>(a(),i("div",{onClick:u[2]||(u[2]=k=>c.$emit("select",s.task)),class:E([Ce,s.active?"bg-[#4076FF0D]":""])},[e("div",ve,[e("div",ge,[e("div",xe,[e("h4",ye,v(s.task.document?.in_number),1),e("h4",we,v(l(U)(s.task.doc_data).format("DD MMMM YYYY")),1)]),e("div",_e,[e("div",$e,[e("span",je,v(s.task.subject?.title),1),s.task.status==="in_progress"?(a(),w(l(fe),{key:0,class:"w-5 h-5 text-blue-400"})):y("",!0),s.task.status==="in_confirmation"?(a(),w(l(ke),{key:1,class:"w-5 h-5 text-indigo-400"})):y("",!0),s.task.status==="done"?(a(),w(l(re),{key:2,class:"w-5 h-5 text-green-400"})):y("",!0),s.task.status==="be_rejected"?(a(),w(l(W),{key:3,class:"w-5 h-5 text-red-400"})):y("",!0)]),e("span",Te,v(s.task.document?.summary),1),e("span",Fe," Bajarish mudati: "+v(l(U)(s.task.due_date).format("DD MMMM YYYY")),1),s.task.assignees&&s.task.assignees[0]?(a(),i("div",{key:0,onMouseenter:u[0]||(u[0]=k=>d(`Topshiriq ${s.task.assignees[0].last_name} ${s.task.assignees[0].first_name}ga yuborilmoqda`,k)),onMouseleave:u[1]||(u[1]=k=>l(t).close()),class:"inline-block card-dark border text-[14px] font-semibold text-black rounded-[10px] px-3 py-2 w-fit"},v(s.task.assignees[0].father_name?.[0])+"."+v(s.task.assignees[0].first_name?.[0])+"."+v(s.task.assignees[0].last_name),33)):y("",!0)])])])],2))}},Me=s=>P.post("/task-responses/",s,{headers:{"Content-Type":"multipart/form-data"}}),qe=(s,t)=>P.patch(`/task-responses/${s}/`,t,{headers:{"Content-Type":"multipart/form-data"}}),Be=s=>P.delete(`/task-responses/${s}/`),De=s=>P.delete(`/task-response-files/${s}/`),Ye=Z("taskResponse",{state:()=>({responses:[],loading:!1,error:null}),actions:{async addResponse(s){this.loading=!0,this.error=null;try{const t=await Me(s);return this.responses.unshift(t.data),t.data}catch(t){throw this.error=t.response?.data||"Yuborishda xatolik yuz berdi",t}finally{this.loading=!1}},async editResponse(s,t){this.loading=!0,this.error=null;try{const d=await qe(s,t),c=this.responses.findIndex(u=>u.id===s);return c!==-1&&(this.responses[c]=d.data),d.data}catch(d){throw this.error=d.response?.data||"Tahrirlashda xatolik yuz berdi",d}finally{this.loading=!1}},async removeResponse(s){this.error=null;try{await Be(s),this.responses=this.responses.filter(t=>t.id!==s)}catch(t){throw this.error=t.response?.data||"O'chirishda xatolik",t}},async deleteFile(s){const t=ee();try{await De(s),t.show("File oâ€˜chirildi !"),this.responses.forEach(d=>{d.files&&(d.files=d.files.filter(c=>c.id!==s))})}catch(d){throw d}},clearResponses(){this.responses=[],this.error=null}}}),Re={class:"w-[100vw] md:w-[50vw] 2xl:w-[50vw] h-[70vh] flex flex-col bg-white rounded-xl shadow-lg overflow-hidden"},Ie={class:"flex justify-between items-center p-4 border-b bg-gray-50"},Ue={class:"font-bold uppercase text-md text-gray-700 flex items-center gap-2"},Ve={class:"p-6 flex-1 overflow-y-auto space-y-6 bg-white custom-scrollbar"},Pe={class:"space-y-2"},ze={class:"space-y-3"},He={key:0,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4"},Ae={class:"bg-blue-50 p-4 rounded-full mb-3 group-hover:bg-blue-100 transition-colors"},Ee={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4"},Je={class:"flex justify-end items-center gap-3 p-4 border-t bg-gray-50/50"},Oe={__name:"TaskResponsForm",props:{taskId:Number,existingTask:Object},setup(s){const t=s,d=Q(),c=Ye(),u=X(),k=B([]),p=B(t.existingTask?.files||[]),C=B(null),{form:n,errors:S,validate:h,resetForm:$}=ce({task_id:t.taskId||t.existingTask?.task,description:t.existingTask?.description||""},{task_id:{required:!0},description:{required:!0,message:"Javob izohini yozish majburiy"}}),g=f=>{const r=Array.from(f.target.files);k.value=[...k.value,...r]},m=f=>{k.value.splice(f,1)},M=async f=>{try{await c.deleteFile(f),p.value=p.value.filter(r=>r.id!==f)}catch{alert("Faylni o'chirib bo'lmadi")}},q=()=>d.close(),Y=()=>{$(),k.value=[],q()},b=async()=>{if(!h())return;const f=new FormData;f.append("task",n.task_id),f.append("description",n.description),k.value.forEach(r=>{f.append("uploaded_files",r)});try{t.existingTask?.id?await c.editResponse(t.existingTask.id,f):await c.addResponse(f),Y(),await u.fetchAll()}catch(r){console.error("Backenddan kelgan xato:",r.response?.data)}};return(f,r)=>{const z=D("UButton"),G=D("UTextarea");return a(),i("div",Re,[e("div",Ie,[e("p",Ue,[r[2]||(r[2]=e("span",{class:"w-2 h-5 bg-blue-600 rounded-full"},null,-1)),R(" "+v(s.existingTask?"Hisobotni tahrirlash":"Topshiriq bo'yicha hisobot"),1)]),o(z,{onClick:q,class:"bg-gray-200 hover:bg-gray-300 rounded-full p-1.5 transition-colors"},{default:F(()=>[o(l(se),{class:"w-4 h-4 text-gray-600","stroke-width":"3"})]),_:1})]),e("div",Ve,[e("div",Pe,[o(G,{modelValue:l(n).description,"onUpdate:modelValue":r[0]||(r[0]=j=>l(n).description=j),label:"Bajarilgan ishlar bo'yicha izoh",placeholder:"Nimalar bajarilgani haqida batafsil yozing..",error:l(S)?.description},null,8,["modelValue","error"])]),e("div",ze,[r[5]||(r[5]=e("label",{class:"block text-sm font-bold text-gray-700"},"Hujjatlarni biriktirish",-1)),p.value.length>0?(a(),i("div",He,[(a(!0),i(_,null,T(p.value,j=>(a(),w(V,{key:j.id,file:j,"show-delete":!0,onRemove:H=>M(j.id)},null,8,["file","onRemove"]))),128))])):y("",!0),e("div",{onClick:r[1]||(r[1]=j=>f.$refs.fileInput.click()),class:"group flex flex-col border border-[#EAECF0] shadow-sm rounded-[12px] items-center text-center justify-center p-6 cursor-pointer hover:border-blue-400 transition-all active:scale-[0.95]"},[e("input",{type:"file",ref_key:"fileInput",ref:C,multiple:"",onChange:g,class:"hidden"},null,544),e("div",Ae,[o(l(me),{class:"w-8 h-8 text-blue-600"})]),r[3]||(r[3]=e("span",{class:"text-sm font-semibold text-gray-600"},"Yangi fayllar tanlash",-1)),r[4]||(r[4]=e("p",{class:"text-[10px] text-gray-400 mt-1 uppercase font-bold tracking-tighter"},"PDF, DOCX, JPG (Max 20MB)",-1))]),k.value.length>0?(a(),i("div",Ee,[(a(!0),i(_,null,T(k.value,(j,H)=>(a(),w(V,{key:H,file:j,"show-delete":!0,onRemove:Ss=>m(H)},null,8,["file","onRemove"]))),128))])):y("",!0)])]),e("div",Je,[o(z,{variant:"ghost",onClick:Y},{default:F(()=>[...r[6]||(r[6]=[R(" Bekor qilish ",-1)])]),_:1}),o(z,{variant:"primary",onClick:b,disabled:l(c).loading,loading:l(c).loading},{default:F(()=>[R(v(l(c).loading?"Yuborilmoqda...":"Saqlash va yuborish"),1)]),_:1},8,["disabled","loading"])])])}}},O=L(Oe,[["__scopeId","data-v-0b670861"]]),Ne={key:0},Le={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},Qe={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-sm rounded-lg mt-4"},Xe={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},Ge={class:"font-bold text-gray-800 text-base flex items-center gap-2"},Ke={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},We={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},Ze={class:"divide-y divide-gray-100"},es={key:1,class:"p-[24px]"},ss={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},ts={key:0},as={class:"grid grid-cols-2 gap-2"},ls={key:2,class:"p-[24px]"},os={class:"grid grid-cols-1 gap-4 pb-4"},is={key:0},ns={class:"grid grid-cols-2 gap-2"},rs={key:3,class:"p-[24px] text-gray-500 text-center"},ds={class:"flex p-4 bg-[#F4F6FC] gap-3"},cs={__name:"TaskShowItem",props:{task:{type:Object,default:null}},setup(s){const t=s,d=Q(),c=te(),u=ae(()=>t.task?.responses?t.task.responses.find(C=>C.user===c.user?.id):null),k=()=>{u.value?d.open(O,{taskId:t.task.id,existingTask:u.value}):console.warn("Sizda hali javob mavjud emas yoki foydalanuvchi mos kelmadi")},p=()=>{t.task?.id&&d.open(O,{taskId:t.task.id})};return(C,n)=>{const S=D("UButton");return a(),i(_,null,[s.task?(a(),i("div",Ne,[e("div",Le,[o(x,{label:"Bajarish muddati",value:l(U)(s.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),o(x,{label:"Topshiriq",value:s.task.subject.title},null,8,["value"]),o(x,{label:"Topshiriq mazmun",value:s.task.description,class:"col-span-2"},null,8,["value"])]),e("div",Qe,[e("div",Xe,[e("h3",Ge,[n[0]||(n[0]=e("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),n[1]||(n[1]=R(" Ijrochilar ",-1)),e("span",Ke,v(s.task.assignees?.length||0),1)])]),e("div",We,[e("div",Ze,[(a(!0),i(_,null,T(s.task.assignees,(h,$)=>(a(),w(de,{key:h.id,user:h,"is-responsible":$===0},null,8,["user","is-responsible"]))),128))])])]),n[2]||(n[2]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1))])):y("",!0),s.task.document?(a(),i("div",es,[e("div",ss,[o(x,{label:"Kiruvchi raqam",value:s.task.document.in_number},null,8,["value"]),o(x,{label:"Chiqish raqam",value:s.task.document.out_number},null,8,["value"]),o(x,{label:"Hujjat nomi",value:s.task.document.title,class:"md:col-span-2"},null,8,["value"]),o(x,{label:"Hujjat nomi",value:s.task.document.summary,class:"md:col-span-2"},null,8,["value"]),o(x,{label:"Hujjatni Imzololovchi",value:s.task.document.signer},null,8,["value"]),o(x,{label:"Jurnal",value:s.task.document.journal.name},null,8,["value"])]),s.task.document.attachments?.length?(a(),i("div",ts,[n[3]||(n[3]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",as,[(a(!0),i(_,null,T(s.task.document.attachments,h=>(a(),w(V,{key:h.id,file:h},null,8,["file"]))),128))])])):y("",!0)])):y("",!0),n[7]||(n[7]=e("div",{class:"bg-[#F4F6FC] w-full h-14"},null,-1)),s.task.responses&&s.task.responses.length?(a(),i("div",ls,[(a(!0),i(_,null,T(s.task.responses,h=>(a(),i("div",{key:h.id,class:"mb-6 border-b pb-4 last:border-none"},[e("div",os,[o(x,{label:"Yuboruvchi",value:h.user_full_name},null,8,["value"]),o(x,{label:"Berilgan javob",value:h.description},null,8,["value"]),o(x,{label:"Berilgan javob sanasi",value:s.task.responses?.[0]?.created_at?l(U)(s.task.responses[0].created_at).format("DD MMMM YYYY HH:mm"):"Javob berilmagan"},null,8,["value"])]),h.files?.length?(a(),i("div",is,[n[4]||(n[4]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",ns,[(a(!0),i(_,null,T(h.files,$=>(a(),w(V,{key:$.id,file:$},null,8,["file"]))),128))])])):y("",!0)]))),128))])):(a(),i("div",rs," Hozircha javoblar mavjud emas. ")),I(e("div",ds,[I(o(S,{onClick:p,variant:"primary"},{default:F(()=>[o(l(pe),{"stroke-width":"3",class:"text-white"}),n[5]||(n[5]=e("span",{class:"px-1"},"Javob kiritish",-1))]),_:1},512),[[A,!u.value]]),I(o(S,{onClick:k,variant:"primary",class:"bg-orange-500 hover:bg-orange-600"},{default:F(()=>[o(l(ue),{"stroke-width":"3",class:"text-white w-6 h-4"}),n[6]||(n[6]=e("span",{class:"px-1"},"Javobni tahrirlash",-1))]),_:1},512),[[A,u.value]])],512),[[A,s.task.status!=="done"&&s.task.status!=="be_rejected"]])],64)}}},us=L(cs,[["__scopeId","data-v-a3a25b4f"]]),ms={class:"mx-auto"},ps={class:"flex items-center px-2 card-dark border-b"},hs=["onClick"],bs={class:"text-gray-700 font-semibold"},ks={class:"grid grid-cols-1 lg:grid-cols-12"},fs={class:"col-span-12 md:col-span-5 2xl:col-span-3"},vs={class:"card-dark border-b-2 border-x shadow-sm"},gs={class:"flex px-1 py-3 items-center border-b card-border justify-between"},xs={class:"flex items-center"},ys={class:"flex gap-1"},ws={class:"h-[calc(100vh-8rem)] overflow-y-auto"},_s={class:"col-span-12 md:col-span-7 2xl:col-span-9 space-y-2 px-3 h-[calc(100vh-4rem)] overflow-y-auto"},$s={class:"card-dark rounded-b border-b border-x"},js={key:0},Ts={key:1,class:"flex flex-col"},Fs={class:"grid grid-cols-3 p-6 gap-4"},Cs={class:"flex bg-[#F4F6FC] items-center gap-4 justify-end p-6"},As={__name:"InexecutionuserViews",setup(s){const t=X(),d=B("all"),c=B(null),u=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>t.all_tasks,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>t.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>t.in_progress,status:"in_progress"},{key:"in_confirmation",label:"Tasdiqlashda",color:"bg-indigo-500",count:()=>t.in_confirmation,status:"in_confirmation"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>t.be_rejected,status:"be_rejected"}],k=async g=>{d.value=g.key,c.value=g.status||null,await t.setFilter("status",g.status)},p=le({due_date:"",assignee:"",created_at:""}),C=g=>t.setSelectedTask(g),n=g=>t.fetchAll(g),S=()=>t.setSelectedTask(null),h=async()=>{await t.setFilter("status",c.value||""),await t.setFilter("due_date",p.due_date),await t.setFilter("assignee",p.assignee),await t.setFilter("created_at",p.created_at)},$=async()=>{c.value=null,Object.keys(p).forEach(g=>p[g]=""),await h()};return oe(()=>t.fetchAll()),ie(()=>{t.filters={status:"",due_date:"",assignee:null,created_at:"",search:""},t.currentPage=1}),(g,m)=>{const M=D("UButton"),q=D("UDatePicker"),Y=ne("wave");return a(),i("div",ms,[e("div",ps,[(a(),i(_,null,T(u,b=>e("div",{key:b.key,onClick:f=>k(b),class:E(["flex items-center gap-2 py-4 p-2 cursor-pointer transition hover:bg-gray-100 border-b-2",d.value===b.key?"border-b-blue-500":"border-b-transparent"])},[e("span",bs,v(b.label),1),e("span",{class:E(["text-white text-sm px-2 py-0.5 rounded-full font-semibold",b.color])},v(b.count()),3)],10,hs)),64))]),e("div",ks,[e("div",fs,[e("div",vs,[e("div",gs,[e("div",xs,[I((a(),w(M,{onClick:S,variant:"hover"},{default:F(()=>[o(l(J),{"stroke-width":"2",class:"w-6 h-6"})]),_:1})),[[Y]]),m[2]||(m[2]=e("h2",{class:"text-[14px] p-2 font-bold uppercase text-[#282F3D]"},"Topshiriqlar",-1))]),e("div",ys,[o(he,{currentPage:l(t).pagination.currentPage,previous:l(t).pagination.previous,next:l(t).pagination.next,lastPage:Math.ceil(l(t).pagination.count/10),total:l(t).pagination.count,loading:l(t).loading,onChange:n},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),e("div",ws,[(a(!0),i(_,null,T(l(t).tasks,b=>(a(),w(Se,{key:b.id,task:b,active:l(t).selectedTask?.id===b.id,onSelect:C},null,8,["task","active"]))),128)),m[3]||(m[3]=e("div",{class:"h-24 w-full"},null,-1))])])]),e("div",_s,[e("div",$s,[l(t).selectedTask?(a(),i("div",js,[m[4]||(m[4]=e("div",{class:"flex px-1 py-2 items-center border-b card-border justify-between"},[e("h2",{class:"text-[14px] p-3 font-bold uppercase text-[#282F3D]"},"Biriktirilgan topshiriq"),e("div",{class:"flex items-center gap-2"})],-1)),o(us,{task:l(t).selectedTask},null,8,["task"])])):(a(),i("div",Ts,[e("div",null,[m[5]||(m[5]=e("div",{class:"flex p-3 items-center card-border border-b justify-between"},[e("h2",{class:"text-[14px] py-2 font-bold uppercase text-[#282F3D]"},"Qidirish")],-1)),e("div",Fs,[o(q,{modelValue:p.due_date,"onUpdate:modelValue":m[0]||(m[0]=b=>p.due_date=b),placeholder:"Topshiriq bajarish muddati"},null,8,["modelValue"]),o(q,{modelValue:p.created_at,"onUpdate:modelValue":m[1]||(m[1]=b=>p.created_at=b),placeholder:"Topshiriq yuborilgan sana"},null,8,["modelValue"])])]),e("div",Cs,[o(M,{class:"flex items-center",onClick:$},{default:F(()=>[o(l(be),{"stroke-width":"2.5",class:"w-5 h-5"}),m[6]||(m[6]=e("span",{class:"px-2"},"Tozalash",-1))]),_:1}),o(M,{variant:"primary",class:"flex items-center",onClick:h},{default:F(()=>[o(l(J),{"stroke-width":"2.5",class:"w-5 h-5"}),m[7]||(m[7]=e("span",{class:"px-2"},"Qidirish",-1))]),_:1})])]))]),m[8]||(m[8]=e("div",{class:"w-full h-48"},null,-1))])])])}}};export{As as default};
