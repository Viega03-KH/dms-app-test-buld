import{M as L}from"./MultiColumnUserSelect-ByZP0ip9.js";import{B as R}from"./BaseCrudTable-gmKpSHdq.js";import{k as V,B,a as o,o as a,b as t,v as d,q as x,F as w,C as S,f as u,P as M,n as j,x as I,d as C,c as $,O,j as p,g as n,h as k,D as Y,_ as Q,e as J,r as q,M as E,R as K,l as D}from"./index-BTtPa-yH.js";import{_ as G}from"./UPagination-DoK75aSh.js";import{u as H}from"./taskStore-DPqzuGQP.js";import{u as W}from"./usersStore-C7AG6w9t.js";import{_ as f,S as X}from"./UInfoItem-SZt9Jwz4.js";import{_ as U}from"./UFileCard-C0S2SgjK.js";import{T as Z}from"./trash-2-CVMFSwLw.js";import"./chevron-left-CysQNCsg.js";import"./chevron-right-D2yu8vm9.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=V("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=V("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),st={class:"px-3 py-4"},at={class:"flex flex-col"},lt={class:"text-sm font-extrabold"},ot={class:"text-xs text-[#697696]"},nt={class:"px-3 py-4 max-w-xs"},it=["title"],rt={class:"px-3 py-4"},dt={key:0,class:"flex flex-col gap-1"},ct={key:0,class:"text-xs text-blue-500 font-bold pl-2"},ut={class:"px-3 py-4 text-sm text-[#697696]"},mt={class:"flex flex-col"},gt={class:"px-3 py-4 text-sm text-[#697696]"},bt={class:"flex flex-col"},ht={class:"px-3 py-4"},ft={__name:"MonitoringItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(e){const l=e,_=B(()=>({in_progress:"bg-blue-100 text-blue-700",in_confirmation:"bg-amber-100 text-amber-700",done:"bg-emerald-100 text-emerald-700",be_rejected:"bg-rose-100 text-rose-700"})[l.task.status]||"bg-gray-100 text-gray-700"),v=B(()=>({in_progress:"Jarayonda",in_confirmation:"Tasdiqlashda",done:"Bajarildi",be_rejected:"Rad etildi"})[l.task.status]||l.task.status);return(g,h)=>(a(),o("tr",{class:j(["divide-x divide-y",[e.active?"bg-[#4076FF0D]":"","hover:bg-[#4076FF05] cursor-pointer transition-colors"]]),onClick:h[0]||(h[0]=s=>g.$emit("select",e.task))},[t("td",st,[t("div",at,[t("span",lt,d(e.task.document.in_number),1),t("span",ot,d(e.task.document.out_number),1)])]),t("td",nt,[t("span",{class:"text-sm font-medium text-black line-clamp-2",title:e.task.document.summary},d(e.task.document.summary),9,it)]),t("td",rt,[e.task.assignees&&e.task.assignees.length>0?(a(),o("div",dt,[(a(!0),o(w,null,S(e.task.assignees.slice(0,2),s=>(a(),o("div",{key:s.id,class:"text-[13px] font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded-md w-fit"},d(s.last_name)+" "+d(s.first_name[0])+"."+d(s.father_name?s.father_name[0]+".":""),1))),128)),e.task.assignees.length>2?(a(),o("span",ct," + yana "+d(e.task.assignees.length-2)+" ijrochi ",1)):x("",!0)])):x("",!0)]),t("td",ut,[t("div",mt,[t("span",null,d(u(M)(e.task.document.created_at).format("DD MMMM YYYY")),1)])]),t("td",gt,[t("div",bt,[t("span",{class:j(e.task.is_overdue?"text-red-500 font-bold":"font-medium")},d(u(M)(e.task.due_date).format("DD MMMM YYYY")),3)])]),t("td",ht,[t("span",{class:j(["px-3 py-1 rounded-full text-[12px] tracking-wider",_.value])},d(v.value),3)])],2))}},xt={class:"w-[90vw] md:w-[400px] flex flex-col bg-white rounded-2xl shadow-2xl overflow-hidden"},yt={class:"text-lg font-black text-gray-800 uppercase tracking-tight"},vt={class:"text-sm text-gray-500 mt-1 px-4 leading-relaxed"},kt={class:"font-bold underline"},pt={class:"p-4 bg-white flex flex-col gap-2"},_t={__name:"TaskResponsStatusForm",props:{taskId:{type:Number,required:!0},targetStatus:{type:String,required:!0}},setup(e){const l=e,_=I(),v=H(),g=C(!1),h=async()=>{g.value=!0;try{(await v.updateTaskStatus(l.taskId,l.targetStatus)).success&&(_.close(),await v.fetchAll())}catch(s){console.error(s)}finally{g.value=!1}};return(s,m)=>(a(),o("div",xt,[t("div",{class:j(["p-6 text-center border-b",e.targetStatus==="done"?"bg-emerald-50":"bg-amber-50"])},[t("div",{class:j(["inline-flex p-3 rounded-full mb-3",e.targetStatus==="done"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"])},[e.targetStatus==="done"?(a(),$(u(O),{key:0,class:"w-8 h-8"})):(a(),$(u(et),{key:1,class:"w-8 h-8"}))],2),t("h3",yt,d(e.targetStatus==="done"?"Tasdiqlaysizmi?":"Qayta ishlashga qaytarasizmi?"),1),t("p",vt,[m[1]||(m[1]=p(" Ushbu topshiriq holatini ",-1)),t("span",kt,d(e.targetStatus==="done"?"Bajarildi":"Qayta ishlash"),1),m[2]||(m[2]=p(" ga o'zgartirmoqchisiz. ",-1))])],2),t("div",pt,[n(Y,{onClick:h,disabled:g.value,class:j([e.targetStatus==="done"?"bg-emerald-600 hover:bg-emerald-700":"bg-amber-600 hover:bg-amber-700","w-full text-white py-3.5 rounded-xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95 disabled:opacity-50"])},{default:k(()=>[g.value?(a(),$(u(tt),{key:0,class:"w-4 h-4 animate-spin"})):x("",!0),m[3]||(m[3]=p(" Ha, tasdiqlayman ",-1))]),_:1},8,["disabled","class"]),n(Y,{onClick:m[0]||(m[0]=r=>u(_).close()),class:"w-full py-3 text-sm font-bold text-gray-400 hover:text-gray-600 transition-colors"},{default:k(()=>[...m[4]||(m[4]=[p(" Bekor qilish ",-1)])]),_:1})])]))}},wt={key:0},$t={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},jt={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-lg rounded-lg mt-4"},St={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},Mt={class:"font-bold text-gray-800 text-base flex items-center gap-2"},Bt={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},Ct={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},qt={class:"max-h-[280px] overflow-y-auto custom-scrollbar divide-y divide-gray-50"},Ft={class:"relative shrink-0"},Tt={class:"flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 text-white font-semibold text-sm shadow-md"},zt={key:0,class:"absolute -top-1 -right-1 bg-yellow-400 text-white p-0.5 rounded-full w-2 h-2 border-white shadow-sm",title:"Asosiy ijrochi"},Yt={class:"flex flex-col min-w-0"},Dt={class:"flex items-center gap-2"},Ut={class:"text-gray-900 font-semibold text-[15px] truncate group-hover:text-blue-700 transition-colors"},Vt={key:0,class:"text-[10px] bg-yellow-100 text-yellow-700 px-1.5 py-0.5 rounded font-bold"},It={class:"text-gray-500 text-xs truncate"},Ht={key:1,class:"p-[24px] border-gray-100 bg-white shadow-sm rounded-lg"},At={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},Pt={key:0},Nt={class:"grid grid-cols-1 gap-2"},Lt={key:2,class:"p-[24px] border-gray-100 bg-white rounded-lg"},Rt={class:"grid grid-cols-1 gap-4 pb-4"},Ot={key:0},Qt={class:"grid grid-cols-1 gap-2"},Jt={key:3,class:"p-[24px] text-gray-500 text-center"},Et={key:4,class:"flex flex-row gap-4"},Kt={__name:"MonitoringShow",props:{task:{type:Object,default:null}},setup(e){const l=e,_=I(),v=J();B(()=>l.task?.responses?l.task.responses.find(h=>h.user===v.user?.id):null);const g=h=>{_.open(_t,{taskId:l.task.id,targetStatus:h,taskTitle:l.task.subject?.title})};return(h,s)=>{const m=q("UButton");return a(),o(w,null,[e.task?(a(),o("div",wt,[t("div",$t,[n(f,{label:"Bajarish muddati",value:u(M)(e.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),n(f,{label:"Topshiriq",value:e.task.subject.title},null,8,["value"]),n(f,{label:"Topshiriq mazmun",value:e.task.description,class:"col-span-2"},null,8,["value"])]),t("div",jt,[t("div",St,[t("h3",Mt,[s[2]||(s[2]=t("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),s[3]||(s[3]=p(" Ijrochilar ",-1)),t("span",Bt,d(e.task.assignees?.length||0),1)])]),t("div",Ct,[t("div",qt,[(a(!0),o(w,null,S(e.task.assignees,(r,i)=>(a(),o("div",{key:r.id,class:"group flex items-center gap-4 px-6 py-3 transition-all hover:bg-blue-50/50 cursor-pointer"},[t("div",Ft,[t("div",Tt,d(r.first_name?.[0]||"?"),1),i===0?(a(),o("div",zt)):x("",!0)]),t("div",Yt,[t("div",Dt,[t("span",Ut,d(r.last_name)+" "+d(r.first_name),1),i===0?(a(),o("span",Vt," Mas'ul ")):x("",!0)]),t("span",It,d(r.department_name),1)])]))),128))])])]),s[4]||(s[4]=t("div",{class:"w-full h-14"},null,-1))])):x("",!0),e.task.document?(a(),o("div",Ht,[t("div",At,[n(f,{label:"Kelib tushgan raqam",value:e.task.document.in_number},null,8,["value"]),n(f,{label:"Chiqish raqami",value:e.task.document.out_number},null,8,["value"]),n(f,{label:"Hujjat nomi",value:e.task.document.title,class:"md:col-span-2"},null,8,["value"]),n(f,{label:"Hujjat nomi",value:e.task.document.summary,class:"md:col-span-2"},null,8,["value"]),n(f,{label:"Hujjatni Imzololovchi",value:e.task.document.signer},null,8,["value"]),n(f,{label:"Jurnal",value:e.task.document.journal.name},null,8,["value"])]),e.task.document.attachments?.length?(a(),o("div",Pt,[s[5]||(s[5]=t("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),t("div",Nt,[(a(!0),o(w,null,S(e.task.document.attachments,r=>(a(),$(U,{key:r.id,file:r},null,8,["file"]))),128))])])):x("",!0)])):x("",!0),s[9]||(s[9]=t("div",{class:"w-full h-14"},null,-1)),e.task.responses&&e.task.responses.length?(a(),o("div",Lt,[(a(!0),o(w,null,S(e.task.responses,r=>(a(),o("div",{key:r.id,class:"mb-6 pb-4 last:border-none"},[t("div",Rt,[n(f,{label:"Yuboruvchi",value:r.user_full_name},null,8,["value"]),n(f,{label:"Berilgan javob",value:r.description},null,8,["value"]),n(f,{label:"Berilgan javob sanasi",value:e.task.responses?.[0]?.created_at?u(M)(e.task.responses[0].created_at).format("DD MMMM YYYY HH:mm"):"Javob berilmagan"},null,8,["value"])]),r.files?.length?(a(),o("div",Ot,[s[6]||(s[6]=t("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),t("div",Qt,[(a(!0),o(w,null,S(r.files,i=>(a(),$(U,{key:i.id,file:i},null,8,["file"]))),128))])])):x("",!0)]))),128))])):(a(),o("div",Jt," Hozircha javoblar mavjud emas. ")),e.task.responses?.length?(a(),o("div",Et,[e.task.status==="in_confirmation"?(a(),$(m,{key:0,onClick:s[0]||(s[0]=r=>g("done")),variant:"primary"},{default:k(()=>[...s[7]||(s[7]=[p(" Bajarildi ",-1)])]),_:1})):x("",!0),e.task.status==="in_confirmation"?(a(),$(m,{key:1,onClick:s[1]||(s[1]=r=>g("in_progress")),variant:"secondary"},{default:k(()=>[...s[8]||(s[8]=[p(" Qata ishlashga yuborish ",-1)])]),_:1})):x("",!0)])):x("",!0)],64)}}},Gt=Q(Kt,[["__scopeId","data-v-324eb771"]]),Wt={class:"mx-auto bg-[#F8FAFC] min-h-screen"},Xt={class:"flex items-center gap-1 px-4 bg-white border-b shadow-sm sticky top-0 z-20"},Zt=["onClick"],te={class:"font-bold text-[13px] uppercase tracking-wide"},ee={class:"grid grid-cols-12 gap-0 p-6"},se={class:"transition-all col-span-12 ease-in-out will-change-transform duration-300 bg-white"},ae={class:"bg-gray-50/50 space-y-4 py-4"},le={class:"flex flex-row justify-between gap-4"},oe={class:"flex flex-row w-9/12 items-center gap-4"},ne={class:"flex items-center gap-4"},ie={class:"h-[calc(100vh-14rem)] overflow-y-auto relative"},re={class:"p-4 bg-white border-t sticky bottom-0"},pe={__name:"MonitoringViews",setup(e){const l=H(),_=E(),v=W(),g=C("all"),h=C(null),s=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>l.all_tasks,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>l.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>l.in_progress,status:"in_progress"},{key:"in_confirmation",label:"Tasdiqlashda",color:"bg-gray-500",count:()=>l.in_confirmation,status:"in_confirmation"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>l.be_rejected,status:"be_rejected"}],m=c=>{l.setSelectedTask(c),_.openDrawer(Gt,{task:c},{title:"Topshiriq tafsilotlari",side:"right"})},r=async c=>{g.value=c.key,h.value=c.status||null,await l.setFilter("status",c.status)},i=K({due_date:"",assignee:[],created_at:""}),A=c=>l.fetchAll(c),P=c=>{i.assignee.includes(c)?i.assignee=[]:i.assignee=[c]},F=async()=>{const c=i.assignee.length>0?i.assignee[0]:null;await l.setFilter("status",h.value||""),await l.setFilter("due_date",i.due_date),await l.setFilter("assignee",c),await l.setFilter("created_at",i.created_at),await l.fetchAll(1)},N=async()=>{h.value=null,Object.keys(i).forEach(c=>i[c]=""),await F()};return D(()=>l.fetchAll()),D(()=>v.fetchUsers()),(c,y)=>{const T=q("UDatePicker"),z=q("UButton");return a(),o("div",Wt,[t("div",Xt,[(a(),o(w,null,S(s,b=>t("div",{key:b.key,onClick:de=>r(b),class:j(["flex items-center gap-3 py-5 px-4 cursor-pointer transition-all duration-200 border-b-2",g.value===b.key?"border-blue-600 bg-blue-50/50":"border-transparent hover:bg-gray-50 text-gray-500"])},[t("span",te,d(b.label),1),t("span",{class:j(["text-white text-xs px-2.5 py-1 rounded-lg font-bold shadow-sm",b.color])},d(b.count()),3)],10,Zt)),64))]),t("div",ee,[t("div",se,[t("div",ae,[y[3]||(y[3]=t("div",{class:"flex items-center justify-between"},[t("h2",{class:"text-sm font-black uppercase text-slate-700 flex items-center gap-2"},[t("div",{class:"w-1 h-5 bg-blue-600 rounded-full"}),p(" Topshiriqlar Nazorati ")])],-1)),t("div",le,[t("div",oe,[n(L,{options:u(v).users,"selected-ids":i.assignee,onSelect:P},null,8,["options","selected-ids"]),n(T,{modelValue:i.due_date,"onUpdate:modelValue":y[0]||(y[0]=b=>i.due_date=b),placeholder:"Bajarish muddati"},null,8,["modelValue"]),n(T,{modelValue:i.created_at,"onUpdate:modelValue":y[1]||(y[1]=b=>i.created_at=b),placeholder:"Ro'yxatga olingan sana"},null,8,["modelValue"])]),t("div",ne,[n(z,{variant:"hover",onClick:N,class:"!p-2"},{default:k(()=>[n(u(Z),{class:"w-5 h-5 text-gray-400"})]),_:1}),n(z,{variant:"primary",class:"justify-center",onClick:F},{default:k(()=>[n(u(X),{class:"w-4 h-4 mr-2"}),y[2]||(y[2]=p(" Qidirish ",-1))]),_:1})])])]),t("div",ie,[n(R,null,{thead:k(()=>[...y[4]||(y[4]=[t("th",{class:"sticky top-0 bg-white z-10 table-header"},"Hujjat",-1),t("th",{class:"sticky top-0 bg-white z-10 table-header"},"Mazmuni",-1),t("th",{class:"sticky top-0 bg-white z-10 table-header"},"Ijrochi",-1),t("th",{class:"sticky top-0 bg-white z-10 table-header"},"Yuborilgan",-1),t("th",{class:"sticky top-0 bg-white z-10 table-header"},"Muddat",-1),t("th",{class:"sticky top-0 bg-white z-10 table-header"},"Holati",-1)])]),tbody:k(()=>[(a(!0),o(w,null,S(u(l).tasks,b=>(a(),$(ft,{key:b.id,task:b,active:u(l).selectedTask?.id===b.id,onSelect:m},null,8,["task","active"]))),128))]),pagination:k(()=>[t("div",re,[n(G,{currentPage:u(l).pagination.currentPage,total:u(l).pagination.count,loading:u(l).loading,onChange:A},null,8,["currentPage","total","loading"])])]),_:1})])])])])}}};export{pe as default};
