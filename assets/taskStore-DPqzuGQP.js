import{U as n,y as l}from"./index-BTtPa-yH.js";const d=s=>n.post("/tasks/",s),u=({page:s=1,status:t,due_date:a,assignee:e,created_at:i}={})=>{const r=new URLSearchParams;return r.set("page",s),t&&r.set("status",t),a&&r.set("due_date",a),e&&r.set("assignee",e),i&&r.set("created_at",i),n.get("/tasks/",{params:r})},h=s=>n.get(`/task_view/${s}`),o=(s,t)=>n.patch(`/tasks/${s}/`,t),f=l("task",{state:()=>({tasks:[],selectedTask:null,loading:!1,error:null,lastMessage:null,pagination:{previous:null,next:null,count:0,currentPage:1},filters:{status:"",due_date:"",assignee:"",created_at:""},all_tasks:0,in_progress:0,in_confirmation:0,be_rejected:0,done:0}),actions:{async createTask(s){this.loading=!0,this.error=null;try{const t=await d(s);return t?.status===201?(this.tasks.push(t.data),{success:!0,data:t.data}):{success:!1,error:"Task yaratishda xatolik"}}catch(t){return{success:!1,error:t.response?.data||t.message}}finally{this.loading=!1}},async updateTask(s,t){this.loading=!0,this.error=null;try{const a=await o(s,t);if(a?.status===200){const e=this.tasks.findIndex(i=>i.id===s);return e!==-1&&(this.tasks[e]=a.data),this.selectedTask?.id===s&&(this.selectedTask=a.data),{success:!0,data:a.data}}return{success:!1,error:"Task yangilashda xatolik"}}catch(a){return{success:!1,error:a.response?.data||a.message}}finally{this.loading=!1}},async updateTaskStatus(s,t){try{if((await o(s,{status:t}))?.status===200){const e=this.tasks.findIndex(i=>i.id===s);return e!==-1&&(this.tasks[e].status=t),{success:!0}}}catch(a){return console.error("Statusni yangilashda xatolik:",a),{success:!1,error:a.message}}},async fetchAll(s=1){this.loading=!0,this.error=null;try{const t={page:s,...this.filters},a=await u(t),i=Math.ceil((a.data.count??0)/10);if(this.tasks=[...a.data.results],this.pagination.currentPage=s,this.pagination.previous=s>1?s-1:null,this.pagination.next=s<i?s+1:null,this.pagination.count=a.data.count??0,this.all_tasks=a.data.all_tasks??0,this.in_progress=a.data.in_progress??0,this.in_confirmation=a.data.in_confirmation??0,this.be_rejected=a.data.be_rejected??0,this.done=a.data.done??0,this.selectedTask){const r=this.tasks.find(c=>c.id===this.selectedTask.id);r?this.selectedTask=r:this.selectedTask=null}return this.tasks}catch(t){this.error=t?.response?.data?.message||t.message||"Server xatosi"}finally{this.loading=!1}},async setFilter(s,t){this.filters[s]=t,await this.fetchAll(1)},async fetchTaskById(s){try{const t=await h(s);if(t?.data){const a=this.tasks.findIndex(e=>e.id===s);return a!==-1&&(this.tasks[a]={...t.data}),this.selectedTask?.id===s&&(this.selectedTask={...t.data}),t.data}}catch(t){console.error("Vazifani yangilashda xatolik:",t)}},setSelectedTask(s){this.selectedTask=s}}});export{f as u};
