import{k as E,x as O,d as T,B as z,l as L,A as P,r as h,a as b,o as x,b as i,g as n,v as u,h as g,f as a,w as H,V as K,t as W,W as X,F as Y,C as G,j as U}from"./index-BtXiaCr0.js";import{u as J}from"./taskStore-vh3Sz-Ir.js";import{u as Q}from"./usersStore-DvEPUxlW.js";import{u as R}from"./subjectStore-CrR0XgQQ.js";import{u as Z,X as ee}from"./useFormValidate-Db0qx1D3.js";import{M as se}from"./MultiColumnUserSelect-eF6ZlhSw.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=E("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ie={class:"w-[100vw] md:w-[80vw] 2xl:w-[50vw] h-[90vh] flex flex-col bg-white rounded-xl shadow-lg"},ae={class:"flex justify-between items-center p-4 border-b"},oe={class:"font-bold uppercase text-md"},ne={class:"p-6 flex-1 h-[calc(80vh-64px)] overflow-y-scroll space-y-6"},le={class:"grid grid-cols-2 gap-4"},re={class:"flex items-center pt-2 justify-start gap-2 col-span-2"},de={class:"relative inline-flex items-center cursor-pointer"},ue={class:"flex flex-col gap-2"},ce={class:"flex flex-col gap-2"},pe={class:"w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold text-sm"},me={class:"flex flex-col flex-1 leading-tight"},ge={class:"text-sm font-medium text-blue-900"},fe={class:"text-xs text-blue-600"},_e={class:"flex justify-end gap-3 p-4 border-t"},je={__name:"TaskForm",props:{id:Number,existingTask:Object},setup(v){const l=v,S=O(),y=J(),r=Q(),f=R(),c=T(!1),p=T(!1),{form:t,errors:d,validate:V,resetForm:q}=Z({document_id:l.id,subject_id:null,due_date:"",description:"",assignees_ids:[]},{subject_id:{required:!0,message:"Topshiriq tanlanishi majburiy"},due_date:{required:!0,message:"Sana majburiy"},description:{required:!0,message:"Mazmuni majburiy"},assignees_ids:{custom:s=>!Array.isArray(s)||!s.length?"Kamida bitta ijrochi tanlang":""}}),C=z(()=>Object.fromEntries(r.users.map(s=>[s.id,s]))),_=s=>C.value[s],B=s=>{const e=_(s);return e?`${e.first_name} ${e.last_name}`:"Unknown"},M=s=>{const e=_(s);return e?`${e.first_name?.[0]||""}${e.last_name?.[0]||""}`:"?"},A=s=>_(s)?.department?.name||"";L(async()=>{await Promise.all([r.fetchUsers(),f.fetchAll()]),l.existingTask&&(t.document_id=l.existingTask.document?.id||null,t.subject_id=l.existingTask.subject?.id||null,t.due_date=l.existingTask.due_date||"",t.description=l.existingTask.description||"",t.assignees_ids=l.existingTask.assignees?.map(s=>s.id)||[],p.value=t.assignees_ids.length===r.users.length)}),P(p,s=>{r.users.length&&(t.assignees_ids=s?r.users.map(e=>e.id):[])});const k=()=>S.close(),w=()=>{q(),k()},F=s=>{const e=t.assignees_ids.indexOf(s);e===-1?t.assignees_ids.push(s):t.assignees_ids.splice(e,1)},I=s=>{t.assignees_ids=t.assignees_ids.filter(e=>e!==s)},N=s=>{typeof s=="object"&&Object.keys(s).forEach(e=>{d[e]=Array.isArray(s[e])?s[e].join(", "):s[e]})},j=async()=>{if(V()){c.value=!0;try{const s={document_id:t.document_id,subject_id:t.subject_id,due_date:t.due_date,description:t.description,assignees_ids:t.assignees_ids},e=l.existingTask?await y.updateTask(l.existingTask.id,s):await y.createTask(s);e.success?w():N(e.error)}catch(s){console.error(s)}finally{c.value=!1}}};return(s,e)=>{const m=h("UButton"),$=h("USelect"),D=h("UTextarea");return x(),b("div",ie,[i("div",ae,[i("p",oe,u(v.existingTask?"Topshiriqni tahrirlash":"Topshiriq yaratish"),1),n(m,{class:"bg-gray-700 rounded-full p-1",onClick:k},{default:g(()=>[n(a(ee),{class:"w-3 h-3 text-white","stroke-width":"3"})]),_:1})]),i("div",ne,[i("form",{onSubmit:H(j,["prevent"]),class:"flex flex-col gap-4"},[i("div",le,[n($,{modelValue:a(t).subject_id,"onUpdate:modelValue":e[0]||(e[0]=o=>a(t).subject_id=o),options:a(f).subjects,label:"Topshiriq",placeholder:"Topshiriq tanlang","option-label":"title","option-value":"id",loading:a(f).loading,error:a(d).subject_id},null,8,["modelValue","options","loading","error"]),n(K,{modelValue:a(t).due_date,"onUpdate:modelValue":e[1]||(e[1]=o=>a(t).due_date=o),label:"Boshlanish sanasi",placeholder:"Sanani tanlang",error:a(d).due_date},null,8,["modelValue","error"]),i("div",re,[e[6]||(e[6]=i("span",{class:"text-md font-medium"},"Barchasini Ijrochilarni tanlash",-1)),i("label",de,[W(i("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":e[2]||(e[2]=o=>p.value=o)},null,512),[[X,p.value]]),e[4]||(e[4]=i("div",{class:"w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-blue-500 peer-focus:ring-2 peer-focus:ring-blue-300 transition-colors"},null,-1)),e[5]||(e[5]=i("div",{class:"absolute left-0.5 top-0.5 w-5 h-5 bg-white rounded-full peer-checked:translate-x-full transition-transform shadow"},null,-1))])])]),i("div",ue,[n(se,{options:a(r).users,"selected-ids":a(t).assignees_ids,label:"Ijrochilar",error:a(d).assignees_ids,onSelect:F},null,8,["options","selected-ids","error"]),i("div",ce,[(x(!0),b(Y,null,G(a(t).assignees_ids,o=>(x(),b("div",{key:o,class:"relative flex items-center gap-3 w-full px-4 py-2 bg-blue-50 border border-blue-200 rounded-xl"},[i("div",pe,u(M(o)),1),i("div",me,[i("span",ge,u(B(o)),1),i("span",fe,u(A(o)),1)]),n(m,{type:"button",onClick:he=>I(o)},{default:g(()=>[n(a(te),{class:"w-5 h-5 text-gray-400"})]),_:1},8,["onClick"])]))),128))])]),n(D,{modelValue:a(t).description,"onUpdate:modelValue":e[3]||(e[3]=o=>a(t).description=o),label:"Topshiriq mazmuni",rows:"4",placeholder:"Topshiriq mazmunini kiriting...",error:a(d).description},null,8,["modelValue","error"])],32)]),i("div",_e,[n(m,{variant:"ghost",onClick:w},{default:g(()=>[...e[7]||(e[7]=[U("Bekor qilish",-1)])]),_:1}),n(m,{variant:"primary",disabled:c.value,onClick:j},{default:g(()=>[U(u(c.value?"Yuborilmoqda...":"Saqlash va yuborish"),1)]),_:1},8,["disabled"])])])}}};export{je as _};
