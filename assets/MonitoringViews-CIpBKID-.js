import{M as L}from"./MultiColumnUserSelect-DKD9eij1.js";import{B as Q}from"./BaseCrudTable-CjDNjMgw.js";import{k as D,C as M,a as n,o as a,b as e,v as x,q as p,F as y,B as $,f as o,O as B,n as S,x as V,d as C,c as w,$ as R,j,g as i,h as _,D as z,_ as I,e as O,r as q,M as J,Q as E,l as K,R as G}from"./index-5YwSdCnv.js";import{S as W,_ as X}from"./UPagination-Dhicb2Kh.js";import{u as P}from"./taskStore-CA_W_gp0.js";import{u as Z}from"./usersStore-Da2g4WZ0.js";import{_ as f,a as ee}from"./UserListItem-D0FFpLqf.js";import{_ as Y}from"./UFileCard-BkLL4Tme.js";import{T as te}from"./trash-2-BBDNetmq.js";/* empty css                                                                      */import"./chevron-left-CIUQZrWK.js";import"./chevron-right-p-AgzAN4.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=D("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=D("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),le={class:"px-3 py-4 w-[180px]"},ne={class:"h-10 flex flex-col justify-center"},oe={class:"text-sm font-extrabold truncate w-40 leading-5 block"},ie={class:"text-xs text-[#697696] truncate w-36 leading-4 block"},re={class:"px-3 py-4 max-w-xs"},de={class:"h-10 flex items-center"},ce={class:"text-sm font-medium text-black line-clamp-2 leading-5"},ue={class:"px-3 py-4 w-[160px]"},ge={class:"h-10 flex flex-col justify-center gap-1"},me={key:0,class:"text-[13px] font-semibold text-gray-700 bg-gray-100 px-2 py-0.5 rounded-md w-fit h-[24px] flex items-center"},be={class:"h-3"},he={key:0,class:"text-[10px] text-blue-500 font-bold"},xe={class:"h-10 flex items-center"},fe={class:"text-sm text-[#697696] leading-5"},pe={class:"px-3 py-4 w-[130px]"},ye={class:"h-10 flex items-center"},ve={__name:"MonitoringItem",props:{task:{type:Object,required:!0},active:{type:Boolean,default:!1}},setup(s){const t=s,v=M(()=>({in_progress:"bg-blue-100 text-blue-700",in_confirmation:"bg-amber-100 text-amber-700",done:"bg-emerald-100 text-emerald-700",be_rejected:"bg-rose-100 text-rose-700"})[t.task.status]||"bg-gray-100 text-gray-700"),k=M(()=>({in_progress:"Jarayonda",in_confirmation:"Tasdiqlashda",done:"Bajarildi",be_rejected:"Bajarilmagan"})[t.task.status]||t.task.status);return(m,h)=>(a(),n("tr",{class:S(["h-[80px] divide-x border-b box-border transition-colors cursor-pointer",[s.active?"bg-[#4076FF0D]":"hover:bg-[#4076FF05]"]]),onClick:h[0]||(h[0]=l=>m.$emit("select",s.task))},[e("td",le,[e("div",ne,[e("span",oe,x(s.task.document.in_number),1),e("span",ie,x(s.task.document.out_number),1)])]),e("td",re,[e("div",de,[e("span",ce,x(s.task.document.summary),1)])]),e("td",ue,[e("div",ge,[s.task.assignees?.length>0?(a(),n("div",me,x(s.task.assignees[0].last_name)+" "+x(s.task.assignees[0].first_name[0])+". ",1)):p("",!0),e("div",be,[s.task.assignees?.length>1?(a(),n("span",he," +"+x(s.task.assignees.length-1)+" ijrochi ",1)):p("",!0)])])]),(a(!0),n(y,null,$([s.task.document.created_at,s.task.due_date],l=>(a(),n("td",{key:l,class:"px-3 py-4 w-[140px]"},[e("div",xe,[e("span",fe,x(o(B)(l).format("DD MMMM YYYY")),1)])]))),128)),e("td",pe,[e("div",ye,[e("span",{class:S(["px-3 py-1 rounded-full text-[12px] h-7 flex items-center tracking-wider w-24",v.value])},x(k.value),3)])])],2))}},ke={class:"w-[90vw] md:w-[400px] flex flex-col bg-white rounded-2xl shadow-2xl overflow-hidden"},we={class:"text-lg font-black text-gray-800 uppercase tracking-tight"},_e={class:"text-sm text-gray-500 mt-1 px-4 leading-relaxed"},$e={class:"font-bold underline"},je={class:"p-4 bg-white flex flex-col gap-2"},Se={__name:"TaskResponsStatusForm",props:{taskId:{type:Number,required:!0},targetStatus:{type:String,required:!0}},setup(s){const t=s,v=V(),k=P(),m=C(!1),h=async()=>{m.value=!0;try{(await k.updateTaskStatus(t.taskId,t.targetStatus)).success&&(v.close(),await k.fetchAll())}catch(l){console.error(l)}finally{m.value=!1}};return(l,g)=>(a(),n("div",ke,[e("div",{class:S(["p-6 text-center border-b",s.targetStatus==="done"?"bg-emerald-50":"bg-amber-50"])},[e("div",{class:S(["inline-flex p-3 rounded-full mb-3",s.targetStatus==="done"?"bg-emerald-100 text-emerald-600":"bg-amber-100 text-amber-600"])},[s.targetStatus==="done"?(a(),w(o(R),{key:0,class:"w-8 h-8"})):(a(),w(o(ae),{key:1,class:"w-8 h-8"}))],2),e("h3",we,x(s.targetStatus==="done"?"Tasdiqlaysizmi?":"Qayta ishlashga qaytarasizmi?"),1),e("p",_e,[g[1]||(g[1]=j(" Ushbu topshiriq holatini ",-1)),e("span",$e,x(s.targetStatus==="done"?"Bajarildi":"Qayta ishlash"),1),g[2]||(g[2]=j(" ga o'zgartirmoqchisiz. ",-1))])],2),e("div",je,[i(z,{onClick:h,disabled:m.value,class:S([s.targetStatus==="done"?"bg-emerald-600 hover:bg-emerald-700":"bg-amber-600 hover:bg-amber-700","w-full text-white py-3.5 rounded-xl font-bold text-sm shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95 disabled:opacity-50"])},{default:_(()=>[m.value?(a(),w(o(se),{key:0,class:"w-4 h-4 animate-spin"})):p("",!0),g[3]||(g[3]=j(" Ha, tasdiqlayman ",-1))]),_:1},8,["disabled","class"]),i(z,{onClick:g[0]||(g[0]=c=>o(v).close()),class:"w-full py-3 text-sm font-bold text-gray-400 hover:text-gray-600 transition-colors"},{default:_(()=>[...g[4]||(g[4]=[j(" Bekor qilish ",-1)])]),_:1})])]))}},Me={key:0},Be={class:"grid grid-cols-2 gap-4 pb-4 p-[24px]"},Ce={class:"w-full flex flex-col border-t border-gray-100 bg-white shadow-lg rounded-lg mt-4"},qe={class:"flex items-center justify-between px-6 py-3 border-b border-gray-50"},Fe={class:"font-bold text-gray-800 text-base flex items-center gap-2"},Te={class:"ml-1 text-xs bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full"},Ue={class:"max-h-[280px] overflow-y-auto custom-scrollbar"},ze={class:"max-h-[280px] overflow-y-auto custom-scrollbar divide-y divide-gray-50"},Ye={class:"divide-y divide-gray-100"},De={key:1,class:"p-[24px] border-gray-100 bg-white shadow-sm rounded-lg"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4 pb-4"},Ie={key:0},Pe={class:"grid grid-cols-1 gap-2"},He={key:2,class:"p-[24px] border-gray-100 bg-white rounded-lg"},Ae={class:"grid grid-cols-1 gap-4 pb-4"},Ne={key:0},Le={class:"grid grid-cols-1 gap-2"},Qe={key:3,class:"p-[24px] text-gray-500 text-center"},Re={key:4,class:"grid grid-cols-1 gap-4 px-4"},Oe={__name:"MonitoringShow",props:{task:{type:Object,default:null}},setup(s){const t=s,v=V(),k=O();M(()=>t.task?.responses?t.task.responses.find(h=>h.user===k.user?.id):null);const m=h=>{v.open(Se,{taskId:t.task.id,targetStatus:h,taskTitle:t.task.subject?.title})};return(h,l)=>{const g=q("UButton");return a(),n(y,null,[s.task?(a(),n("div",Me,[e("div",Be,[i(f,{label:"Bajarish muddati",value:o(B)(s.task.due_date).format("DD MMMM YYYY")},null,8,["value"]),i(f,{label:"Topshiriq",value:s.task.subject.title},null,8,["value"]),i(f,{label:"Topshiriq mazmun",value:s.task.description,class:"col-span-2"},null,8,["value"])]),e("div",Ce,[e("div",qe,[e("h3",Fe,[l[2]||(l[2]=e("span",{class:"w-1.5 h-5 bg-blue-600 rounded-full"},null,-1)),l[3]||(l[3]=j(" Ijrochilar ",-1)),e("span",Te,x(s.task.assignees?.length||0),1)])]),e("div",Ue,[e("div",ze,[e("div",Ye,[(a(!0),n(y,null,$(s.task.assignees,(c,r)=>(a(),w(ee,{key:c.id,user:c,"is-responsible":r===0},null,8,["user","is-responsible"]))),128))])])])]),l[4]||(l[4]=e("div",{class:"w-full h-14"},null,-1))])):p("",!0),s.task.document?(a(),n("div",De,[e("div",Ve,[i(f,{label:"Kiruvchi raqam",value:s.task.document.in_number},null,8,["value"]),i(f,{label:"Chiqish raqam",value:s.task.document.out_number},null,8,["value"]),i(f,{label:"Hujjat nomi",value:s.task.document.title,class:"md:col-span-2"},null,8,["value"]),i(f,{label:"Hujjat mazmuni",value:s.task.document.summary,class:"md:col-span-2"},null,8,["value"]),i(f,{label:"Hujjatni Imzololovchi",value:s.task.document.signer,class:"md:col-span-2"},null,8,["value"])]),s.task.document.attachments?.length?(a(),n("div",Ie,[l[5]||(l[5]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",Pe,[(a(!0),n(y,null,$(s.task.document.attachments,c=>(a(),w(Y,{key:c.id,file:c},null,8,["file"]))),128))])])):p("",!0)])):p("",!0),l[9]||(l[9]=e("div",{class:"w-full h-14"},null,-1)),s.task.responses&&s.task.responses.length?(a(),n("div",He,[(a(!0),n(y,null,$(s.task.responses,c=>(a(),n("div",{key:c.id,class:"mb-6 pb-4 last:border-none"},[e("div",Ae,[i(f,{label:"Yuboruvchi",value:c.user_full_name},null,8,["value"]),i(f,{label:"Berilgan javob",value:c.description},null,8,["value"]),i(f,{label:"Berilgan javob sanasi",value:s.task.responses?.[0]?.created_at?o(B)(s.task.responses[0].created_at).format("DD MMMM YYYY HH:mm"):"Javob berilmagan"},null,8,["value"])]),c.files?.length?(a(),n("div",Ne,[l[6]||(l[6]=e("h3",{class:"font-semibold mb-2"},"Fayllar:",-1)),e("div",Le,[(a(!0),n(y,null,$(c.files,r=>(a(),w(Y,{key:r.id,file:r},null,8,["file"]))),128))])])):p("",!0)]))),128))])):(a(),n("div",Qe," Hozircha javoblar mavjud emas. ")),s.task.responses?.length?(a(),n("div",Re,[s.task.status==="in_confirmation"?(a(),w(g,{key:0,onClick:l[0]||(l[0]=c=>m("done")),variant:"primary"},{default:_(()=>[...l[7]||(l[7]=[j(" Nazoratdan yechish ",-1)])]),_:1})):p("",!0),s.task.status==="in_confirmation"?(a(),w(g,{key:1,onClick:l[1]||(l[1]=c=>m("in_progress")),variant:"secondary"},{default:_(()=>[...l[8]||(l[8]=[j(" Qata ishlashga yuborish ",-1)])]),_:1})):p("",!0)])):p("",!0)],64)}}},Je=I(Oe,[["__scopeId","data-v-255f41ce"]]),Ee={},Ke={class:"h-[80px] divide-x border-b animate-pulse box-border"};function Ge(s,t){return a(),n("tr",Ke,[t[1]||(t[1]=e("td",{class:"px-3 py-4 w-[180px]"},[e("div",{class:"h-10 flex flex-col justify-center gap-2"},[e("div",{class:"h-4 bg-gray-200 rounded w-32"}),e("div",{class:"h-3 bg-gray-100 rounded w-24"})])],-1)),t[2]||(t[2]=e("td",{class:"px-3 py-4 max-w-xs"},[e("div",{class:"h-10 flex flex-col justify-center gap-2"},[e("div",{class:"h-3 bg-gray-200 rounded w-full"}),e("div",{class:"h-3 bg-gray-200 rounded w-4/5"})])],-1)),t[3]||(t[3]=e("td",{class:"px-3 py-4 w-[160px]"},[e("div",{class:"h-10 flex flex-col justify-center gap-2"},[e("div",{class:"h-6 bg-gray-200 rounded-md w-28"}),e("div",{class:"h-3 bg-gray-50 rounded w-16"})])],-1)),(a(),n(y,null,$(2,v=>e("td",{key:v,class:"px-3 py-4 w-[140px]"},[...t[0]||(t[0]=[e("div",{class:"h-10 flex items-center"},[e("div",{class:"h-4 bg-gray-100 rounded w-24"})],-1)])])),64)),t[4]||(t[4]=e("td",{class:"px-3 py-4 w-[130px]"},[e("div",{class:"h-10 flex items-center"},[e("div",{class:"h-7 bg-gray-200 rounded-full w-24"})])],-1))])}const We=I(Ee,[["render",Ge]]),Xe={class:"mx-auto bg-[#F8FAFC] h-screen overflow-y-auto"},Ze={class:"flex items-center gap-1 px-4 bg-white border-b shadow-sm sticky top-0 z-20"},et=["onClick"],tt={class:"font-bold text-[13px] uppercase"},st={class:"grid grid-cols-12 gap-0 p-6"},at={class:"transition-all col-span-12 ease-in-out will-change-transform duration-300"},lt={class:"space-y-4 py-4"},nt={class:"flex flex-row justify-between gap-4"},ot={class:"flex flex-row w-9/12 items-center gap-4"},it={class:"flex items-center gap-4"},rt={class:"relative"},dt={key:0},ct={class:"p-4 sticky bottom-0"},$t={__name:"MonitoringViews",setup(s){const t=P(),v=J(),k=Z(),m=C("all"),h=C(null),l=[{key:"all",label:"Barchasi",color:"bg-orange-500",count:()=>t.all_tasks,status:""},{key:"done",label:"Bajarilgan",color:"bg-green-500",count:()=>t.done,status:"done"},{key:"in_progress",label:"Bajarilmoqda",color:"bg-blue-500",count:()=>t.in_progress,status:"in_progress"},{key:"in_confirmation",label:"Tasdiqlashda",color:"bg-indigo-500",count:()=>t.in_confirmation,status:"in_confirmation"},{key:"be_rejected",label:"Bajarilmagan topshiriqlar",color:"bg-red-500",count:()=>t.be_rejected,status:"be_rejected"}],g=b=>{t.setSelectedTask(b),v.openDrawer(Je,{task:b},{title:"Topshiriq tafsilotlari",side:"right"})},c=async b=>{m.value=b.key,h.value=b.status||null,await t.setFilter("status",b.status)},r=E({due_date:"",assignee:[],created_at:""}),H=b=>t.fetchAll(b),A=b=>{r.assignee.includes(b)?r.assignee=[]:r.assignee=[b]},F=async()=>{const b=r.assignee.length>0?r.assignee[0]:null;await t.setFilter("status",h.value||""),await t.setFilter("due_date",r.due_date),await t.setFilter("assignee",b),await t.setFilter("created_at",r.created_at),await t.fetchAll(1)},N=async()=>{h.value=null,r.due_date="",r.created_at="",r.assignee=[],await F()};return K(async()=>{await Promise.all([t.fetchAll(),k.fetchUsersForSelect()])}),G(()=>{t.filters={status:"",due_date:"",assignee:[],created_at:"",search:""},t.currentPage=1}),(b,u)=>{const T=q("UDatePicker"),U=q("UButton");return a(),n("div",Xe,[e("div",Ze,[(a(),n(y,null,$(l,d=>e("div",{key:d.key,onClick:ut=>c(d),class:S(["flex items-center gap-3 py-5 px-4 cursor-pointer transition-all duration-200 border-b-2",m.value===d.key?"border-blue-600 bg-blue-50/50":"border-transparent hover:bg-gray-50 text-gray-500"])},[e("span",tt,x(d.label),1),e("span",{class:S(["text-white text-xs px-2.5 py-1 rounded-xl font-bold shadow-sm",d.color])},x(d.count()),3)],10,et)),64))]),e("div",st,[e("div",at,[e("div",lt,[u[4]||(u[4]=e("div",{class:"flex items-center justify-between"},[e("h2",{class:"text-sm font-black uppercase text-slate-700 flex items-center gap-2"},[e("div",{class:"w-1 h-5 bg-blue-600 rounded-full"}),j(" Topshiriqlar Nazorati ")])],-1)),e("div",nt,[e("div",ot,[i(L,{options:o(k).searchUsers,"selected-ids":r.assignee,onSelect:A,onSearch:u[0]||(u[0]=d=>o(k).fetchUsersForSelect(d))},null,8,["options","selected-ids"]),i(T,{modelValue:r.due_date,"onUpdate:modelValue":u[1]||(u[1]=d=>r.due_date=d),placeholder:"Bajarish muddati"},null,8,["modelValue"]),i(T,{modelValue:r.created_at,"onUpdate:modelValue":u[2]||(u[2]=d=>r.created_at=d),placeholder:"Ro'yxatga olingan sana"},null,8,["modelValue"])]),e("div",it,[i(U,{variant:"hover",onClick:N,class:"!p-2"},{default:_(()=>[i(o(te),{class:"w-5 h-5 text-gray-400"})]),_:1}),i(U,{variant:"primary",class:"justify-center",onClick:F},{default:_(()=>[i(o(W),{class:"w-4 h-4 mr-2"}),u[3]||(u[3]=j(" Qidirish ",-1))]),_:1})])])]),e("div",rt,[i(Q,null,{thead:_(()=>[...u[5]||(u[5]=[e("th",{class:"sticky top-0 bg-white table-header"},"Hujjat",-1),e("th",{class:"sticky top-0 bg-white table-header"},"Mazmuni",-1),e("th",{class:"sticky top-0 bg-white table-header"},"Ijrochi",-1),e("th",{class:"sticky top-0 bg-white table-header"},"Yuborilgan",-1),e("th",{class:"sticky top-0 bg-white table-header"},"Muddat",-1),e("th",{class:"sticky top-0 bg-white table-header"},"Holati",-1)])]),tbody:_(()=>[o(t).loading?(a(!0),n(y,{key:0},$(o(t).tasks.length>0?o(t).tasks.length:10,d=>(a(),w(We,{key:"skeleton-"+d}))),128)):(a(),n(y,{key:1},[(a(!0),n(y,null,$(o(t).tasks,d=>(a(),w(ve,{key:d.id,task:d,active:o(t).selectedTask?.id===d.id,onSelect:g},null,8,["task","active"]))),128)),o(t).tasks.length===0?(a(),n("tr",dt,[...u[6]||(u[6]=[e("td",{colspan:"6",class:"py-10 text-center text-gray-400"}," Ma'lumotlar topilmadi ",-1)])])):p("",!0)],64))]),pagination:_(()=>[e("div",ct,[i(X,{currentPage:o(t).pagination.currentPage,previous:o(t).pagination.previous,next:o(t).pagination.next,lastPage:Math.ceil(o(t).pagination.count/10),total:o(t).pagination.count,loading:o(t).loading,onChange:H},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),_:1})]),u[7]||(u[7]=e("div",{class:"w-full h-44"},null,-1))])])])}}};export{$t as default};
