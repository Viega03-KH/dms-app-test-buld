import{U as a,y as l,u as i}from"./index-5YwSdCnv.js";const n=(s=1,e="")=>{const r=Number(s)||1;return a.get(`/users?page=${r}&search=${e}`)},h=()=>a.get("/all"),u=s=>a.post("/users/",s),d=s=>a.get(`/users/${s}/`),g=(s,e)=>a.put(`/users/${s}/`,e),y=s=>a.delete(`/users/${s}/`),c=s=>{if(!s)return null;const e=new URL(s);return parseInt(e.searchParams.get("page"))||1},U=l("users",{state:()=>({users:[],searchQuery:"",searchUsers:[],pagination:{previous:1,next:1,count:0,currentPage:1},selectedUser:null,loading:!1,error:null}),actions:{_handleError(s,e){const r=i(),t=s.response?.data?.message||e||"Xatolik yuz berdi";throw this.error=t,r.show(t,"error"),s},async fetchUsersNotPage(){this.loading=!0,this.error=null;try{const s=await h();this.users=s.data.data}catch(s){this._handleError(s,"Foydalanuvchilarni olishda xato")}finally{this.loading=!1}},async fetchUsersForSelect(s=""){try{const e=await n(1,s);this.searchUsers=e.data.results}catch(e){console.error("Select qidiruvida xato:",e)}},async fetchUsers(s=1){this.loading=!0,this.error=null;try{this.pagination.currentPage=s;const e=await n(s,this.searchQuery);this.users=e.data.results,this.pagination.previous=c(e.data.previous),this.pagination.next=c(e.data.next),this.pagination.count=e.data.count}catch(e){this._handleError(e,"Ro'yxatni yuklashda xato")}finally{this.loading=!1}},setSearchQuery(s){this.searchQuery=s,this.fetchUsers(1)},async fetchUser(s){this.loading=!0;try{const e=await d(s);return this.selectedUser=e.data,e.data}catch(e){this._handleError(e,"Ma'lumotlarni yuklashda xato")}finally{this.loading=!1}},async addUser(s){this.loading=!0;const e=i();try{const r=await u(s);return await this.fetchUsers(),e.show("Muvaffaqiyatli qo'shildi!","success"),{success:!0,data:r.data}}catch(r){this.error=r.message;const t=r.response?.data?.message||"Qo'shib bo'lmadi";return e.show(t,"error"),{success:!1,error:t}}finally{this.loading=!1}},async editUser(s,e){this.loading=!0,this.error=null;const r=i();try{const t=await g(s,e);return await this.fetchUsers(),r.show("Muvaffaqiyatli yangilandi!","success"),{success:!0,data:t.data}}catch(t){const o=t.response?.data?.message||"Yangilashda xato";return this.error=o,r.show(o,"error"),{success:!1,error:o}}finally{this.loading=!1}},async removeUser(s){this.loading=!0;const e=i();try{await y(s),await this.fetchUsers(),e.show("Muvaffaqiyatli o'chirildi!","success")}catch(r){this._handleError(r,"O'chirishda xatolik")}finally{this.loading=!1}}}});export{U as u};
