import{O as n,y as l}from"./index-NpEBLJbS.js";const d=s=>n.post("/tasks/",s),u=({page:s=1,status:t,due_date:e,assignee:a,created_at:i}={})=>{const r=new URLSearchParams;return r.set("page",s),t&&r.set("status",t),e&&r.set("due_date",e),a&&r.set("assignee",a),i&&r.set("created_at",i),n.get("/tasks/",{params:r})},h=s=>n.get(`/task_view/${s}`),c=(s,t)=>n.patch(`/tasks/${s}/`,t),f=l("task",{state:()=>({tasks:[],selectedTask:null,loading:!1,error:null,lastMessage:null,pagination:{previous:null,next:null,count:0,currentPage:1},filters:{status:"",due_date:"",assignee:"",created_at:""},in_progress:0,be_rejected:0,done:0}),actions:{async createTask(s){this.loading=!0,this.error=null;try{const t=await d(s);return t?.status===201?(this.tasks.push(t.data),{success:!0,data:t.data}):{success:!1,error:"Task yaratishda xatolik"}}catch(t){return{success:!1,error:t.response?.data||t.message}}finally{this.loading=!1}},async updateTask(s,t){this.loading=!0,this.error=null;try{const e=await c(s,t);if(e?.status===200){const a=this.tasks.findIndex(i=>i.id===s);return a!==-1&&(this.tasks[a]=e.data),this.selectedTask?.id===s&&(this.selectedTask=e.data),{success:!0,data:e.data}}return{success:!1,error:"Task yangilashda xatolik"}}catch(e){return{success:!1,error:e.response?.data||e.message}}finally{this.loading=!1}},async updateTaskStatus(s,t){try{if((await c(s,{status:t}))?.status===200){const a=this.tasks.findIndex(i=>i.id===s);return a!==-1&&(this.tasks[a].status=t),{success:!0}}}catch(e){return console.error("Statusni yangilashda xatolik:",e),{success:!1,error:e.message}}},async fetchAll(s=1){this.loading=!0,this.error=null;try{const t={page:s,...this.filters},e=await u(t),i=Math.ceil((e.data.count??0)/10);if(this.tasks=[...e.data.results],this.pagination.currentPage=s,this.pagination.previous=s>1?s-1:null,this.pagination.next=s<i?s+1:null,this.pagination.count=e.data.count??0,this.in_progress=e.data.in_progress??0,this.be_rejected=e.data.be_rejected??0,this.done=e.data.done??0,this.selectedTask){const r=this.tasks.find(o=>o.id===this.selectedTask.id);r?this.selectedTask=r:this.selectedTask=null}return this.tasks}catch(t){this.error=t?.response?.data?.message||t.message||"Server xatosi"}finally{this.loading=!1}},async setFilter(s,t){this.filters[s]=t,await this.fetchAll(1)},async fetchTaskById(s){try{const t=await h(s);if(t?.data){const e=this.tasks.findIndex(a=>a.id===s);return e!==-1&&(this.tasks[e]={...t.data}),this.selectedTask?.id===s&&(this.selectedTask={...t.data}),t.data}}catch(t){console.error("Vazifani yangilashda xatolik:",t)}},setSelectedTask(s){this.selectedTask=s}}});export{f as u};
