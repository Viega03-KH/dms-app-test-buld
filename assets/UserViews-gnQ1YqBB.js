import{u as q}from"./usersStore-Da2g4WZ0.js";import{u as I,x as $,r as y,a as w,o as U,b as t,g as s,h as p,f as e,X as j,j as V,C as D,l as z,v as h,w as T,d as Y,F as C,B as E,O as N}from"./index-5YwSdCnv.js";import{B as O}from"./BaseCrudTable-CjDNjMgw.js";import{S as L,_ as A}from"./UPagination-Dhicb2Kh.js";import{u as Q,S as X}from"./useFormValidate-CYKOA1hY.js";import{u as R}from"./departmentStore-CslpbvBc.js";import{u as G}from"./user-BRUuMk4P.js";import{T as B}from"./trash-2-BBDNetmq.js";import{_ as H}from"./BaseTableHeader-CGL6DNdt.js";/* empty css                                                                      */import"./chevron-left-CIUQZrWK.js";import"./chevron-right-p-AgzAN4.js";import"./plus-Dprf8d8-.js";const J={class:"max-w-xl max-h-xl"},K={class:"flex justify-between modal-border items-center p-[14px] border-b"},W={class:"justify-end border-t modal-card flex gap-2 p-4"},Z={__name:"UserDelete",props:{userId:{type:Number,required:!0}},setup(k){const l=k,r=q(),c=I(),f=$(),_=async()=>{try{await r.removeUser(l.userId),c.show("Foydalanuvchi muvaffaqiyatli o‘chirildi!","success"),f.close()}catch(x){c.show("Xatolik yuz berdi!","error"),console.error(x)}};return(x,n)=>{const a=y("UButton");return U(),w("div",J,[t("div",K,[n[2]||(n[2]=t("p",{class:"text-dark text-lg font-semibold"},"Foydalanuvchini o‘chirish",-1)),s(a,{customClass:"bg-[#475467] rounded-full p-1",onClick:n[0]||(n[0]=i=>e(f).close())},{default:p(()=>[s(e(j),{"stroke-width":"3",class:"w-4 h-4 text-white"})]),_:1})]),n[5]||(n[5]=t("div",{class:"p-4 text-center space-y-4"},[t("p",{class:"text-base text-dark"}," Siz rostdan ham bu foydalanuvchini o‘chirmoqchimisiz? ")],-1)),t("div",W,[s(a,{variant:"ghost",onClick:n[1]||(n[1]=i=>e(f).close()),disabled:e(r).loading},{default:p(()=>[...n[3]||(n[3]=[V(" Bekor qilish ",-1)])]),_:1},8,["disabled"]),s(a,{variant:"danger",onClick:_,loading:e(r).loading},{default:p(()=>[...n[4]||(n[4]=[V(" O‘chirish ",-1)])]),_:1},8,["loading"])])])}}},ee={class:"flex flex-col max-w-2xl"},te={class:"flex justify-between modal-border items-center p-[14px] border-b"},ae={class:"text-black text-md font-bold uppercase"},se={class:"flex flex-wrap -mx-2 p-4"},oe={class:"w-full px-2 py-2 xl:w-1/2"},le={class:"w-full px-2 py-2 xl:w-1/2"},re={class:"w-full px-2 py-2 xl:w-1/2"},ie={class:"w-full px-2 py-2 xl:w-1/2"},ne={class:"w-full px-2 py-2 xl:w-1/2"},de={class:"w-full px-2 py-2 xl:w-1/2"},ue={class:"w-full px-2 py-2 xl:w-1/2"},me={class:"w-full px-2 py-2 xl:w-1/2"},pe={class:"justify-end border-t modal-card modal-border flex items-center p-4 gap-2"},P={__name:"UserForm",props:{userId:{type:Number,default:null}},setup(k){const l=k,r=q(),c=R();I();const f=$(),_=D(()=>!!l.userId),x={id:"",username:"",email:"",last_name:"",first_name:"",father_name:"",position:"",department_id:"",password:""},n={username:{required:!0,message:"Ism majburiy"},email:{required:!0,message:"Email majburiy"},last_name:{required:!0,message:"Familiya majburiy"},first_name:{required:!0,message:"Sharif majburiy"},father_name:{required:!0,message:"Otasining ismi majburiy"},position:{required:!0,message:"Lavozim majburiy"},department_id:{required:!0,message:"Bo‘lim majburiy"},password:{required:!l.userId,message:"Parol majburiy"}},{form:a,errors:i,validate:g,resetForm:F}=Q(x,n);z(async()=>{const m=[];if(c.departments.length||m.push(c.fetchAll()),l.userId&&m.push(r.fetchUser(l.userId)),await Promise.all(m),l.userId&&r.selectedUser){const o=r.selectedUser;a.username=o.username,a.last_name=o.last_name,a.first_name=o.first_name,a.father_name=o.father_name,a.position=o.position,a.email=o.email,a.department_id=o.department?.id}});const v=()=>{F(),f.close()},d=async()=>{if(!(!g()||r.loading))try{const m={...a};_.value||delete m.id,m.password||delete m.password,_.value?await r.editUser(l.userId,m):await r.addUser(m),v()}catch(m){console.error(m)}};return(m,o)=>{const S=y("UButton"),b=y("UInput"),M=y("USelect");return U(),w("div",ee,[t("div",te,[t("p",ae,h(_.value?"Foydalanuvchini tahrirlash":"Foydalanuvchi qo‘shish"),1),s(S,{customClass:"bg-[#475467] rounded-full p-1",onClick:v},{default:p(()=>[s(e(j),{"stroke-width":"3",class:"w-4 h-4 text-white"})]),_:1})]),t("form",{onSubmit:T(d,["prevent"]),class:"space-y-6"},[t("div",se,[t("div",oe,[s(b,{modelValue:e(a).username,"onUpdate:modelValue":o[0]||(o[0]=u=>e(a).username=u),label:"Foydalanuvchi nomi",placeholder:"Foydalanuvchi nomini kiriting",error:e(i).username},null,8,["modelValue","error"])]),t("div",le,[s(b,{modelValue:e(a).email,"onUpdate:modelValue":o[1]||(o[1]=u=>e(a).email=u),label:"Email",placeholder:"Email manzilingizni kiriting",error:e(i).email},null,8,["modelValue","error"])]),t("div",re,[s(b,{modelValue:e(a).last_name,"onUpdate:modelValue":o[2]||(o[2]=u=>e(a).last_name=u),label:"Familiya",placeholder:"Familiyangizni kiriting",error:e(i).last_name},null,8,["modelValue","error"])]),t("div",ie,[s(b,{modelValue:e(a).first_name,"onUpdate:modelValue":o[3]||(o[3]=u=>e(a).first_name=u),label:"Ismingiz",placeholder:"Ismingizni kiriting",error:e(i).first_name},null,8,["modelValue","error"])]),t("div",ne,[s(b,{modelValue:e(a).father_name,"onUpdate:modelValue":o[4]||(o[4]=u=>e(a).father_name=u),label:"Otasining ismi",placeholder:"Otasining ismini kiriting",error:e(i).father_name},null,8,["modelValue","error"])]),t("div",de,[s(M,{modelValue:e(a).department_id,"onUpdate:modelValue":o[5]||(o[5]=u=>e(a).department_id=u),label:"Bo‘lim",options:e(c).departments,"option-label":"name","option-value":"id",placeholder:"Bo‘lim kiriting",error:e(i).department_id},null,8,["modelValue","options","error"])]),t("div",ue,[s(b,{modelValue:e(a).position,"onUpdate:modelValue":o[6]||(o[6]=u=>e(a).position=u),label:"Lavozim",placeholder:"Lavozim kiriting",error:e(i).position},null,8,["modelValue","error"])]),t("div",me,[s(b,{modelValue:e(a).password,"onUpdate:modelValue":o[7]||(o[7]=u=>e(a).password=u),type:"password",label:"Parol",placeholder:"Parolni yangilamoqchi bo‘lsangiz kiriting",error:e(i).password},null,8,["modelValue","error"])])]),t("div",pe,[s(S,{variant:"ghost",type:"button",onClick:v,disabled:e(r).loading},{default:p(()=>[...o[8]||(o[8]=[V(" Bekor qilish ",-1)])]),_:1},8,["disabled"]),s(S,{type:"submit",variant:"primary",loading:e(r).loading,disabled:e(r).loading},{default:p(()=>[V(h(e(r).loading?"Yuborilmoqda...":_.value?"Yangilash":"Saqlash"),1)]),_:1},8,["loading","disabled"])])],32)])}}},ce={class:"flex flex-row items-end py-4 justify-between"},fe={class:"flex items-center w-1/2 justify-end gap-4"},he={class:"table-header flex gap-3 items-center"},_e=["src"],ge={class:"table-header"},ve={class:"table-header"},be={class:"bg-blue-500 text-white px-2 rounded"},xe={class:"table-header"},ye={class:"table-header"},we={class:"table-header flex flex-row items-start"},Ue={class:"p-4 sticky bottom-0"},ke={__name:"UserList",setup(k){const l=q(),r=$(),c=Y(""),f=()=>{l.searchQuery=c.value,l.fetchUsers(1)},_=()=>{c.value="",l.searchQuery="",l.fetchUsers(1)},x=i=>l.fetchUsers(i);z(()=>{l.fetchUsers()});const n=i=>r.open(Z,{userId:i}),a=(i=null)=>r.open(P,{userId:i});return(i,g)=>{const F=y("UInput"),v=y("UButton");return U(),w(C,null,[t("div",ce,[s(F,{label:"",type:"text",modelValue:c.value,"onUpdate:modelValue":g[0]||(g[0]=d=>c.value=d),placeholder:"Foydalanuvchi ismini kirting kiriting..."},{right:p(()=>[s(e(L),{class:"text-gray-300"})]),_:1},8,["modelValue"]),t("div",fe,[s(v,{variant:"hover",onClick:_},{default:p(()=>[s(e(B),{class:"w-5 h-5 text-gray-400"})]),_:1}),s(v,{variant:"primary",onClick:f},{default:p(()=>[...g[1]||(g[1]=[V(" Qidirish ",-1)])]),_:1})])]),s(O,null,{thead:p(()=>[...g[2]||(g[2]=[t("th",{class:"table-header uppercase"},"Foydalanuvchi",-1),t("th",{class:"table-header uppercase"},"Isim Familiyasi Otasining ismi",-1),t("th",{class:"table-header uppercase"},"Role",-1),t("th",{class:"table-header uppercase"},"Bo‘lim",-1),t("th",{class:"table-header uppercase"},"Yaratilgan sana",-1),t("th",{class:"table-header uppercase"},"Tahrirlash",-1)])]),tbody:p(()=>[(U(!0),w(C,null,E(e(l).users,d=>(U(),w("tr",{key:d.id,class:"hover:bg-[#F4F6FC] divide-x"},[t("td",he,[t("img",{src:d.avatar||e(G),class:"w-10 h-10 rounded-full"},null,8,_e),t("div",null,[t("div",null,h(d.username),1)])]),t("td",ge,h(d.last_name)+" "+h(d.first_name)+" "+h(d.father_name),1),t("td",ve,[t("span",be,h(d.groups?.[0]),1)]),t("td",xe,h(d.department?.name),1),t("td",ye,h(e(N)(d.created_at).format("DD MMMM YYYY")),1),t("td",we,[s(v,{variant:"hover",onClick:m=>a(d.id)},{default:p(()=>[s(e(X),{class:"w-5 h-5"})]),_:1},8,["onClick"]),s(v,{variant:"hover",onClick:m=>n(d.id)},{default:p(()=>[s(e(B),{class:"w-5 h-5 text-red-500"})]),_:1},8,["onClick"])])]))),128))]),pagination:p(()=>[t("div",Ue,[s(A,{currentPage:e(l).pagination.currentPage,previous:e(l).pagination.previous,next:e(l).pagination.next,lastPage:Math.ceil(e(l).pagination.count/10),total:e(l).pagination.count,loading:e(l).loading,onChange:x},null,8,["currentPage","previous","next","lastPage","total","loading"])])]),_:1})],64)}}},Ve={class:"overflow-y-auto h-screen"},$e={class:"flex flex-col gap-2 items-center p-2"},Fe={class:"flex flex-col p-6 w-full"},Ne={__name:"UserViews",setup(k){const l=$();function r(){l.open(P)}return(c,f)=>(U(),w("div",Ve,[t("div",$e,[s(H,{title:"Tizim foydalanuvchilari",buttonText:"Foydalanuvchi qo‘shish",onAddNew:r}),t("div",Fe,[s(ke),f[0]||(f[0]=t("div",{class:"w-full h-40"},null,-1))])])]))}};export{Ne as default};
